/**
  * @author       Richard Davey <rich@photonstorm.com>
  * @copyright    2020 Photon Storm Ltd.
  * @license      {@link https://opensource.org/licenses/MIT|MIT License}
  */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).Phaser4={})}(this,(function(t){"use strict";let e,r=0,n=0;const i=()=>e,s=t=>{e=t},o=()=>r,a=t=>{r=t},h=t=>{n=t};class u{constructor(t=1,e=0,r=0,n=1,i=0,s=0){this.set(t,e,r,n,i,s)}set(t=1,e=0,r=0,n=1,i=0,s=0){return this.a=t,this.b=e,this.c=r,this.d=n,this.tx=i,this.ty=s,this}identity(){return this.set()}toArray(){return[this.a,this.b,this.c,this.d,this.tx,this.ty]}fromArray(t){return this.set(t[0],t[1],t[2],t[3],t[4],t[5])}}class c{constructor(t=0,e=0,r=0,n=0){this.set(t,e,r,n)}set(t=0,e=0,r=0,n=0){return this.x=t,this.y=e,this.width=r,this.height=n,this}contains(t,e){return function(t,e,r){return!(t.width<=0||t.height<=0)&&(t.x<=e&&t.x+t.width>=e&&t.y<=r&&t.y+t.height>=r)}(this,t,e)}set right(t){t<=this.x?this.width=0:this.width=t-this.x}get right(){return this.x+this.width}set bottom(t){t<=this.y?this.height=0:this.height=t-this.y}get bottom(){return this.y+this.height}}function l(){}class d{constructor(t,e=0,r=0,n=!1){this.compareValue=!1,this._x=e,this._y=r,this.callback=t,this.compareValue=n}set(t=0,e=0){return this._x=t,this._y=e,this.callback(this),this}destroy(){this.callback=l}set x(t){(!this.compareValue||this.compareValue&&t!==this._x)&&(this._x=t,this.callback(this))}get x(){return this._x}set y(t){(!this.compareValue||this.compareValue&&t!==this._x)&&(this._y=t,this.callback(this))}get y(){return this._y}}const f={PI2:2*Math.PI,HALF_PI:.5*Math.PI,EPSILON:1e-6,DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER||-9007199254740991,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991};function p(t){return(t%=f.PI2)>=0?t:t+f.PI2}function m(t,e,r){const n=r-e;return e+((t-e)%n+n)%n}function x(t){return m(t,-Math.PI,Math.PI)}var g=Object.freeze({__proto__:null,AngleBetween:function(t,e,r,n){return Math.atan2(n-e,r-t)},AngleBetweenPoints:function(t,e){return Math.atan2(e.y-t.y,e.x-t.x)},AngleBetweenPointsY:function(t,e){return Math.atan2(e.x-t.x,e.y-t.y)},AngleBetweenY:function(t,e,r,n){return Math.atan2(r-t,n-e)},CounterClockwise:function(t){return t>Math.PI&&(t-=f.PI2),Math.abs(((t+f.HALF_PI)%f.PI2-f.PI2)%f.PI2)},NormalizeAngle:p,ReverseAngle:function(t){return p(t+Math.PI)},RotateAngleTo:function(t,e,r=.05){return t===e||(Math.abs(e-t)<=r||Math.abs(e-t)>=f.PI2-r?t=e:(Math.abs(e-t)>Math.PI&&(e<t?e+=f.PI2:e-=f.PI2),e>t?t+=r:e<t&&(t-=r))),t},ShortestAngleBetween:function(t,e){const r=e-t;return 0===r?0:r-360*Math.floor((r- -180)/360)},WrapAngle:x,WrapAngleDegrees:function(t){return m(t,-180,180)}});class y{constructor(){this._rotation=0,this.type="Camera",this.dirtyRender=!0;const t=i();this.renderer=t.renderer,this.matrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1]),this.bounds=new c,this.worldTransform=new u,this.position=new d(()=>this.updateTransform(),0,0),this.scale=new d(()=>this.updateTransform(),1,1),this.origin=new d(()=>this.updateTransform(),.5,.5),this.reset()}updateTransform(){const t=this.matrix,e=this.position.x,r=this.position.y,n=this.scale.x,i=this.scale.y,s=-e+this.width*this.origin.x,o=-r+this.height*this.origin.y,a=Math.sin(this.rotation),h=Math.cos(this.rotation),u=a+a,c=a*u,l=h*u,d=(1-c)*n,f=l*n,p=-l*i,m=(1-c)*i;t[0]=d,t[1]=f,t[4]=p,t[5]=m,t[12]=e+s-(d*s+p*o),t[13]=r+o-(f*s+m*o),this.worldTransform.set(h*n,a*n,-a*i,h*i,-e,-r);const x=this.width*(1/n),g=this.height*(1/i);this.bounds.set(s-x/2,o-g/2,x,g),this.dirtyRender=!0}reset(){const t=this.renderer.width,e=this.renderer.height;this.width=t,this.height=e,this.bounds.set(0,0,t,e)}set rotation(t){t!==this._rotation&&(this._rotation=x(t),this.updateTransform())}get rotation(){return this._rotation}destroy(){this.position.destroy(),this.scale.destroy(),this.origin.destroy(),this.world=null,this.worldTransform=null,this.renderer=null,this.matrix=null,this.bounds=null}}class w{constructor(){this.type="StaticCamera",this.dirtyRender=!0;const t=i();this.renderer=t.renderer,this.matrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.bounds=new c,this.worldTransform=new u,this.reset()}reset(){const t=this.renderer.width,e=this.renderer.height;this.width=t,this.height=e,this.bounds.set(0,0,t,e)}destroy(){this.world=null,this.worldTransform=null,this.renderer=null,this.matrix=null,this.bounds=null}}var b=Object.freeze({__proto__:null,Camera:y,StaticCamera:w});function v(t){let e;return t&&("string"==typeof t?e=document.getElementById(t):"object"==typeof t&&1===t.nodeType&&(e=t)),e||(e=document.body),e}function T(t){const e=document.readyState;if("complete"===e||"interactive"===e)return void t();const r=()=>{document.removeEventListener("deviceready",r,!0),document.removeEventListener("DOMContentLoaded",r,!0),window.removeEventListener("load",r,!0),t()};document.body?window.hasOwnProperty("cordova")?document.addEventListener("deviceready",r,!0):(document.addEventListener("DOMContentLoaded",r,!0),window.addEventListener("load",r,!0)):window.setTimeout(r,20)}var S=Object.freeze({__proto__:null,AddToDOM:function(t,e){return v(e).appendChild(t),t},DOMContentLoaded:T,GetElement:v,ParseXML:function(t){let e;try{return e=(new DOMParser).parseFromString(t,"text/xml"),e&&e.documentElement&&!e.getElementsByTagName("parsererror").length?e:null}catch(t){return null}},RemoveFromDOM:function(t){t.parentNode&&t.parentNode.removeChild(t)}});let E;function A(t,e){return e||(E||(E=document.createElement("audio")),e=E),e&&""!==e.canPlayType(t)}function C(t){return A("audio/x-m4a",t)||A("audio/aac",t)}function _(t){return A('audio/mpeg; codecs="mp3"',t)}function R(t){return A('audio/ogg; codecs="vorbis"',t)}function M(t){return A('audio/ogg; codecs="opus"',t)||A('audio/webm; codecs="opus"',t)}function D(t){return A('audio/wav; codecs="1"',t)}function F(t){return A('audio/webm; codecs="vorbis"',t)}function I(){return window&&window.hasOwnProperty("Audio")}function P(){return window&&(window.hasOwnProperty("AudioContext")||window.hasOwnProperty("webkitAudioContext"))}function B(){const t={audioData:I(),m4a:!1,mp3:!1,ogg:!1,opus:!1,wav:!1,webAudio:P(),webm:!1};return t.audioData&&(t.m4a=C(),t.mp3=_(),t.ogg=R(),t.opus=M(),t.wav=D(),t.webm=F()),t}var O=Object.freeze({__proto__:null,CanPlayAudioType:A,CanPlayM4A:C,CanPlayMP3:_,CanPlayOGG:R,CanPlayOpus:M,CanPlayWAV:D,CanPlayWebM:F,GetAudio:B,HasAudio:I,HasWebAudio:P});function k(){const t=/Chrome\/(\d+)/.test(navigator.userAgent);return{chrome:t,chromeVersion:t?parseInt(RegExp.$1,10):0}}function L(){return{edge:/Edge\/\d+/.test(navigator.userAgent)}}function z(){const t=/Firefox\D+(\d+)/.test(navigator.userAgent);return{firefox:t,firefoxVersion:t?parseInt(RegExp.$1,10):0}}function U(){const t=/MSIE (\d+\.\d+);/.test(navigator.userAgent);return{ie:t,ieVersion:t?parseInt(RegExp.$1,10):0}}function G(){const t=navigator.userAgent,e={iOS:!1,iOSVersion:0,iPhone:!1,iPad:!1};if(/iP[ao]d|iPhone/i.test(t)){const r=/OS (\d+)/.exec(navigator.appVersion);e.iOS=!0,e.iOSVersion=parseInt(r[0],10),e.iPhone=t.toLowerCase().includes("iphone"),e.iPad=t.toLowerCase().includes("ipad")}return e}function V(){const{iOS:t}=G();return{mobileSafari:navigator.userAgent.includes("AppleWebKit")&&t}}function W(){return{opera:navigator.userAgent.includes("Opera")}}function N(){const t=navigator.userAgent;return/Windows Phone/i.test(t)||/IEMobile/i.test(t)}function H(){const t=navigator.userAgent;return{safari:t.includes("Safari")&&!N(),safariVersion:/Version\/(\d+)\./.test(t)?parseInt(RegExp.$1,10):0}}function j(){return{silk:navigator.userAgent.includes("Silk")}}function X(){const t=/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(navigator.userAgent);return{trident:t,tridentVersion:t?parseInt(RegExp.$1,10):0,tridentIEVersion:t?parseInt(RegExp.$3,10):0}}function Y(){const{chrome:t,chromeVersion:e}=k(),{edge:r}=L(),{firefox:n,firefoxVersion:i}=z();let{ie:s,ieVersion:o}=U();const{mobileSafari:a}=V(),{opera:h}=W(),{safari:u,safariVersion:c}=H(),{silk:l}=j(),{trident:d,tridentVersion:f,tridentIEVersion:p}=X();d&&(s=!0,o=p);return{chrome:t,chromeVersion:e,edge:r,firefox:n,firefoxVersion:i,ie:s,ieVersion:o,mobileSafari:a,opera:h,safari:u,safariVersion:c,silk:l,trident:d,tridentVersion:f}}var q=Object.freeze({__proto__:null,GetBrowser:Y,IsChrome:k,IsEdge:L,IsFirefox:z,IsMobileSafari:V,IsMSIE:U,IsOpera:W,IsSafari:H,IsSilk:j,IsTrident:X});function K(){return navigator.userAgent.includes("Android")}function $(){return navigator.userAgent.includes("CrOS")}function Q(){return window.hasOwnProperty("cordova")}function Z(){return navigator.userAgent.includes("Crosswalk")}function J(){return window.hasOwnProperty("ejecta")}function tt(){const t=navigator.userAgent;return t.includes("Kindle")||/\bKF[A-Z][A-Z]+/.test(t)||/Silk.*Mobile Safari/.test(t)}function et(){return navigator.userAgent.includes("Linux")}function rt(){const t=navigator.userAgent;return t.includes("Mac OS")&&!t.includes("like Mac OS")}function nt(){return"undefined"!=typeof process&&"object"==typeof process.versions&&process.versions.hasOwnProperty("node")}function it(){return nt()&&!!process.versions.hasOwnProperty("node-webkit")}function st(){return navigator.hasOwnProperty("standalone")}function ot(){return navigator.userAgent.includes("Windows")}function at(){const t=navigator.userAgent,{iOS:e,iOSVersion:r,iPad:n,iPhone:i}=G(),s={android:K(),chromeOS:$(),cordova:Q(),crosswalk:Z(),desktop:!1,ejecta:J(),iOS:e,iOSVersion:r,iPad:n,iPhone:i,kindle:tt(),linux:et(),macOS:rt(),node:nt(),nodeWebkit:it(),pixelRatio:1,webApp:st(),windows:ot(),windowsPhone:N()};s.windowsPhone&&(s.android=!1,s.iOS=!1,s.macOS=!1,s.windows=!0);const o=t.includes("Silk");return(s.windows||s.macOS||s.linux&&!o||s.chromeOS)&&(s.desktop=!0),(s.windowsPhone||/Windows NT/i.test(t)&&/Touch/i.test(t))&&(s.desktop=!1),s}var ht=Object.freeze({__proto__:null,GetOS:at,IsAndroid:K,IsChromeOS:$,IsCordova:Q,IsCrosswalk:Z,IsEjecta:J,IsiOS:G,IsKindle:tt,IsLinux:et,IsMacOS:rt,IsNode:nt,IsNodeWebkit:it,IsWebApp:st,IsWindows:ot,IsWindowsPhone:N});let ut;function ct(t,e){return e||(ut||(ut=document.createElement("video")),e=ut),e&&""!==e.canPlayType(t)}function lt(t){return ct('video/mp4; codecs="avc1.42E01E"',t)}function dt(t){return ct('application/x-mpegURL; codecs="avc1.42E01E"',t)}function ft(t){return ct('video/ogg; codecs="theora"',t)}function pt(t){return ct('video/webm; codecs="vp9"',t)}function mt(t){return ct('video/webm; codecs="vp8, vorbis"',t)}function xt(){return{h264Video:lt(),hlsVideo:dt(),oggVideo:ft(),vp9Video:pt(),webmVideo:mt()}}var gt=Object.freeze({__proto__:null,CanPlayH264Video:lt,CanPlayHLSVideo:dt,CanPlayOGGVideo:ft,CanPlayVP9Video:pt,CanPlayVideoType:ct,CanPlayWebMVideo:mt,GetVideo:xt}),yt=Object.freeze({__proto__:null,Audio:O,Browser:q,OS:ht,Video:gt,CanPlayAudioType:A,CanPlayM4A:C,CanPlayMP3:_,CanPlayOGG:R,CanPlayOpus:M,CanPlayWAV:D,CanPlayWebM:F,GetAudio:B,HasAudio:I,HasWebAudio:P,GetBrowser:Y,IsChrome:k,IsEdge:L,IsFirefox:z,IsMobileSafari:V,IsMSIE:U,IsOpera:W,IsSafari:H,IsSilk:j,IsTrident:X,GetOS:at,IsAndroid:K,IsChromeOS:$,IsCordova:Q,IsCrosswalk:Z,IsEjecta:J,IsiOS:G,IsKindle:tt,IsLinux:et,IsMacOS:rt,IsNode:nt,IsNodeWebkit:it,IsWebApp:st,IsWindows:ot,IsWindowsPhone:N,CanPlayH264Video:lt,CanPlayHLSVideo:dt,CanPlayOGGVideo:ft,CanPlayVP9Video:pt,CanPlayVideoType:ct,CanPlayWebMVideo:mt,GetVideo:xt});function wt(t){const e=[t],r=[];for(;e.length>0;){const t=e.shift();r.push(t);const n=t.numChildren;if(n>0)for(let r=n-1;r>=0;r--)e.unshift(t.children[r])}return r.shift(),r}function bt(t,e){return t.children.indexOf(e)}function vt(t,e){const r=t.children;let n;if(e>=0&&e<r.length){const t=r.splice(e,1);t[0]&&(n=t[0],n.parent=null)}return n}function Tt(t,e){const r=bt(t,e);return r>-1&&vt(t,r),e}function St(t,e,...r){if(0===t.events.size||!t.events.has(e))return!1;const n=t.events.get(e);for(const t of n)t.callback.apply(t.context,r),t.once&&n.delete(t);return 0===n.size&&t.events.delete(e),!0}function Et(t,...e){return e.forEach(e=>{e.world&&(St(e.world,"removedfromworld",e,e.world),St(e,"removedfromworld",e,e.world)),e.world=t,St(t,"addedtoworld",e,t),St(e,"addedtoworld",e,t)}),e}function At(t,...e){e.forEach(e=>{e.parent&&Tt(e.parent,e),e.parent=t});const r=t.world;return r&&Et(r,...wt(t)),e}function Ct(t,e){return t.children.push(e),At(t,e),e.transform.updateWorld(),e}const _t=1,Rt=4,Mt=16,Dt=32,Ft=64,It=256,Pt=51;function Bt(t,e=[]){for(let r=0;r<t.numChildren;r++){const n=t.children[r],i=[];e.push({node:n,children:i}),n.numChildren>0&&Bt(n,i)}return e}function Ot(t){return`${t.numChildren>0?"Parent":"Child"} [ type=${t.type}, name=${t.name} ]`}function kt(t,e=0,r){const n=t.children;void 0===r&&(r=n.length);const i=r-e;if(i>0&&i<=r){const t=n.splice(e,i);return t.forEach(t=>{t.parent=null}),t}return[]}function Lt(t,e=0,r){kt(t,e,r).forEach(t=>{t.destroy()})}function zt(t,e){const r=t.x-e.x,n=t.y-e.y;return Math.sqrt(r*r+n*n)}function Ut(t,...e){return e.forEach(e=>{Tt(t,e)}),e}function Gt(t,e,r=0,n){const i=kt(t,r,n);return At(e,...i),i.forEach(t=>{t.transform.updateWorld()}),i}var Vt=Object.freeze({__proto__:null,AddChild:Ct,AddChildAt:function(t,e,r){const n=t.children;return e>=0&&e<=n.length&&(At(t,r),n.splice(e,0,r),r.transform.updateWorld()),r},AddChildren:function(t,...e){return e.forEach(e=>{Ct(t,e)}),e},AddChildrenAt:function(t,e,...r){const n=t.children;return e>=0&&e<=n.length&&r.reverse().forEach(n=>{r.splice(e,0,n),At(t,n),n.transform.updateWorld()}),r},AddPosition:function(t,e,...r){return r.forEach(r=>{r.x+=t,r.y+=e}),r},AddRotation:function(t,...e){return e.forEach(e=>{e.rotation+=t}),e},AddScale:function(t,e,...r){return r.forEach(r=>{r.scaleX+=t,r.scaleY+=e}),r},AddSkew:function(t,e,...r){return r.forEach(r=>{r.skewX+=t,r.skewY+=e}),r},BringChildToTop:function(t,e){const r=t.children,n=bt(t,e);return-1!==n&&n<r.length&&(r.splice(n,1),r.push(e),e.setDirty(_t)),e},ConsoleTreeChildren:function(t){const e=Bt(t);t.world===t?console.group("World"):console.group(Ot(t)),e.forEach(t=>{t.children.length?function t(e){console.group(Ot(e.node)),e.children.forEach(e=>{e.children.length>0?t(e):console.log(Ot(e.node))}),console.groupEnd()}(t):console.log(Ot(t.node))}),console.groupEnd()},CountMatchingChildren:function(t,e,r){const n=t.children;let i=0;return n.forEach(t=>{const n=Object.getOwnPropertyDescriptor(t,e);!n||void 0!==r&&r!==n.value||i++}),i},DepthFirstSearch:wt,DepthFirstSearchRecursive:function t(e,r=[]){for(let n=0;n<e.numChildren;n++){const i=e.children[n];r.push(i),i.numChildren>0&&t(i,r)}return r},DepthFirstSearchRecursiveNested:Bt,DestroyChildren:Lt,FindChildByName:function(t,e){const r=wt(t),n=RegExp(e);for(let t=0;t<r.length;t++){const e=r[t];if(n.test(e.name))return e}},FindChildrenByName:function(t,e){const r=wt(t),n=RegExp(e),i=[];return r.forEach(t=>{n.test(t.name)&&i.push(t)}),i},GetAllChildren:function(t,e,r){const n=wt(t);if(!e)return n;const i=[];return n.forEach(t=>{const n=Object.getOwnPropertyDescriptor(t,e);!n||void 0!==r&&r!==n.value||i.push(t)}),i},GetChildAt:function(t,e){const r=t.children;if(e<0||e>r.length)throw new Error("Index out of bounds: "+e);return r[e]},GetChildIndex:bt,GetChildren:function(t,e,r){const n=t.children;if(!e)return[...n];const i=[];return n.forEach(t=>{const n=Object.getOwnPropertyDescriptor(t,e);!n||void 0!==r&&r!==n.value||i.push(t)}),i},GetClosestChild:function(t,e){const r=t.children;let n=null,i=0;return r.forEach(t=>{const r=zt(e,t.transform.position);(!n||r<i)&&(n=t,i=r)}),n},GetFirstChild:function(t,e,r){const n=t.children;for(let t=0;t<n.length;t++){const i=n[t],s=Object.getOwnPropertyDescriptor(i,e);if(s&&(void 0===r||r===s.value))return i}},GetFurthestChild:function(t,e){const r=t.children;let n=null,i=0;return r.forEach(t=>{const r=zt(e,t.transform.position);(!n||r>i)&&(n=t,i=r)}),n},GetLastChild:function(t,e,r){const n=t.children;for(let t=n.length-1;t>=0;t--){const i=n[t],s=Object.getOwnPropertyDescriptor(i,e);if(s&&(void 0===r||r===s.value))return i}},GetParents:function(t){const e=[];for(;t.parent;)e.push(t.parent),t=t.parent;return e},GetRandomChild:function(t,e=0,r){const n=t.children;return r||(r=n.length),n[e+Math.floor(Math.random()*r)]},MoveChildDown:function(t,e){const r=t.children,n=bt(t,e);if(n>0){const t=r[n-1],i=r.indexOf(t);r[n]=t,r[i]=e,e.setDirty(_t),t.setDirty(_t)}return e},MoveChildTo:function(t,e,r){const n=t.children,i=bt(t,e);if(-1===i||r<0||r>=n.length)throw new Error("Index out of bounds");return i!==r&&(n.splice(i,1),n.splice(r,0,e),e.setDirty(_t)),e},MoveChildUp:function(t,e){const r=t.children,n=bt(t,e);if(-1!==n&&n>0){const t=r[n+1],i=r.indexOf(t);r[n]=t,r[i]=e,e.setDirty(_t),t.setDirty(_t)}return e},Overlap:function(t,...e){const r=t.bounds.get();for(let t=0;t<e.length;t++){const s=e[t].bounds.get();if(i=s,!((n=r).width<=0||n.height<=0||i.width<=0||i.height<=0||n.right<i.x||n.bottom<i.y||n.x>i.right||n.y>i.bottom))return!0}var n,i;return!1},RemoveChild:Tt,RemoveChildAt:vt,RemoveChildren:Ut,RemoveChildrenAt:function(t,...e){const r=[];return e.sort((t,e)=>t-e),e.reverse().forEach(e=>{const n=vt(t,e);n&&r.push(n)}),r},RemoveChildrenBetween:kt,ReparentChildren:Gt,RotateChildrenLeft:function(t,e=1){const r=t.children;let n=null;for(let t=0;t<e;t++)n=r.shift(),r.push(n),n.setDirty(_t);return n},RotateChildrenRight:function(t,e=1){const r=t.children;let n=null;for(let t=0;t<e;t++)n=r.pop(),r.unshift(n),n.setDirty(_t);return n},SendChildToBack:function(t,e){const r=t.children,n=bt(t,e);return-1!==n&&n>0&&(r.splice(n,1),r.unshift(e),e.setDirty(_t)),e},SetBounds:function(t,e,r,n,...i){return i.forEach(i=>{i.bounds.set(t,e,r,n)}),i},SetChildrenValue:function(t,e,r){const n=wt(t);return n.forEach(t=>{const n=Object.getOwnPropertyDescriptor(t,e);n&&n.set(r)}),n},SetName:function(t,...e){return e.forEach(e=>{e.name=t}),e},SetOrigin:function(t,e,...r){return r.forEach(r=>{r.setOrigin(t,e)}),r},SetParent:At,SetPosition:function(t,e,...r){return r.forEach(r=>{r.setPosition(t,e)}),r},SetRotation:function(t,...e){return e.forEach(e=>{e.rotation=t}),e},SetScale:function(t,e,...r){return r.forEach(r=>{r.setScale(t,e)}),r},SetSize:function(t,e,...r){return r.forEach(r=>{r.setSize(t,e)}),r},SetSkew:function(t,e,...r){return r.forEach(r=>{r.setSkew(t,e)}),r},SetType:function(t,...e){return e.forEach(e=>{e.type=t}),e},SetValue:function(t,e,...r){return r.forEach(r=>{const n=Object.getOwnPropertyDescriptor(r,t);n&&n.set(e)}),r},SetVisible:function(t,...e){return e.forEach(e=>{e.visible=t}),e},SetWorld:Et,ShuffleChildren:function(t){const e=t.children;for(let t=e.length-1;t>0;t--){const r=Math.floor(Math.random()*(t+1)),n=e[t];e[t]=e[r],e[r]=n,n.setDirty(_t)}return e},SwapChildren:function(t,e){if(t.parent===e.parent){const r=t.parent.children,n=bt(t.parent,t),i=bt(e.parent,e);n!==i&&(r[n]=e,r[i]=t)}}});class Wt{constructor(){this.events=new Map}}class Nt{constructor(t,e,r=!1){this.callback=t,this.context=e,this.once=r}}function Ht(t,e,r,n,i){const s=t.events,o=s.get(e);if(r)if(r instanceof Nt)o.delete(r);else{const t=!n,e=void 0!==i;for(const s of o)s.callback===r&&t&&s.context===n&&e&&s.once===i&&o.delete(s)}else s.delete(e);return 0===o.size&&s.delete(e),t}function jt(t,e,r,n=t,i=!1){if("function"!=typeof r)throw new TypeError("Listener not a function");const s=new Nt(r,n,i),o=t.events.get(e);return o?o.add(s):t.events.set(e,new Set([s])),s}function Xt(t,e,r,n=t){return jt(t,e,r,n,!0)}var Yt=Object.freeze({__proto__:null,ClearEvent:function(t,e){return t.events.delete(e),t},Emit:St,EventEmitter:Wt,EventInstance:Nt,GetEventNames:function(t){return[...t.events.keys()]},GetListenerCount:function(t,e){const r=t.events.get(e);return r?r.size:0},GetListeners:function(t,e){const r=[];return t.events.get(e).forEach(t=>{r.push(t.callback)}),r},Off:Ht,On:jt,Once:Xt,RemoveAllListeners:function(t,e){e?t.events.delete(e):t.events.clear()}});function qt(t){const{a:e,b:r,c:n,d:i,tx:s,ty:o}=t.world,{x:a,y:h,right:u,bottom:c}=t.extent;return{x0:a*e+h*n+s,y0:a*r+h*i+o,x1:a*e+c*n+s,y1:a*r+c*i+o,x2:u*e+c*n+s,y2:u*r+c*i+o,x3:u*e+h*n+s,y3:u*r+h*i+o}}class Kt{constructor(t){this.fixed=!1,this.includeChildren=!0,this.visibleOnly=!0,this.entity=t,this.area=new c}set(t,e,r,n){this.area.set(t,e,r,n)}get(){return this.entity.isDirty(Dt)&&!this.fixed&&this.update(),this.area}updateLocal(){const{x0:t,y0:e,x1:r,y1:n,x2:i,y2:s,x3:o,y3:a}=qt(this.entity.transform),h=Math.min(t,r,i,o),u=Math.min(e,n,s,a),c=Math.max(t,r,i,o),l=Math.max(e,n,s,a);return this.area.set(h,u,c-h,l-u)}update(){const t=this.updateLocal();if(this.entity.clearDirty(Dt),!this.includeChildren||!this.entity.numChildren)return t;const e=this.visibleOnly,r=this.entity.children;let n=t.x,i=t.y,s=t.right,o=t.bottom;for(let t=0;t<r.length;t++){const a=r[t];if(!a||e&&!a.visible)continue;const h=a.bounds.get();h.x<n&&(n=h.x),h.y<i&&(i=h.y),h.right>s&&(s=h.right),h.bottom>o&&(o=h.bottom)}return t.set(n,i,s-n,o-i)}destroy(){this.entity=null,this.area=null}}class $t{constructor(t){this.enabled=!1,this.enabledChildren=!0,this.entity=t}destroy(){this.entity=null,this.hitArea=null}}class Qt{constructor(t=0,e=0){this.set(t,e)}set(t=0,e=0){return this.x=t,this.y=e,this}getArray(){return[this.x,this.y]}fromArray(t){return this.set(t[0],t[1])}toString(){return`[x=${this.x}, y=${this.y}]`}}var Zt=Object.freeze({__proto__:null,Vec2:Qt,Vec2Callback:d});function Jt(t){const e=t.local,r=t.position.x,n=t.position.y,i=t.rotation,s=t.scale.x,o=t.scale.y,a=t.skew.x,h=t.skew.y;e.set(Math.cos(i+h)*s,Math.sin(i+h)*s,-Math.sin(i-a)*o,Math.cos(i-a)*o,r,n)}function te(t,e){return e.set(t.a,t.b,t.c,t.d,t.tx,t.ty)}function ee(t){const e=t.parent,r=t.transform,n=r.local,i=r.world;if(e)if(r.passthru)te(e.transform.world,i);else{const{a:t,b:r,c:s,d:o,tx:a,ty:h}=n,{a:u,b:c,c:l,d:d,tx:f,ty:p}=e.transform.world;i.set(t*u+r*l,t*c+r*d,s*u+o*l,s*c+o*d,a*u+h*l+f,a*c+h*d+p)}else te(n,i)}class re{constructor(t,e=0,r=0){this.passthru=!1,this._rotation=0,this.entity=t,this.local=new u,this.world=new u,this.position=new d(()=>this.update(),e,r),this.scale=new d(()=>this.update(),1,1,!0),this.skew=new d(()=>this.update(),0,0,!0),this.origin=new d(()=>this.updateExtent(),.5,.5),this.extent=new c}update(){this.updateLocal(),this.updateWorld()}updateLocal(){this.entity.setDirty(_t,Dt),Jt(this)}updateWorld(){const t=this.entity;t.setDirty(_t,Dt),ee(t),t.numChildren&&this.updateChildren()}updateChildren(){const t=this.entity.children;for(let e=0;e<t.length;e++){t[e].transform.updateWorld()}}globalToLocal(t,e,r=new Qt){const{a:n,b:i,c:s,d:o,tx:a,ty:h}=this.world,u=1/(n*o+s*-i);return r.x=o*u*t+-s*u*e+(h*s-a*o)*u,r.y=n*u*e+-i*u*t+(-h*n+a*i)*u,r}localToGlobal(t,e,r=new Qt){const{a:n,b:i,c:s,d:o,tx:a,ty:h}=this.world;return r.x=n*t+s*e+a,r.y=i*t+o*e+h,r}setExtent(t,e,r,n){this.extent.set(t,e,r,n),this.entity.setDirty(_t,Dt)}updateExtent(t,e){const r=this.extent,n=this.entity;void 0!==t&&(r.width=t),void 0!==e&&(r.height=e),r.x=-this.origin.x*r.width,r.y=-this.origin.y*r.height,n.setDirty(_t,Dt)}set rotation(t){t!==this._rotation&&(this._rotation=t,this.update())}get rotation(){return this._rotation}destroy(){this.position.destroy(),this.scale.destroy(),this.skew.destroy(),this.origin.destroy(),this.entity=null,this.local=null,this.world=null,this.position=null,this.scale=null,this.skew=null,this.origin=null,this.extent=null}}var ne=Object.freeze({__proto__:null,BoundsComponent:Kt,InputComponent:$t,GetVertices:qt,TransformComponent:re,UpdateLocalTransform:Jt,UpdateWorldTransform:ee});class ie{constructor(t=0,e=0){this.type="GameObject",this.name="",this.willUpdate=!0,this.willUpdateChildren=!0,this.willRender=!0,this.willRenderChildren=!0,this.willCacheChildren=!1,this.dirty=0,this.dirtyFrame=0,this.visible=!0,this.children=[],this.events=new Map,this.transform=new re(this,t,e),this.bounds=new Kt(this),this.input=new $t(this),this.dirty=Pt,this.transform.update()}isRenderable(){return this.visible&&this.willRender}isDirty(t){return 0!=(this.dirty&t)}clearDirty(t){return this.isDirty(t)&&(this.dirty^=t),this}setDirty(t,e){return this.isDirty(t)||(this.dirty^=t,this.dirtyFrame=o()),this.isDirty(e)||(this.dirty^=e),this}update(t,e){if(this.willUpdateChildren){const r=this.children;for(let n=0;n<r.length;n++){const i=r[n];i&&i.willUpdate&&i.update(t,e)}}this.postUpdate(t,e)}postUpdate(t,e){}renderGL(t){}renderCanvas(t){}postRenderGL(t){}postRenderCanvas(t){}get numChildren(){return this.children.length}destroy(t){t?Gt(this,t):Lt(this),St(this,"destroy",this),this.transform.destroy(),this.bounds.destroy(),this.input.destroy(),this.events.clear(),this.world=null,this.parent=null,this.children=null}}class se extends ie{constructor(t=0,e=0){super(t,e),this._alpha=1,this.type="Container"}setSize(t,e=t){return this.transform.updateExtent(t,e),this}setPosition(t,e){return this.transform.position.set(t,e),this}setOrigin(t,e=t){return this.transform.origin.set(t,e),this}setSkew(t,e=t){return this.transform.skew.set(t,e),this}setScale(t,e=t){return this.transform.scale.set(t,e),this}setRotation(t){return this.transform.rotation=t,this}set width(t){this.transform.updateExtent(t)}get width(){return this.transform.extent.width}set height(t){this.transform.updateExtent(void 0,t)}get height(){return this.transform.extent.height}set x(t){this.transform.position.x=t}get x(){return this.transform.position.x}set y(t){this.transform.position.y=t}get y(){return this.transform.position.y}set originX(t){this.transform.origin.x=t}get originX(){return this.transform.origin.x}set originY(t){this.transform.origin.y=t}get originY(){return this.transform.origin.y}set skewX(t){this.transform.skew.x=t}get skewX(){return this.transform.skew.x}set skewY(t){this.transform.skew.y=t}get skewY(){return this.transform.skew.y}set scaleX(t){this.transform.scale.x=t}get scaleX(){return this.transform.scale.x}set scaleY(t){this.transform.scale.y=t}get scaleY(){return this.transform.scale.y}set rotation(t){this.transform.rotation=t}get rotation(){return this.transform.rotation}get alpha(){return this._alpha}set alpha(t){t!==this._alpha&&(this._alpha=t,this.setDirty(_t))}}function oe(t,e){return((255&(255*e|0))<<24|t)>>>0}function ae(t){const e=t.vertexAlpha,r=t.vertexTint,n=t.vertexColor;return n[0]=oe(r[0],e[0]),n[1]=oe(r[1],e[1]),n[2]=oe(r[2],e[2]),n[3]=oe(r[3],e[3]),t}function he(t,e,...r){const n=t.getFrame(e),{u0:i,u1:s,v0:o,v1:a,pivot:h}=n;return r.forEach(t=>{if(!t||n===t.frame)return;t.frame=n,h&&t.setOrigin(h.x,h.y),t.frame.setExtent(t),t.hasTexture=!0;const e=t.vertexData;e[2]=i,e[3]=o,e[8]=i,e[9]=a,e[14]=s,e[15]=a,e[20]=s,e[21]=o}),r}const ue=[],ce=t=>{ue.push(t)},le=()=>ue,de=()=>{ue.length=0};class fe{constructor(t,e,r,n,i,s){this.trimmed=!1,this.texture=t,this.key=e,this.x=r,this.y=n,this.width=i,this.height=s,this.sourceSizeWidth=i,this.sourceSizeHeight=s,this.updateUVs()}setPivot(t,e){this.pivot={x:t,y:e}}setSize(t,e){this.width=t,this.height=e,this.sourceSizeWidth=t,this.sourceSizeHeight=e,this.updateUVs()}setSourceSize(t,e){this.sourceSizeWidth=t,this.sourceSizeHeight=e}setTrim(t,e,r,n,i,s){this.trimmed=!0,this.sourceSizeWidth=t,this.sourceSizeHeight=e,this.spriteSourceSizeX=r,this.spriteSourceSizeY=n,this.spriteSourceSizeWidth=i,this.spriteSourceSizeHeight=s}getExtent(t,e){const r=this.sourceSizeWidth,n=this.sourceSizeHeight;let i,s,o,a;return this.trimmed?(i=this.spriteSourceSizeX-t*r,s=i+this.spriteSourceSizeWidth,o=this.spriteSourceSizeY-e*n,a=o+this.spriteSourceSizeHeight):(i=-t*r,s=i+r,o=-e*n,a=o+n),{left:i,right:s,top:o,bottom:a}}setExtent(t){const e=t.transform,r=e.origin.x,n=e.origin.y,i=this.sourceSizeWidth,s=this.sourceSizeHeight;let o,a,h,u;this.trimmed?(o=this.spriteSourceSizeX-r*i,a=this.spriteSourceSizeY-n*s,h=this.spriteSourceSizeWidth,u=this.spriteSourceSizeHeight):(o=-r*i,a=-n*s,h=i,u=s),e.setExtent(o,a,h,u)}updateUVs(){const{x:t,y:e,width:r,height:n}=this,i=this.texture.width,s=this.texture.height;this.u0=t/i,this.v0=e/s,this.u1=(t+r)/i,this.v1=(e+n)/s}}class pe{constructor(t,e,r){this.key="",t&&(e=t.width,r=t.height),this.image=t,this.width=e,this.height=r,this.frames=new Map,this.data={},this.addFrame("__BASE",0,0,e,r),ce(this)}addFrame(t,e,r,n,i){if(this.frames.has(t))return null;const s=new fe(this,t,e,r,n,i);return this.frames.set(t,s),this.firstFrame&&"__BASE"!==this.firstFrame.key||(this.firstFrame=s),s}getFrame(t){if(!t)return this.firstFrame;t instanceof fe&&(t=t.key);let e=this.frames.get(t);return e||(console.warn("Frame missing: "+t),e=this.firstFrame),e}setSize(t,e){this.width=t,this.height=e;this.frames.get("__BASE").setSize(t,e)}destroy(){this.binding&&this.binding.destroy(),this.frames.clear(),this.data=null,this.image=null,this.firstFrame=null}}let me;const xe=()=>me,ge=t=>{me=t};class ye extends se{constructor(t,e,r,n){super(t,e),this.hasTexture=!1,this._tint=16777215,this.type="Sprite",this.vertexData=new Float32Array(24).fill(0),this.vertexColor=new Uint32Array(4).fill(4294967295),this.vertexAlpha=new Float32Array(4).fill(1),this.vertexTint=new Uint32Array(4).fill(16777215),this.setTexture(r,n)}setTexture(t,e){return function(t,e,...r){if(t){let n;n=t instanceof pe?t:xe().get(t),n?(r.forEach(t=>{t.texture=n}),he(n,e,...r)):console.warn("Invalid Texture key: "+t)}else r.forEach(t=>{t.texture=null,t.frame=null,t.hasTexture=!1})}(t,e,this),this}setFrame(t){return he(this.texture,t,this),this}isRenderable(){return this.visible&&this.willRender&&this.hasTexture&&this.alpha>0}preRender(){this.isDirty(Mt)&&(ae(this),this.clearDirty(Mt)),this.isDirty(_t)&&(!function(t){const e=t.vertexData,{x0:r,y0:n,x1:i,y1:s,x2:o,y2:a,x3:h,y3:u}=qt(t.transform);e[0]=r,e[1]=n,e[6]=i,e[7]=s,e[12]=o,e[13]=a,e[18]=h,e[19]=u}(this),this.clearDirty(_t))}renderGL(t){this.preRender(),function(t,e){const r=t.texture,n=e.shaders.current,i=n.buffer,s=r.binding;n.count===i.batchSize&&e.flush();const o=t.vertexData;e.textures.request(r);const a=s.index;o[4]=a,o[10]=a,o[16]=a,o[22]=a;const h=n.count*i.quadElementSize;i.vertexViewF32.set(o,h);const u=t.vertexColor,c=i.vertexViewU32;c[h+5]=u[0],c[h+11]=u[2],c[h+17]=u[3],c[h+23]=u[1],n.count++}(this,t)}renderCanvas(t){this.preRender(),function(t,e){const r=t.frame;if(!r)return;const n=e.ctx,i=t.transform,{a:s,b:o,c:a,d:h,tx:u,ty:c}=i.world,{x:l,y:d}=i.extent;n.save(),n.setTransform(s,o,a,h,u,c),n.globalAlpha=t.alpha,n.drawImage(r.texture.image,r.x,r.y,r.width,r.height,l,d,r.width,r.height),n.restore()}(this,t)}get alpha(){return this._alpha}set alpha(t){if(t!==this._alpha){this._alpha=t;const e=this.vertexAlpha;e[0]=t,e[1]=t,e[2]=t,e[3]=t,this.setDirty(It)}}get tint(){return this._tint}set tint(t){if(t!==this._tint){this._tint=t;const e=this.vertexTint;e[0]=t,e[1]=t,e[2]=t,e[3]=t,this.setDirty(Mt)}}destroy(t){super.destroy(t),this.texture=null,this.frame=null,this.hasTexture=!1,this.vertexData=null,this.vertexColor=null,this.vertexAlpha=null,this.vertexTint=null}}function we(t,e,r,n,i,s,o,a,h,u=0,c=4294967295){const l=t.shaders.current,d=l.buffer,f=d.vertexViewF32,p=d.vertexViewU32,m=l.count*d.quadElementSize;f[m+0]=e,f[m+1]=r,f[m+2]=s,f[m+3]=h,f[m+4]=u,p[m+5]=c,f[m+6]=e,f[m+7]=r+i,f[m+8]=s,f[m+9]=o,f[m+10]=u,p[m+11]=c,f[m+12]=e+n,f[m+13]=r+i,f[m+14]=a,f[m+15]=o,f[m+16]=u,p[m+17]=c,f[m+18]=e+n,f[m+19]=r,f[m+20]=a,f[m+21]=h,f[m+22]=u,p[m+23]=c,l.count++}function be(t,e,r,n,i,s,o,a,h,u=0,c=4294967295){t.shaders.setDefault(u),we(t,e,r,n,i,s,o,a,h,u,c),t.shaders.popAndRebind()}function ve(){return 800}function Te(){return 600}function Se(){return 1}let Ee=0;function Ae(){return Ee}let Ce=[];let _e,Re={alpha:!1,antialias:!1,depth:!1,premultipliedAlpha:!1};class Me{constructor(t){this.stack=[],this.current=null,this.renderer=t}reset(){this.stack=[],this.current=null;const t=this.renderer,e=t.gl;e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,t.width,t.height)}add(t,e=!0,r=0,n=0){this.stack.push({framebuffer:t,width:r,height:n}),this.set(t,e,r,n)}set(t,e=!0,r=0,n=0){const i=this.renderer.gl;i.bindFramebuffer(i.FRAMEBUFFER,t),e&&(i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT)),r>0&&i.viewport(0,0,r,n),this.current=t}pop(){this.stack.pop();const t=this.stack.length;if(t>1){const e=this.stack[t-1];this.set(e.framebuffer,!1,e.width,e.height)}else this.reset()}rebind(){const t=this.renderer.gl;t.bindFramebuffer(t.FRAMEBUFFER,this.current)}destroy(){this.stack=[]}}const De={get:()=>_e,set:t=>{_e=t}};function Fe(t,e){return t.a===e.a&&t.b===e.b&&t.c===e.c&&t.d===e.d&&t.tx===e.tx&&t.ty===e.ty}function Ie(t,e){const r=De.get();e||(e=r.COLOR_ATTACHMENT0);const n=r.createFramebuffer();return r.bindFramebuffer(r.FRAMEBUFFER,n),r.framebufferTexture2D(r.FRAMEBUFFER,e,r.TEXTURE_2D,t,0),r.bindFramebuffer(r.FRAMEBUFFER,null),n}function Pe(t){const e=De.get();if(!e)return;const{parent:r,flipY:n,unpackPremultiplyAlpha:i,minFilter:s,magFilter:o,wrapS:a,wrapT:h,generateMipmap:u,isPOT:c}=t,l=r.image;let d=r.width,f=r.height;const p=e.createTexture();return e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,p),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,n),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),l?(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,l),d=l.width,f=l.height):e.texImage2D(e.TEXTURE_2D,0,e.RGBA,d,f,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,o),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,a),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,h),u&&c&&e.generateMipmap(e.TEXTURE_2D),t.texture=p,p}function Be(t){const e=De.get();e&&e.isFramebuffer(t)&&e.deleteFramebuffer(t)}function Oe(t){const e=De.get();e&&e.isTexture(t)&&e.deleteTexture(t)}function ke(t,e){return!(t<1||e<1)&&(0==(t&t-1)&&0==(e&e-1))}function Le(t,e=!0){const r=De.get();r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,t);const n=e?r.LINEAR:r.NEAREST;r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,n),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,n)}function ze(t){const e=De.get(),r=t.parent.image,n=r.width,i=r.height;return n>0&&i>0&&(e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,t.texture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t.flipY),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r)),t.texture}class Ue{constructor(t,e={}){this.index=0,this.indexCounter=-1,this.dirtyIndex=!0,this.unpackPremultiplyAlpha=!0,this.flipY=!1,this.isPOT=!1,this.generateMipmap=!1;const r=De.get();this.parent=t,this.isPOT=ke(t.width,t.height);const{texture:n=null,framebuffer:i=null,unpackPremultiplyAlpha:s=!0,minFilter:o=r.LINEAR,magFilter:a=r.LINEAR,wrapS:h=r.CLAMP_TO_EDGE,wrapT:u=r.CLAMP_TO_EDGE,generateMipmap:c=this.isPOT,flipY:l=!1}=e;this.minFilter=o,this.magFilter=a,this.wrapS=h,this.wrapT=u,this.generateMipmap=c,this.flipY=l,this.unpackPremultiplyAlpha=s,i&&(this.framebuffer=i),n?this.texture=n:Pe(this)}setFilter(t){this.texture&&Le(this.texture,t)}create(){const t=this.texture;return t&&Oe(t),Pe(this)}update(){return this.texture?ze(this):Pe(this)}setIndex(t){this.dirtyIndex=t!==this.index,this.index=t}destroy(){Oe(this.texture),Be(this.framebuffer),this.parent=null,this.texture=null,this.framebuffer=null}}class Ge{constructor(t,e,r,n,i){this.batchSize=t,this.dataSize=e,this.indexSize=r,this.vertexElementSize=n,this.quadIndexSize=i,this.vertexByteSize=n*e,this.quadByteSize=4*this.vertexByteSize,this.quadElementSize=4*n,this.bufferByteSize=t*this.quadByteSize,this.create()}create(){let t=[];for(let e=0;e<this.batchSize*this.indexSize;e+=this.indexSize)t.push(e+0,e+1,e+2,e+2,e+3,e+0);this.data=new ArrayBuffer(this.bufferByteSize),this.index=new Uint16Array(t),this.vertexViewF32=new Float32Array(this.data),this.vertexViewU32=new Uint32Array(this.data);const e=De.get();this.vertexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.data,e.DYNAMIC_DRAW),this.indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.index,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),t=[]}destroy(){}}let Ve;const We=()=>Ve,Ne=t=>{Ve=t},He={fragmentShader:"\n#define SHADER_NAME SINGLE_QUAD_FRAG\n\nprecision highp float;\n\nvarying vec2 vTextureCoord;\nvarying float vTextureId;\nvarying vec4 vTintColor;\n\nuniform sampler2D uTexture;\n\nvoid main (void)\n{\n    vec4 color = texture2D(uTexture, vTextureCoord);\n\n    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);\n}",vertexShader:"\n#define SHADER_NAME SINGLE_QUAD_VERT\n\nprecision highp float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute float aTextureId;\nattribute vec4 aTintColor;\n\nuniform mat4 uProjectionMatrix;\nuniform mat4 uCameraMatrix;\n\nvarying vec2 vTextureCoord;\nvarying float vTextureId;\nvarying vec4 vTintColor;\n\nvoid main (void)\n{\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vTintColor = aTintColor;\n\n    gl_Position = uProjectionMatrix * uCameraMatrix * vec4(aVertexPosition, 0.0, 1.0);\n}"};class je{constructor(t={}){this.attribs={aVertexPosition:0,aTextureCoord:0,aTextureId:0,aTintColor:0},this.uniforms={uProjectionMatrix:0,uCameraMatrix:0,uTexture:0,uTime:0,uResolution:0},this.renderToFBO=!1,this.renderer=We();const{batchSize:e=4096,dataSize:r=4,indexSize:n=4,vertexElementSize:i=6,quadIndexSize:s=6,fragmentShader:o=He.fragmentShader,vertexShader:a=He.vertexShader,width:h=ve(),height:u=Te(),resolution:c=Se(),renderToFBO:l=!1}=t;this.buffer=new Ge(e,r,n,i,s),this.createShaders(o,a),this.count=0,this.renderToFBO=l;const d=new pe(null,h*c,u*c),f=new Ue(d);d.binding=f,f.framebuffer=Ie(f.texture),this.texture=d,this.framebuffer=f.framebuffer}createShaders(t,e){const r=this.renderer.gl,n=r.createShader(r.FRAGMENT_SHADER);r.shaderSource(n,t),r.compileShader(n);let i=!1,s=r.getShaderInfoLog(n);s.length>0&&(i=!0,console.error(s));const o=r.createShader(r.VERTEX_SHADER);if(r.shaderSource(o,e),r.compileShader(o),s=r.getShaderInfoLog(n),s.length>0&&(i=!0,console.error(s)),i)return;const a=r.createProgram();r.attachShader(a,o),r.attachShader(a,n),r.linkProgram(a),r.useProgram(a),this.program=a;for(const t of Object.keys(this.attribs)){const e=r.getAttribLocation(a,t);r.enableVertexAttribArray(e),this.attribs[t]=e}for(const t of Object.keys(this.uniforms))this.uniforms[t]=r.getUniformLocation(a,t)}bind(t,e,r){if(!this.program)return!1;const n=this.renderer,i=n.gl,s=this.uniforms;return i.useProgram(this.program),i.uniformMatrix4fv(s.uProjectionMatrix,!1,t),i.uniformMatrix4fv(s.uCameraMatrix,!1,e),i.uniform1i(s.uTexture,n.textures.textureIndex[r]),i.uniform1f(s.uTime,performance.now()),i.uniform2f(s.uResolution,n.width,n.height),this.bindBuffers(this.buffer.indexBuffer,this.buffer.vertexBuffer),!0}bindBuffers(t,e){const r=this.renderer.gl,n=this.buffer.vertexByteSize,i=this.attribs;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t),r.bindBuffer(r.ARRAY_BUFFER,e),r.vertexAttribPointer(i.aVertexPosition,2,r.FLOAT,!1,n,0),r.vertexAttribPointer(i.aTextureCoord,2,r.FLOAT,!1,n,8),r.vertexAttribPointer(i.aTextureId,1,r.FLOAT,!1,n,16),r.vertexAttribPointer(i.aTintColor,4,r.UNSIGNED_BYTE,!0,n,20),this.count=0}draw(t){const e=this.renderer,r=e.gl,n=this.buffer;if(t===n.batchSize)r.bufferData(r.ARRAY_BUFFER,n.data,r.DYNAMIC_DRAW);else{const e=n.vertexViewF32.subarray(0,t*n.quadElementSize);r.bufferSubData(r.ARRAY_BUFFER,0,e)}this.renderToFBO&&e.fbo.add(this.framebuffer,!0),r.drawElements(r.TRIANGLES,t*n.quadIndexSize,r.UNSIGNED_SHORT,0),this.renderToFBO&&e.fbo.pop()}flush(){const t=this.count;return 0!==t&&(this.draw(t),this.prevCount=t,this.count=0,!0)}}class Xe extends je{constructor(t={fragmentShader:"\n#define SHADER_NAME MULTI_QUAD_FRAG\n\nprecision highp float;\n\nvarying vec2 vTextureCoord;\nvarying float vTextureId;\nvarying vec4 vTintColor;\n\nuniform sampler2D uTexture[%count%];\n\nvoid main (void)\n{\n    vec4 color;\n\n    %forloop%\n\n    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);\n}"}){super(t)}createShaders(t,e){const r=Ae();let n="";for(let t=1;t<r;t++)t>1&&(n+="\n\telse "),t<r-1&&(n+=`if (vTextureId < ${t}.5)`),n+="\n\t{",n+=`\n\t\tcolor = texture2D(uTexture[${t}], vTextureCoord);`,n+="\n\t}";t=(t=t.replace(/%count%/gi,""+r)).replace(/%forloop%/gi,n),super.createShaders(t,e)}bind(t,e){if(!this.program)return!1;const r=this.renderer,n=r.gl,i=this.uniforms;return n.useProgram(this.program),n.uniformMatrix4fv(i.uProjectionMatrix,!1,t),n.uniformMatrix4fv(i.uCameraMatrix,!1,e),n.uniform1iv(i.uTexture,r.textures.textureIndex),n.uniform1f(i.uTime,performance.now()),n.uniform2f(i.uResolution,r.width,r.height),this.bindBuffers(this.buffer.indexBuffer,this.buffer.vertexBuffer),!0}}function Ye(t,e,r=-1,n=1){return new Float32Array([1/-t*-2,0,0,0,0,1/e*-2,0,0,0,0,1/(r-n)*2,0,-1,1,0,1])}class qe{constructor(t,e){this.renderer=t;const r={shader:new e};this.stack=[r],this.currentEntry=r,this.current=r.shader,this.singleQuadShader=new je}add(t,e){const r={shader:t,textureID:e};return this.stack.push(r),r}set(t,e){this.flush();const r=this.renderer,n=r.projectionMatrix,i=r.currentCamera.matrix,s=t.bind(n,i,e);if(s){const r=this.add(t,e);this.currentEntry=r,this.current=t}return s}setDefault(t){this.set(this.singleQuadShader,t)}pop(){this.flush();const t=this.stack;t.length>1&&t.pop(),this.currentEntry=t[t.length-1],this.current=this.currentEntry.shader}reset(){this.pop(),this.rebind()}flush(){return!!this.current.flush()&&(this.renderer.flushTotal++,!0)}rebind(){const t=this.renderer,e=t.projectionMatrix,r=t.currentCamera.matrix,n=this.currentEntry;n.shader.bind(e,r,n.textureID)}popAndRebind(){this.pop(),this.rebind()}clear(){}destroy(){}}const Ke=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function $e(t){let e="";for(let r=0;r<t;++r)r>0&&(e+="\nelse "),r<t-1&&(e+=`if(test == ${r}.0){}`);return e}class Qe{constructor(t){this.startActiveTexture=0,this.renderer=t,this.tempTextures=[],this.textureIndex=[]}init(){const t=this.renderer.gl;let e=function(t,e){const r=e.createShader(e.FRAGMENT_SHADER);for(;;){const n=Ke.replace(/%forloop%/gi,$e(t));if(e.shaderSource(r,n),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS))break;t=t/2|0}return t}(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),t);const r=Ae();0===r||r>0&&r>e?Ee=e:r>0&&r<e&&(e=Math.max(8,r));const n=this.tempTextures;n.length&&n.forEach(e=>{t.deleteTexture(e)});const i=[];for(let r=0;r<e;r++){const e=t.createTexture();t.activeTexture(t.TEXTURE0+r),t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),n[r]=e,i.push(r)}this.maxTextures=e,this.textureIndex=i,this.currentActiveTexture=1}update(){const t=le();for(let e=0;e<t.length;e++){const r=t[e];r.binding||(r.binding=new Ue(r))}de()}reset(){const t=this.renderer.gl,e=this.tempTextures;for(let r=0;r<e.length;r++)t.activeTexture(t.TEXTURE0+r),t.bindTexture(t.TEXTURE_2D,e[r]);this.currentActiveTexture=1,this.startActiveTexture++}bind(t,e=0){const r=this.renderer.gl,n=t.binding;n.setIndex(e),r.activeTexture(r.TEXTURE0+e),r.bindTexture(r.TEXTURE_2D,n.texture)}unbind(t=0){const e=this.renderer.gl;e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,this.tempTextures[t]),t>0&&this.startActiveTexture++}request(t){const e=this.renderer.gl,r=t.binding,n=this.currentActiveTexture;return!(r.indexCounter>=this.startActiveTexture)&&(r.indexCounter=this.startActiveTexture,n<this.maxTextures?(r.setIndex(n),e.activeTexture(e.TEXTURE0+n),e.bindTexture(e.TEXTURE_2D,r.texture),this.currentActiveTexture++):(this.renderer.flush(),this.startActiveTexture++,r.indexCounter=this.startActiveTexture,r.setIndex(1),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,r.texture),this.currentActiveTexture=2),!0)}}class Ze{constructor(){this.clearColor=[0,0,0,1],this.flushTotal=0,this.clearBeforeRender=!0,this.optimizeRedraw=!1,this.autoResize=!0,this.contextLost=!1,this.currentCamera=null,this.width=ve(),this.height=Te(),this.resolution=Se(),this.setBackgroundColor(0);const t=document.createElement("canvas");t.addEventListener("webglcontextlost",t=>this.onContextLost(t),!1),t.addEventListener("webglcontextrestored",()=>this.onContextRestored(),!1),this.canvas=t,this.fbo=new Me(this),this.textures=new Qe(this),this.initContext(),Ne(this),this.shaders=new qe(this,Xe)}initContext(){const t=this.canvas.getContext("webgl",Re);De.set(t),this.gl=t,t.disable(t.DEPTH_TEST),t.disable(t.CULL_FACE),this.resize(this.width,this.height,this.resolution),this.textures.init()}resize(t,e,r=1){this.width=t*r,this.height=e*r,this.resolution=r;const n=this.canvas;n.width=this.width,n.height=this.height,this.autoResize&&(n.style.width=(this.width/r).toString()+"px",n.style.height=(this.height/r).toString()+"px"),this.gl.viewport(0,0,this.width,this.height),this.projectionMatrix=Ye(t,e)}onContextLost(t){t.preventDefault(),this.contextLost=!0}onContextRestored(){this.contextLost=!1,this.initContext()}setBackgroundColor(t){return function(t,e=[]){const r=t>>16&255,n=t>>8&255,i=255&t,s=t>16777215?t>>>24:255;e[0]=r/255,e[1]=n/255,e[2]=i/255,e[3]=s/255}(t,this.clearColor),this}reset(t=null,e=this.width,r=this.height){const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,t),n.viewport(0,0,e,r),n.enable(n.BLEND),n.blendFunc(n.ONE,n.ONE_MINUS_SRC_ALPHA),this.flushTotal=0,this.currentCamera=null,this.textures.update()}render(t){if(this.contextLost)return;if(this.reset(),this.optimizeRedraw&&0===t.numDirtyFrames&&0===t.numDirtyCameras)return;const e=this.gl;if(this.clearBeforeRender){const t=this.clearColor;e.clearColor(t[0],t[1],t[2],t[3]),e.clear(e.COLOR_BUFFER_BIT)}const r=t.worldData;for(let t=0;t<r.length;t++){const{camera:e,renderList:n}=r[t];this.currentCamera&&Fe(e.worldTransform,this.currentCamera.worldTransform)||(this.flush(),this.currentCamera=e,this.shaders.rebind()),n.forEach(t=>{t.children.length?this.renderNode(t):t.node.renderGL(this)})}this.flush()}renderNode(t){t.node.renderGL(this),t.children.forEach(t=>{t.children.length>0?this.renderNode(t):t.node.renderGL(this)}),t.node.postRenderGL(this)}flush(){this.shaders.flush()}destroy(){Ne(void 0)}}class Je extends ie{constructor(){super(),this.type="Layer",this.transform.passthru=!0,this.willRender=!1}}class tr extends Je{constructor(){super(),this.type="RenderLayer",this.willRender=!0,this.willRenderChildren=!0,this.willCacheChildren=!0,this.setDirty(Rt);const t=ve(),e=Te(),r=Se(),n=new pe(null,t*r,e*r);n.binding=new Ue(n),n.binding.framebuffer=Ie(n.binding.texture),this.texture=n,this.framebuffer=n.binding.framebuffer}renderGL(t){this.numChildren>0&&(t.flush(),this.isDirty(Rt)?(t.fbo.add(this.framebuffer,!0),this.clearDirty(Rt)):(t.fbo.add(this.framebuffer,!1),this.postRender(t)))}postRender(t){const e=this.texture;t.flush(),t.fbo.pop();const{u0:r,v0:n,u1:i,v1:s}=e.firstFrame;t.textures.bind(e),be(t,0,0,e.width,e.height,r,n,i,s),t.textures.unbind(),this.clearDirty(_t)}}function er(t,e,r){return Math.max(e,Math.min(r,t))}function rr(t,e,r,n,i,s,o=0,a=1,h=1,u=0,c=0){const l=Math.cos(o+c)*a,d=Math.sin(o+c)*a,f=-Math.sin(o-u)*h,p=Math.cos(o-u)*h;return{x0:t*l+r*f+i,y0:t*d+r*p+s,x1:t*l+n*f+i,y1:t*d+n*p+s,x2:e*l+n*f+i,y2:e*d+n*p+s,x3:e*l+r*f+i,y3:e*d+r*p+s}}function nr(t,e){const r=document.createElement("canvas");return r.width=t,r.height=e,r.getContext("2d")}function ir(t=32,e=32){const r=nr(t,e);return new pe(r.canvas)}var sr=Object.freeze({__proto__:null,AnimatedSprite:class extends ye{constructor(t,e,r,n){super(t,e,r,n),this.type="AnimatedSprite",this.anims=new Map,this.animData={currentAnim:"",currentFrames:[],frameIndex:0,animSpeed:0,nextFrameTime:0,repeatCount:0,isPlaying:!1,yoyo:!1,pendingStart:!1,playingForward:!0,delay:0,repeatDelay:0,onStart:null,onRepeat:null,onComplete:null}}stop(){const t=this.animData;t.isPlaying=!1,t.currentAnim="",t.onComplete&&t.onComplete(this,t.currentAnim)}nextFrame(){const t=this.animData;if(t.frameIndex++,t.frameIndex===t.currentFrames.length)if(t.yoyo)t.frameIndex--,t.playingForward=!1;else{if(!(-1===t.repeatCount||t.repeatCount>0))return t.frameIndex--,this.stop();t.frameIndex=0,-1!==t.repeatCount&&t.repeatCount--,t.onRepeat&&t.onRepeat(this,t.currentAnim),t.nextFrameTime+=t.repeatDelay}this.setFrame(t.currentFrames[t.frameIndex]),t.nextFrameTime+=t.animSpeed}prevFrame(){const t=this.animData;if(t.frameIndex--,-1===t.frameIndex){if(!(-1===t.repeatCount||t.repeatCount>0))return t.frameIndex=0,this.stop();t.frameIndex=0,t.playingForward=!0,-1!==t.repeatCount&&t.repeatCount--,t.onRepeat&&t.onRepeat(this,t.currentAnim),t.nextFrameTime+=t.repeatDelay}this.setFrame(t.currentFrames[t.frameIndex]),t.nextFrameTime+=t.animSpeed}update(t,e){super.update(t,e);const r=this.animData;r.isPlaying&&(r.nextFrameTime-=1e3*t,r.nextFrameTime=Math.max(r.nextFrameTime,0),0===r.nextFrameTime&&(r.pendingStart?(r.onStart&&r.onStart(this,r.currentAnim),r.pendingStart=!1,r.nextFrameTime=r.animSpeed):r.playingForward?this.nextFrame():this.prevFrame()))}get isPlaying(){return this.animData.isPlaying}get isPlayingForward(){return this.animData.isPlaying&&this.animData.playingForward}get currentAnimation(){return this.animData.currentAnim}destroy(t){super.destroy(t),this.anims.clear(),this.animData=null}},Components:ne,Container:se,EffectLayer:class extends tr{constructor(){super(),this.shaders=[],this.type="EffectLayer"}postRender(t){const e=this.shaders,r=this.texture;if(t.flush(),t.fbo.pop(),0===e.length){const{u0:e,v0:n,u1:i,v1:s}=r.firstFrame;t.textures.bind(r),be(t,0,0,r.width,r.height,e,n,i,s),t.textures.unbind()}else{let n=r;for(let r=0;r<e.length;r++){const i=e[r],{u0:s,v0:o,u1:a,v1:h}=n.firstFrame;t.shaders.set(i,0)&&(i.renderToFBO=!0,t.textures.bind(n),we(t,0,0,n.width,n.height,s,o,a,h),t.shaders.pop(),t.textures.unbind(),n=i.texture)}const{u0:i,v0:s,u1:o,v1:a}=n.firstFrame;t.textures.bind(n),be(t,0,0,n.width,n.height,i,s,o,a),t.textures.unbind()}this.clearDirty(_t)}},Layer:Je,RenderLayer:tr,GameObject:ie,Sprite:ye,SpriteBatch:class extends Je{constructor(t,e){super(),this.glTextureIndex=0,this.hasTexture=!1,this.type="SpriteBatch",this.willRender=!0,this.setTexture(e),this.setMaxSize(t)}resetBuffers(){let t=[];for(let e=0;e<4*this.maxSize;e+=4)t.push(e+0,e+1,e+2,e+2,e+3,e+0);this.data=new ArrayBuffer(96*this.maxSize),this.index=new Uint16Array(t),this.vertexViewF32=new Float32Array(this.data),this.vertexViewU32=new Uint32Array(this.data);const e=De.get();e&&(Be(this.vertexBuffer),Be(this.indexBuffer),this.vertexBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.data,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.index,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null)),t=[],this.count=0}setMaxSize(t){return this.maxSize=er(t,0,65535),this.resetBuffers(),this}setTexture(t){let e;return e=t instanceof pe?t:xe().get(t),e?(this.texture=e,this.hasTexture=!0,this.glTextureIndex=-1):console.warn("Invalid Texture key: "+t),this}isRenderable(){return this.visible&&this.willRender&&this.hasTexture&&this.count>0}clear(){return this.count=0,this}addToBatch(t,e,r,n,i,s,o,a,h,u){if(this.count>=this.maxSize)return console.warn("SpriteBatch full"),this;const{u0:c,u1:l,v0:d,v1:f}=t,p=this.vertexViewF32,m=this.vertexViewU32,x=24*this.count,g=this.texture.binding?this.texture.binding.index:0;return p[x+0]=r,p[x+1]=n,p[x+2]=c,p[x+3]=d,p[x+4]=g,m[x+5]=e,p[x+6]=i,p[x+7]=s,p[x+8]=c,p[x+9]=f,p[x+10]=g,m[x+11]=e,p[x+12]=o,p[x+13]=a,p[x+14]=l,p[x+15]=f,p[x+16]=g,m[x+17]=e,p[x+18]=h,p[x+19]=u,p[x+20]=l,p[x+21]=d,p[x+22]=g,m[x+23]=e,this.setDirty(_t),this.count++,this}add(t){const{frame:e=null,x:r=0,y:n=0,rotation:i=0,scaleX:s=1,scaleY:o=1,skewX:a=0,skewY:h=0,originX:u=0,originY:c=0,alpha:l=1,tint:d=16777215}=t,f=this.texture.getFrame(e),{left:p,right:m,top:x,bottom:g}=f.getExtent(u,c),{x0:y,y0:w,x1:b,y1:v,x2:T,y2:S,x3:E,y3:A}=rr(p,m,x,g,r,n,i,s,o,a,h),C=oe(d,l);return this.addToBatch(f,C,y,w,b,v,T,S,E,A)}addXY(t,e,r){const n=this.texture.getFrame(r),{left:i,right:s,top:o,bottom:a}=n.getExtent(0,0),{x0:h,y0:u,x1:c,y1:l,x2:d,y2:f,x3:p,y3:m}=rr(i,s,o,a,t,e);return this.addToBatch(n,4294967295,h,u,c,l,d,f,p,m)}updateTextureIndex(){const t=this.texture.binding.index;if(t===this.glTextureIndex)return;const e=this.vertexViewF32;this.glTextureIndex=t;for(let r=0;r<this.count;r++)e[24*r+4]=t,e[24*r+10]=t,e[24*r+16]=t,e[24*r+22]=t}renderGL(t){!function(t,e){const r=t.texture,n=e.shaders.current,i=n.buffer;e.flush(),e.textures.request(r),t.updateTextureIndex();const s=e.gl;n.bindBuffers(t.indexBuffer,t.vertexBuffer),s.bufferData(s.ARRAY_BUFFER,t.data,s.STATIC_DRAW),s.drawElements(s.TRIANGLES,t.count*i.quadIndexSize,s.UNSIGNED_SHORT,0),n.prevCount=t.count,e.flushTotal++,n.bindBuffers(i.indexBuffer,i.vertexBuffer)}(this,t)}destroy(){super.destroy(),Be(this.vertexBuffer),Be(this.indexBuffer),this.data=null,this.vertexViewF32=null,this.vertexViewU32=null,this.index=null,this.texture=null,this.hasTexture=!1}},Text:class extends ye{constructor(t,e,r="",n,s){super(t,e,ir()),this.splitRegExp=/(?:\r\n|\r|\n)/,this.padding={left:0,right:0,top:0,bottom:0},this.verticalAlign="ascent",this.lineSpacing=0,this.font="16px monospace",this.fillStyle="#fff",this.strokeStyle="",this.backgroundStyle="",this.cornerRadius=0,this.textAlign="left",this.textBaseline="alphabetic",this.lineWidth=0,this.lineDash=[],this.antialias=!1,this.type="Text";const o=i();this.resolution=o.renderer.resolution,this.canvas=this.texture.image,this.context=this.canvas.getContext("2d"),n&&(this.font=n),s&&(this.fillStyle=s),this.setText(r)}syncContext(t,e){this.preRenderCallback&&this.preRenderCallback(t,e),e.font=this.font,e.textBaseline=this.textBaseline,e.textAlign=this.textAlign,e.fillStyle=this.fillStyle,e.strokeStyle=this.strokeStyle,e.lineWidth=this.lineWidth,e.lineCap="round",e.lineJoin="round",e.setLineDash(this.lineDash),e.imageSmoothingEnabled=this.antialias}updateText(){const t=this.canvas,e=this.context,r=this.resolution,n=this._text.split(this.splitRegExp),i=this.padding,s=this.fillStyle,o=this.strokeStyle,a=this.lineWidth,h=this.lineSpacing,u=a>0?a/2:0;e.clearRect(0,0,t.width,t.height),this.syncContext(t,e),e.textAlign="start";let c=0,l=0,d=0;const f=[],p="ascent"===this.verticalAlign,m=e.measureText("|MÉq"),x=Math.ceil(Math.abs(m.actualBoundingBoxAscent)+Math.abs(m.actualBoundingBoxDescent))+a;for(let t=0;t<n.length;t++){const r=e.measureText(n[t]),i=r.actualBoundingBoxLeft,s=r.actualBoundingBoxRight;let o=r.actualBoundingBoxAscent,m=r.actualBoundingBoxDescent;(o||m)&&""!==n[t]||(o=x,m=0);const g=Math.ceil(Math.abs(i)+Math.abs(s))+a,y=Math.ceil(Math.abs(o)+Math.abs(m))+a;p?(d+=o+u,t>0&&(d+=h+u),l=d+m+u):(d=l+(y-m-u),l+=y,t<n.length-1&&(l+=h)),c=Math.max(c,g),f.push({lineWidth:g,lineHeight:y,ascent:o,descent:m,left:i,right:s,y:d})}c+=i.left+i.right,l+=i.top+i.bottom;const g=this.fixedWidth?this.fixedWidth:c,y=this.fixedHeight?this.fixedHeight:l,w=Math.ceil(g*r),b=Math.ceil(y*r);t.width===w&&t.height===b||(t.width=w,t.height=b,this.texture.setSize(g,y),this.setSize(g,y)),e.save(),e.scale(r,r),this.syncContext(t,e);const v=this.backgroundStyle;if(v){e.save(),e.fillStyle=v,e.strokeStyle=v;const t=this.cornerRadius,r=t>0?t/2:0;t&&(e.lineWidth=t,e.strokeRect(r,r,g-t,y-t)),e.fillRect(r,r,g-t,y-t),e.restore()}const T=this.textAlign,S="center"===T,E="right"===T||"end"===T,A=(y-l)/2+i.top;for(let t=0;t<n.length;t++){const r=n[t],a=f[t];let h=i.left+a.left+u;const c=A+a.y;S?h=g/2:E&&(h=g-u),o&&e.strokeText(r,h,c),s&&e.fillText(r,h,c)}return e.restore(),this.texture.binding&&this.texture.binding.update(),this.setDirty(Ft),this}get text(){return this._text}set text(t){this.setText(t)}setText(t=""){return Array.isArray(t)&&(t=t.join("\n")),t!==this._text&&(this._text=t.toString(),this.updateText()),this}destroy(t){this.texture.destroy(),this.fillStyle=null,this.strokeStyle=null,this.backgroundStyle=null,this.canvas=null,this.context=null,super.destroy(t)}}});class or{constructor(t){this.capture=!0,this.isDown=!1,this.enabled=!0,this.repeatRate=0,this.canRepeat=!0,this.timeDown=0,this.timeUpdated=0,this.timeUp=0,this.value=t}getValue(){return this.value}down(t){if(this.enabled)if(this.capture&&t.preventDefault(),this.isDown&&this.canRepeat){this.timeUpdated=t.timeStamp;const e=this.timeUpdated-this.timeDown;this.downCallback&&e>=this.repeatRate&&this.downCallback(this)}else this.isDown=!0,this.timeDown=t.timeStamp,this.timeUpdated=t.timeStamp,this.downCallback&&this.downCallback(this)}up(t){this.enabled&&(this.capture&&t.preventDefault(),this.isDown&&(this.isDown=!1,this.timeUp=t.timeStamp,this.timeUpdated=t.timeStamp,this.upCallback&&this.upCallback(this)))}reset(){this.isDown=!1,this.timeUpdated=this.timeDown,this.timeUp=this.timeDown}destroy(){this.downCallback=null,this.upCallback=null}}var ar=Object.freeze({__proto__:null,ArrowKeys:class{constructor(t,e){const{left:r=!0,right:n=!0,up:i=!0,down:s=!0,space:o=!0}=e,a=t.keys;r&&(this.left=new or("ArrowLeft"),a.set(this.left.value,this.left)),n&&(this.right=new or("ArrowRight"),a.set(this.right.value,this.right)),i&&(this.up=new or("ArrowUp"),a.set(this.up.value,this.up)),s&&(this.down=new or("ArrowDown"),a.set(this.down.value,this.down)),o&&(this.space=new or(" "),a.set(this.space.value,this.space))}},DownKey:class extends or{constructor(){super("ArrowDown")}},LeftKey:class extends or{constructor(){super("ArrowLeft")}},RightKey:class extends or{constructor(){super("ArrowRight")}},SpaceKey:class extends or{constructor(){super(" ")}},UpKey:class extends or{constructor(){super("ArrowUp")}},WASDKeys:class{constructor(t,e){const{W:r=!0,A:n=!0,S:i=!0,D:s=!0,space:o=!0}=e,a=t.keys;r&&(this.W=new or("w"),a.set(this.W.value,this.W)),n&&(this.A=new or("a"),a.set(this.A.value,this.A)),i&&(this.S=new or("s"),a.set(this.S.value,this.S)),s&&(this.D=new or("d"),a.set(this.D.value,this.D)),o&&(this.space=new or(" "),a.set(this.space.value,this.space))}}});var hr=Object.freeze({__proto__:null,GetKeyDownDuration:function(t){return t.isDown?t.timeUpdated-t.timeDown:t.timeUp-t.timeDown},Key:or,Keys:ar,Keyboard:class extends Wt{constructor(){super(),this.keyConversion={Up:"ArrowUp",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Spacebar:" ",Win:"Meta",Scroll:"ScrollLock",Del:"Delete",Apps:"ContextMenu",Esc:"Escape",Add:"+",Subtract:"-",Multiply:"*",Decimal:".",Divide:"/"},this.keydownHandler=t=>this.onKeyDown(t),this.keyupHandler=t=>this.onKeyUp(t),this.blurHandler=()=>this.onBlur(),window.addEventListener("keydown",this.keydownHandler),window.addEventListener("keyup",this.keyupHandler),window.addEventListener("blur",this.blurHandler),this.keys=new Map}addKeys(...t){t.forEach(t=>{this.keys.set(t.getValue(),t)})}clearKeys(){this.keys.clear()}onBlur(){this.keys.forEach(t=>{t.reset()})}getKeyValue(t){return this.keyConversion.hasOwnProperty(t)?this.keyConversion[t]:t}onKeyDown(t){const e=this.getKeyValue(t.key);if(this.keys.has(e)){this.keys.get(e).down(t)}St(this,"keydown-"+e,t),St(this,"keydown",t)}onKeyUp(t){const e=this.getKeyValue(t.key);if(this.keys.has(e)){this.keys.get(e).up(t)}St(this,"keyup-"+e,t),St(this,"keyup",t)}destroy(){window.removeEventListener("keydown",this.keydownHandler),window.removeEventListener("keyup",this.keyupHandler),window.removeEventListener("blur",this.blurHandler),St(this,"destroy")}},SetKeyRepeatRate:function(t,...e){return e.forEach(e=>{e.repeatRate=t}),e}});function ur(t,e,r=new u){const{a:n,b:i,c:s,d:o,tx:a,ty:h}=t,{a:c,b:l,c:d,d:f,tx:p,ty:m}=e;return r.set(c*n+l*s,c*i+l*o,d*n+f*s,d*i+f*o,p*n+m*s+a,p*i+m*o+h)}function cr(t,e,r,n=new Qt){const{a:i,b:s,c:o,d:a,tx:h,ty:u}=t,c=1/(i*a+o*-s);return n.x=a*c*e+-o*c*r+(u*o-h*a)*c,n.y=i*c*r+-s*c*e+(-u*i+h*s)*c,n}var lr=Object.freeze({__proto__:null,Mouse:class extends Wt{constructor(t){super(),this.primaryDown=!1,this.auxDown=!1,this.secondaryDown=!1,this.resolution=1,this.mousedownHandler=t=>this.onMouseDown(t),this.mouseupHandler=t=>this.onMouseUp(t),this.mousemoveHandler=t=>this.onMouseMove(t),this.blurHandler=()=>this.onBlur(),this.localPoint=new Qt,this.hitPoint=new Qt,this.transPoint=new Qt,t||(t=i().renderer.canvas),t.addEventListener("mousedown",this.mousedownHandler),t.addEventListener("mouseup",this.mouseupHandler),window.addEventListener("mouseup",this.mouseupHandler),window.addEventListener("mousemove",this.mousemoveHandler),window.addEventListener("blur",this.blurHandler),this.target=t}onBlur(){}onMouseDown(t){this.positionToPoint(t),this.primaryDown=0===t.button,this.auxDown=1===t.button,this.secondaryDown=2===t.button,St(this,"pointerdown",this.localPoint.x,this.localPoint.y,t.button,t)}onMouseUp(t){this.positionToPoint(t),this.primaryDown=!(0===t.button),this.auxDown=!(1===t.button),this.secondaryDown=!(2===t.button),St(this,"pointerup",this.localPoint.x,this.localPoint.y,t.button,t)}onMouseMove(t){this.positionToPoint(t),St(this,"pointermove",this.localPoint.x,this.localPoint.y,t)}positionToPoint(t){return this.localPoint.set(t.offsetX,t.offsetY)}getInteractiveChildren(t,e){const r=t.children;for(let t=0;t<r.length;t++){const n=r[t];n.visible&&n.input.enabled&&(e.push(n),n.input.enabledChildren&&n.numChildren&&this.getInteractiveChildren(n,e))}}checkHitArea(t,e,r){return t.input.hitArea?!!t.input.hitArea.contains(e,r):t.transform.extent.contains(e,r)}hitTest(...t){const e=this.localPoint.x,r=this.localPoint.y,n=this.transPoint;for(let i=0;i<t.length;i++){const s=t[i];if(!s.world)continue;if(cr(ur(s.world.camera.worldTransform,s.transform.world),e,r,n),this.checkHitArea(s,n.x,n.y))return this.hitPoint.set(n.x,n.y),!0}return!1}hitTestChildren(t,e=!0){const r=[];if(!t.visible)return r;const n=[],i=t.input;i&&i.enabled&&n.push(t),i.enabledChildren&&t.numChildren&&this.getInteractiveChildren(t,n);for(let t=n.length-1;t>=0;t--){const i=n[t];if(this.hitTest(i)&&(r.push(i),e))break}return r}shutdown(){this.target.addEventListener("mousedown",this.mousedownHandler),this.target.addEventListener("mouseup",this.mouseupHandler),window.addEventListener("mouseup",this.mouseupHandler),window.addEventListener("mousemove",this.mousemoveHandler),window.addEventListener("blur",this.blurHandler)}}});var dr=Object.freeze({__proto__:null,Keyboard:hr,Mouse:lr,SetInteractive:function(...t){return t.forEach(t=>{t.input.enabled=!0}),t}});var fr=Object.freeze({__proto__:null,ChebyshevDistance:function(t,e,r,n){return Math.max(Math.abs(t-r),Math.abs(e-n))},DistanceBetween:function(t,e,r,n){const i=t-r,s=e-n;return Math.sqrt(i*i+s*s)},DistanceBetweenPoints:zt,DistanceBetweenPointsSquared:function(t,e){const r=t.x-e.x,n=t.y-e.y;return r*r+n*n},DistancePower:function(t,e,r,n,i=2){return Math.sqrt(Math.pow(r-t,i)+Math.pow(n-e,i))},DistanceSquared:function(t,e,r,n){const i=t-r,s=e-n;return i*i+s*s},SnakeDistance:function(t,e,r,n){return Math.abs(t-r)+Math.abs(e-n)}});var pr=Object.freeze({__proto__:null,FuzzyCeil:function(t,e=1e-4){return Math.ceil(t-e)},FuzzyEqual:function(t,e,r=1e-4){return Math.abs(t-e)<r},FuzzyFloor:function(t,e=1e-4){return Math.floor(t+e)},FuzzyGreaterThan:function(t,e,r=1e-4){return t>e-r},FuzzyLessThan:function(t,e,r=1e-4){return t<e+r}});function mr(t){if(0===t)return 1;let e=t;for(;--t;)e*=t;return e}function xr(t,e){return mr(t)/mr(e)/mr(t-e)}function gr(t,e,r,n,i){const s=.5*(n-e),o=.5*(i-r),a=t*t;return(2*r-2*n+s+o)*(t*a)+(-3*r+3*n-2*s-o)*a+s*t+r}function yr(t,e,r){return(e-t)*r+t}function wr(t,e,r){return t<=e?0:t>=r?1:(t=(t-e)/(r-e))*t*(3-2*t)}function br(t,e,r){return(t=Math.max(0,Math.min(1,(t-e)/(r-e))))*t*t*(t*(6*t-15)+10)}var vr=Object.freeze({__proto__:null,BezierInterpolation:function(t,e){let r=0;const n=t.length-1;for(let i=0;i<=n;i++)r+=Math.pow(1-e,n-i)*Math.pow(e,i)*t[i]*xr(n,i);return r},CatmullRomInterpolation:function(t,e){const r=t.length-1;let n=r*e,i=Math.floor(n);return t[0]===t[r]?(e<0&&(i=Math.floor(n=r*(1+e))),gr(n-i,t[(i-1+r)%r],t[i],t[(i+1)%r],t[(i+2)%r])):e<0?t[0]-(gr(-n,t[0],t[0],t[1],t[1])-t[0]):e>1?t[r]-(gr(n-r,t[r],t[r],t[r-1],t[r-1])-t[r]):gr(n-i,t[i?i-1:0],t[i],t[r<i+1?r:i+1],t[r<i+2?r:i+2])},CubicBezierInterpolation:function(t,e,r,n,i){return function(t,e){const r=1-t;return r*r*r*e}(t,e)+function(t,e){const r=1-t;return 3*r*r*t*e}(t,r)+function(t,e){return 3*(1-t)*t*t*e}(t,n)+function(t,e){return t*t*t*e}(t,i)},LinearInterpolation:function(t,e){const r=t.length-1,n=r*e,i=Math.floor(n);return e<0?yr(t[0],t[1],n):e>1?yr(t[r],t[r-1],r-n):yr(t[i],t[i+1>r?r:i+1],n-i)},QuadraticBezierInterpolation:function(t,e,r,n){return function(t,e){const r=1-t;return r*r*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,r)+function(t,e){return t*t*e}(t,n)},SmoothStepInterpolation:function(t,e,r){return e+(r-e)*wr(t,0,1)},SmootherStepInterpolation:function(t,e,r){return e+(r-e)*br(t,0,1)}});var Tr=Object.freeze({__proto__:null,Add:function(t,e){return t.a+=e.a,t.b+=e.b,t.c+=e.c,t.d+=e.d,t.tx+=e.tx,t.ty+=e.ty,t},Copy:te,CopyToContext:function(t,e){const{a:r,b:n,c:i,d:s,tx:o,ty:a}=t;return e.transform(r,n,i,s,o,a),e},Determinant:function(t){const{a:e,b:r,c:n,d:i}=t;return e*i-r*n},Frobenius:function(t){return Math.hypot(t.a,t.b,t.c,t.d,t.tx,t.ty,1)},GlobalToLocal:cr,Invert:function(t){const{a:e,b:r,c:n,d:i,tx:s,ty:o}=t;let a=e*i-r*n;return a&&(a=1/a,t.set(i*a,-r*a,-n*a,e*a,(n*o-i*s)*a,(r*s-e*o)*a)),t},ITRS:function(t,e,r,n,i,s){if(0===n)return t.set(1,0,0,1,e,r);{const o=Math.sin(n),a=Math.cos(n);return t.set(a*i,o*i,-o*s,a*s,e,r)}},ITRSS:function(t,e,r,n=0,i=1,s=1,o=0,a=0){return 0===n?t.set(1,0,0,1,e,r):t.set(Math.cos(n+a)*i,Math.sin(n+a)*i,-Math.sin(n-o)*s,Math.cos(n-o)*s,e,r)},LocalToGlobal:function(t,e,r,n=new Qt){const{a:i,b:s,c:o,d:a,tx:h,ty:u}=t;return n.x=i*e+o*r+h,n.y=s*e+a*r+u,n},Matrix2D:u,Multiply:function(t,e){const{a:r,b:n,c:i,d:s,tx:o,ty:a}=t,{a:h,b:u,c:c,d:l,tx:d,ty:f}=e;return t.a=r*h+i*u,t.b=n*h+s*u,t.c=r*c+i*l,t.d=n*c+s*l,t.tx=r*d+i*f+o,t.ty=n*d+s*f+a,t},MultiplyScalar:function(t,e){return t.a*=e,t.b*=e,t.c*=e,t.d*=e,t.tx*=e,t.ty*=e,t},MultiplyScalarAndAdd:function(t,e,r){const{a:n,b:i,c:s,d:o,tx:a,ty:h}=e;return t.a+=n*r,t.b+=i*r,t.c+=s*r,t.d+=o*r,t.tx+=a*r,t.ty+=h*r,t},Rotate:function(t,e){const{a:r,b:n,c:i,d:s,tx:o,ty:a}=t,h=Math.sin(e),u=Math.cos(e);return t.set(r*u+i*h,n*u+s*h,r*-h+i*u,n*-h+s*u,o,a)},Scale:function(t,e,r){return t.a*=e,t.b*=e,t.c*=r,t.d*=r,t},SetToContext:function(t,e){const{a:r,b:n,c:i,d:s,tx:o,ty:a}=t;return e.setTransform(r,n,i,s,o,a),e},Skew:function(t,e,r){return t.b+=Math.tan(e),t.c+=Math.tan(r),t},Subtract:function(t,e){const{a:r,b:n,c:i,d:s,tx:o,ty:a}=e;return t.a-=r,t.b-=n,t.c-=i,t.d-=s,t.tx-=o,t.ty-=a,t},Translate:function(t,e,r){const{a:n,b:i,c:s,d:o,tx:a,ty:h}=t;return t.tx=n*e+s*r+a,t.ty=i*e+o*r+h,t},Zero:function(t){return t.set(0,0,0,0,0,0)}});function Sr(t,e){const{a:r,b:n,c:i,d:s}=t,o=Math.sin(e),a=Math.cos(e);return new u(r*a+i*o,n*a+s*o,r*-o+i*a,n*-o+s*a)}function Er(t,e,r){return new u(t.a*e,t.b*e,t.c*r,t.d*r)}function Ar(t,e,r){const{a:n,b:i,c:s,d:o,tx:a,ty:h}=t;return new u(1,0,0,1,n*e+s*r+a,i*e+o*r+h)}var Cr=Object.freeze({__proto__:null,Add:function(t,e){return new u(t.a+e.a,t.b+e.b,t.c+e.c,t.c+e.c,t.tx+e.tx,t.ty+e.ty)},Append:ur,Clone:function(t){return new u(t.a,t.b,t.c,t.d,t.tx,t.ty)},Equals:function(t,e,r=1e-6){const{a:n,b:i,c:s,d:o,tx:a,ty:h}=t,{a:u,b:c,c:l,d:d,tx:f,ty:p}=e;return Math.abs(n-u)<=r*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(i-c)<=r*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(s-l)<=r*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(o-d)<=r*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(a-f)<=r*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(h-p)<=r*Math.max(1,Math.abs(h),Math.abs(p))},ExactEquals:Fe,FromRotation:function(t){return Sr(new u,t)},FromScaling:function(t,e=t){return Er(new u,t,e)},FromTranslation:function(t,e){return Ar(new u,t,e)},Identity:function(){return new u},Invert:function(t){const{a:e,b:r,c:n,d:i,tx:s,ty:o}=t;let a=e*i-r*n;return a?(a=1/a,new u(i*a,-r*a,-n*a,e*a,(n*o-i*s)*a,(r*s-e*o)*a)):null},Multiply:function(t,e){const{a:r,b:n,c:i,d:s,tx:o,ty:a}=t,{a:h,b:c,c:l,d:d,tx:f,ty:p}=e;return new u(r*h+i*c,n*h+s*c,r*l+i*d,n*l+s*d,r*f+i*p+o,n*f+s*p+a)},MultiplyScalar:function(t,e){return new u(t.a*e,t.b*e,t.c*e,t.d*e,t.tx*e,t.ty*e)},MultiplyScalarAndAdd:function(t,e,r){return new u(t.a+e.a*r,t.b+e.b*r,t.c+e.c*r,t.d+e.d*r,t.tx+e.tx*r,t.ty+e.ty*r)},Rotate:Sr,Scale:Er,Subtract:function(t,e){return new u(t.a-e.a,t.b-e.b,t.c-e.c,t.c-e.c,t.tx-e.tx,t.ty-e.ty)},Translate:Ar,Zero:function(){return new u(0,0,0,0,0,0)}});var _r=Object.freeze({__proto__:null,GetPowerOfTwo:function(t){const e=Math.log(t)/.6931471805599453;return 1<<Math.ceil(e)},IsSizePowerOfTwo:ke,IsValuePowerOfTwo:function(t){return t>0&&0==(t&t-1)}});var Rr=Object.freeze({__proto__:null,SnapCeil:function(t,e,r=0,n=!1){return 0===e?t:(t-=r,t=e*Math.ceil(t/e),n?(r+t)/e:r+t)},SnapFloor:function(t,e,r=0,n=!1){return 0===e?t:(t-=r,t=e*Math.floor(t/e),n?(r+t)/e:r+t)},SnapTo:function(t,e,r=0,n=!1){return 0===e?t:(t-=r,t=e*Math.round(t/e),n?(r+t)/e:r+t)}});var Mr=Object.freeze({__proto__:null,Angle:g,Distance:fr,Fuzzy:pr,Interpolation:vr,Matrix2d:Tr,Matrix2dFuncs:Cr,Pow2:_r,Snap:Rr,Vec2:Zt,Average:function(t){let e=0;for(let r=0;r<t.length;r++)e+=+t[r];return e/t.length},Bernstein:xr,Between:function(t,e){return Math.floor(Math.random()*(e-t+1)+t)},CatmullRom:gr,CeilTo:function(t,e=0,r=10){const n=Math.pow(r,-e);return Math.ceil(t*n)/n},Clamp:er,MATH_CONST:f,DegToRad:function(t){return t*f.DEG_TO_RAD},Difference:function(t,e){return Math.abs(t-e)},Factorial:mr,FloatBetween:function(t,e){return Math.random()*(e-t)+t},FloorTo:function(t,e=0,r=10){const n=Math.pow(r,-e);return Math.floor(t*n)/n},FromPercent:function(t,e,r){return(r-e)*(t=er(t,0,1))},GetSpeed:function(t,e){return t/e/1e3},Linear:yr,MaxAdd:function(t,e,r){return Math.min(t+e,r)},MinSub:function(t,e,r){return Math.max(t-e,r)},Percent:function(t,e,r,n){void 0===r&&(r=e+1);let i=(t-e)/(r-e);return i>1?void 0!==n?(i=(n-t)/(n-r),i<0&&(i=0)):i=1:i<0&&(i=0),i},RadToDeg:function(t){return t*f.RAD_TO_DEG},RoundAwayFromZero:function(t){return t>0?Math.ceil(t):Math.floor(t)},RoundTo:function(t,e=0,r=10){const n=Math.pow(r,-e);return Math.round(t*n)/n},SinCosTableGenerator:function(t,e=1,r=1,n=1){n*=Math.PI/t;const i=[],s=[];for(let o=0;o<t;o++)e+=(r-=e*n)*n,i[o]=r,s[o]=e;return{sin:s,cos:i,length:t}},SmootherStep:br,SmoothStep:wr,ToXY:function(t,e,r,n=new Qt){let i=0,s=0;return t>0&&t<=e*r&&(t>e-1?(s=Math.floor(t/e),i=t-s*e):i=t,n.set(i,s)),n},TransformXY:function(t,e,r,n,i,s,o,a=new Qt){const h=Math.sin(i),u=Math.cos(i),c=u*s,l=h*s,d=-h*o,f=u*o,p=1/(c*f+d*-l);return a.x=f*p*t+-d*p*e+(n*d-r*f)*p,a.y=c*p*e+-l*p*t+(-n*c+r*l)*p,a},Within:function(t,e,r){return Math.abs(t-e)<=r},Wrap:m});const Dr=["#000","#9D9D9D","#FFF","#BE2633","#E06F8B","#493C2B","#A46422","#EB8931","#F7E26B","#2F484E","#44891A","#A3CE27","#1B2632","#005784","#31A2F2","#B2DCEF"];var Fr=Object.freeze({__proto__:null,Arne16:Dr,C64:["#000","#fff","#8b4131","#7bbdc5","#8b41ac","#6aac41","#3931a4","#d5de73","#945a20","#5a4100","#bd736a","#525252","#838383","#acee8b","#7b73de","#acacac"],CGA:["#000","#2234d1","#0c7e45","#44aacc","#8a3622","#5c2e78","#aa5c3d","#b5b5b5","#5e606e","#4c81fb","#6cd947","#7be2f9","#eb8a60","#e23d69","#ffd93f","#fff"],JMP:["#000","#191028","#46af45","#a1d685","#453e78","#7664fe","#833129","#9ec2e8","#dc534b","#e18d79","#d6b97b","#e9d8a1","#216c4b","#d365c8","#afaab9","#f5f4eb"],MSX:["#000","#191028","#46af45","#a1d685","#453e78","#7664fe","#833129","#9ec2e8","#dc534b","#e18d79","#d6b97b","#e9d8a1","#216c4b","#d365c8","#afaab9","#fff"],PICO8:["#000","#1D2B53","#7E2553","#008751","#AB5236","#5F574F","#C2C3C7","#FFF1E8","#FF004D","#FFA300","#FFEC27","#00E436","#29ADFF","#83769C","#FF77A8","#FFCCAA"]});function Ir(t,e){return parseInt(t.getAttribute(e),10)}var Pr=Object.freeze({__proto__:null,AtlasParser:function(t,e){let r;if(Array.isArray(e.textures)?r=e.textures[0].frames:Array.isArray(e.frames)?r=e.frames:e.hasOwnProperty("frames")?r=Object.values(e.frames):console.warn("Invalid Texture Atlas JSON"),r){let e;for(let n=0;n<r.length;n++){const i=r[n];e=t.addFrame(i.filename,i.frame.x,i.frame.y,i.frame.w,i.frame.h),i.trimmed?e.setTrim(i.sourceSize.w,i.sourceSize.h,i.spriteSourceSize.x,i.spriteSourceSize.y,i.spriteSourceSize.w,i.spriteSourceSize.h):e.setSourceSize(i.sourceSize.w,i.sourceSize.h),i.rotated,i.anchor&&e.setPivot(i.anchor.x,i.anchor.y)}}},BitmapTextParser:function(t,e,r){const n=e.getElementsByTagName("info")[0],i=e.getElementsByTagName("common")[0],s={font:n.getAttribute("face"),size:Ir(n,"size"),lineHeight:Ir(i,"lineHeight")+0,chars:{}},o=e.getElementsByTagName("char");for(let e=0;e<o.length;e++){const r=o[e],n=Ir(r,"id"),i=Ir(r,"x"),a=Ir(r,"y"),h=Ir(r,"width"),u=Ir(r,"height");s.chars[n]={x:i,y:a,width:h,height:u,xOffset:Ir(r,"xoffset"),yOffset:Ir(r,"yoffset"),xAdvance:Ir(r,"xadvance")+0,kerning:{}},t.addFrame(n,i,a,h,u)}const a=e.getElementsByTagName("kerning");for(let t=0;t<a.length;t++){const e=a[t],r=Ir(e,"first"),n=Ir(e,"second"),i=Ir(e,"amount");s.chars[n].kerning[r]=i}return s},SpriteSheetParser:function(t,e,r,n,i,s){const{frameWidth:o=null,endFrame:a=-1,margin:h=0,spacing:u=0}=s;let{frameHeight:c=null,startFrame:l=0}=s;if(c||(c=o),null===o)throw new Error("SpriteSheetParser: Invalid frameWidth");let d=Math.floor((n-h+u)/(o+u))*Math.floor((i-h+u)/(c+u));0===d&&console.warn("SpriteSheetParser: Frame config will result in zero frames"),(l>d||l<-d)&&(l=0),l<0&&(l=d+l),-1!==a&&(d=l+(a+1));let f=h,p=h,m=0,x=0;for(let s=0;s<d;s++){m=0,x=0;const a=f+o,l=p+c;a>n&&(m=a-n),l>i&&(x=l-i),t.addFrame(s,e+f,r+p,o-m,c-x),f+=o+u,f+o>n&&(f=h,p+=c+u)}}});var Br=Object.freeze({__proto__:null,CanvasTexture:ir,GridTexture:function(t,e,r=32,n=32,i=2,s=2){const o=nr(r,n),a=r/i,h=n/s;o.fillStyle=t,o.fillRect(0,0,r,n),o.fillStyle=e;for(let t=0;t<s;t++)for(let e=t%2;e<i;e+=2)o.fillRect(e*a,t*h,a,h);return new pe(o.canvas)},PixelTexture:function(t){const{data:e=[],palette:r=Dr,pixelWidth:n=1,pixelHeight:i=n,preRender:s=null,postRender:o=null}=t;let{canvas:a=null,resizeCanvas:h=!0,clearCanvas:u=!0}=t;const c=Math.floor(Math.abs(e[0].length*n)),l=Math.floor(Math.abs(e.length*i));a||(a=nr(c,l).canvas,h=!1,u=!1),h&&(a.width=c,a.height=l);const d=a.getContext("2d");u&&d.clearRect(0,0,c,l),s&&s(a,d);for(let t=0;t<e.length;t++){const s=e[t];for(let e=0;e<s.length;e++){const o=s[e];"."!==o&&" "!==o&&(d.fillStyle=r[parseInt("0x"+o.toUpperCase())],d.fillRect(e*n,t*i,n,i))}}return o&&o(a,d),new pe(a)},RenderTexture:class extends pe{constructor(t,e=256,r=e){super(null,e,r),this.renderer=t}cls(){const t=this.renderer,e=t.gl;return t.reset(this.binding.framebuffer,this.width,this.height),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),t.reset(),this}batchStart(){return this}batchDraw(t){const e=this.renderer;for(let r=0,n=t.length;r<n;r++)t[r].renderGL(e);return this}batchEnd(){const t=this.renderer;return t.flush(),t.reset(),this}draw(...t){return this.batchStart(),this.batchDraw(t),this.batchEnd(),this}},SolidColorTexture:function(t="rgba(0,0,0,0)",e=32,r=32){const n=nr(e,r);return n.fillStyle=t,n.fillRect(0,0,e,r),new pe(n.canvas)}});class Or{constructor(){this.textures=new Map,this.createDefaultTextures(),ge(this)}createDefaultTextures(){this.add("__BLANK",new pe(nr(32,32).canvas));const t=nr(32,32);t.strokeStyle="#0f0",t.moveTo(0,0),t.lineTo(32,32),t.stroke(),t.strokeRect(.5,.5,31,31),this.add("__MISSING",new pe(t.canvas))}get(t){const e=this.textures;return e.has(t)?e.get(t):e.get("__MISSING")}has(t){return this.textures.has(t)}add(t,e){let r;const n=this.textures;return n.has(t)||(r=e instanceof pe?e:new pe(e),r.key=t,n.set(t,r)),r}}var kr=Object.freeze({__proto__:null,CreateCanvas:nr,Frame:fe,GetFrames:function(t,e){const r=[];return e.forEach(e=>{r.push(t.getFrame(e))}),r},GetFramesInRange:function(t,e){const{prefix:r="",start:n=0,zeroPad:i=0,suffix:s=""}=e;let o=e.end;const a=[],h=n<o?1:-1;o+=h;for(let e=n;e!==o;e+=h){const n=r+e.toString().padStart(i,"0")+s;a.push(t.getFrame(n))}return a},SetFilter:function(t,...e){return e.forEach(e=>{e.binding&&e.binding.setFilter(t)}),e},Palettes:Fr,Parsers:Pr,Types:Br,Texture:pe,TextureManager:Or});function Lr(){}function zr(t,e){const{duration:r=0,repeat:n=0,delay:i=-1,onStart:s=Lr,onUpdate:o=Lr,onRepeat:a=Lr,onComplete:h=Lr}=e,u={elapsed:r,duration:r,repeat:n,delay:i,update:null,onStart:s,onUpdate:o,onRepeat:a,onComplete:h};u.update=t=>{if(u.delay>0){if(u.delay-=t,!(u.delay<0))return!1;u.delay=0}return 0===u.delay&&(u.onStart(),u.delay=-1),-1===u.delay&&(u.elapsed-=t,u.onUpdate(t,u.elapsed/u.duration),u.elapsed<=0&&(u.repeat>0?(u.repeat--,u.elapsed=u.duration,u.onRepeat(u.repeat)):(u.elapsed=0,u.onComplete()))),0===u.elapsed},t.events.add(u)}var Ur=Object.freeze({__proto__:null,AddDelayedCall:function(t,e,r){zr(t,{duration:0,delay:e,onComplete:r})},AddTimer:zr,Clock:class{constructor(t){this.world=t,this.timeScale=1,this.events=new Set}update(t,e){this.now=e,t*=this.timeScale,this.events.forEach(e=>{e.update(t)&&this.events.delete(e)})}},NOOP:Lr});var Gr=Object.freeze({__proto__:null,CreateFramebuffer:Ie,CreateGLTexture:Pe,DeleteFramebuffer:Be,DeleteGLBuffer:function(t){const e=De.get();e.isBuffer(t)&&e.deleteBuffer(t)},DeleteGLTexture:Oe,GL:De,Ortho:Ye,PackColor:oe,PackColors:ae,SetGLTextureFilterMode:Le,UpdateGLTexture:ze,WebGLRenderer:Ze});var Vr=Object.freeze({__proto__:null,WorldRenderEvent:"worldrender",WorldShutdownEvent:"worldshutdown"});function Wr(t,e){e.numRendered++,e.numRenderable++,t.node.dirtyFrame>=e.gameFrame&&e.dirtyFrame++,t.children.forEach(t=>{t.children.length>0&&Wr(t,e)})}function Nr(t){if(t.node.isDirty(Rt))return!0;const e=[t];for(;e.length>0;){const t=e.pop();if(t.node.isDirty(_t))return!0;const r=t.children.length;if(r>0)for(let n=0;n<r;n++)e.push(t.children[n])}return e.length=0,!1}function Hr(t,e){t.forEach(t=>{e||Nr(t)?t.node.setDirty(Rt):t.children.length=0})}function jr(t,e,r=[]){for(let n=0;n<e.numChildren;n++){const i=e.children[n];if(i.isRenderable()){const e=[],n={node:i,children:e};r.push(n),i.willRenderChildren&&i.numChildren>0&&(i.willCacheChildren&&t.push(n),jr(t,i,e))}}return r}function Xr(t){const e=[],r=jr(e,t,[]),n=t.renderData;e.length>0&&Hr(e,t.camera.dirtyRender),r.forEach(t=>{t.children.length?Wr(t,n):(n.numRendered++,n.numRenderable++,t.node.dirtyFrame>=n.gameFrame&&n.dirtyFrame++)}),n.renderList=r,t.forceRefresh&&(n.dirtyFrame++,t.forceRefresh=!1)}function Yr(t,e){t.numDirtyFrames+=e.dirtyFrame,t.numTotalFrames+=e.numRendered,e.camera.dirtyRender&&t.numDirtyCameras++,t.worldData.push(e)}function qr(t,e){t.gameFrame=e,t.dirtyFrame=0,t.numRendered=0,t.numRenderable=0,t.renderList.length=0}class Kr extends ie{constructor(t){super(),this.forceRefresh=!1,this.type="BaseWorld",this.scene=t,this.world=this,this.events=new Map,this._updateListener=jt(t,"update",(t,e)=>this.update(t,e)),this._renderListener=jt(t,"render",t=>this.render(t)),this._shutdownListener=jt(t,"shutdown",()=>this.shutdown()),Xt(t,"destroy",()=>this.destroy())}update(t,e){this.willUpdate&&(St(this,"update",t,e,this),super.update(t,e))}postUpdate(t,e){St(this,"postupdate",t,e,this)}render(t){const e=this.renderData;qr(e,t.gameFrame),this.willRender&&this.visible&&(Xr(this),St(this,"worldrender",e,this),Yr(t,e),this.camera&&(this.camera.dirtyRender=!1))}shutdown(){const t=this.scene;Ht(t,"update",this._updateListener),Ht(t,"render",this._renderListener),Ht(t,"shutdown",this._shutdownListener),Ut(this),St(this,"worldshutdown",this),qr(this.renderData,0),this.camera&&this.camera.reset()}destroy(t){super.destroy(t),St(this,"destroy",this),qr(this.renderData,0),this.camera&&this.camera.destroy(),this.events.clear(),this.camera=null,this.renderData=null,this.events=null}}function $r(t){return{camera:t,gameFrame:0,dirtyFrame:0,numRendered:0,numRenderable:0,renderList:[]}}var Qr=Object.freeze({__proto__:null,BaseWorld:Kr,BuildRenderList:Xr,CalculateTotalRenderable:Wr,CreateWorldRenderData:$r,Events:Vr,HasDirtyChildren:Nr,MergeRenderData:Yr,ResetWorldRenderData:qr,StaticWorld:class extends Kr{constructor(t){super(t),this.type="StaticWorld",this.camera=new w,this.renderData=$r(this.camera)}},UpdateCachedLayers:Hr,World:class extends Kr{constructor(t){super(t),this.enableCameraCull=!0,this.type="World",this.camera=new y,this.renderData=$r(this.camera)}},WorldDepthFirstSearch:jr});let Zr;const Jr=()=>Zr,tn=t=>{Zr=t};class en{constructor(){this.scenes=new Map,this.sceneIndex=0,this.flush=!1,this.renderResult={gameFrame:0,numTotalFrames:0,numDirtyFrames:0,numDirtyCameras:0,worldData:[]},this.game=i(),tn(this),Xt(this.game,"boot",()=>this.boot())}boot(){Ce.forEach(t=>new t)}update(t,e){for(const r of this.scenes.values())St(r,"update",t,e)}render(t){const e=this.renderResult;!function(t,e=0){t.gameFrame=e,t.numTotalFrames=0,t.numDirtyFrames=0,t.numDirtyCameras=0,t.worldData.length=0}(e,t);for(const t of this.scenes.values())St(t,"render",e);return this.flush&&(e.numDirtyFrames++,this.flush=!1),e}}function rn(t,e={}){const r=Jr(),n=r.scenes.size,i=r.sceneIndex,s=0===n;"string"==typeof e?t.key=e:(e||!e&&s)&&(t.key=function(t,e,r){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:r}(e,"key","scene"+i.toString())),r.scenes.has(t.key)?console.warn("Scene key already in use: "+t.key):(r.scenes.set(t.key,t),r.flush=!0,r.sceneIndex++)}t.Camera=b,t.DOM=S,t.Device=yt,t.Display=Vt,t.Events=Yt,t.Game=class extends Wt{constructor(...t){super(),this.VERSION="4.0.0-beta1",this.isBooted=!1,this.isPaused=!1,this.willUpdate=!0,this.willRender=!0,this.lastTick=0,this.elapsed=0,this.frame=0,s(this),T(()=>this.boot(t))}boot(t){t.forEach(t=>t());const e=void 0;this.renderer=new e,this.textureManager=new Or,this.sceneManager=new en,this.isBooted=!0,function(){{const t=" v"+i().VERSION;console.log(`%cPhaser${t}%c https://phaser4.io`,"padding: 4px 16px; color: #fff; background: linear-gradient(#3e0081 40%, #00bcc3)","")}}(),St(this,"boot"),this.lastTick=performance.now(),this.step(this.lastTick)}pause(){this.isPaused=!0}resume(){this.isPaused=!1,this.lastTick=performance.now()}step(t){const e=t-this.lastTick;this.lastTick=t,this.elapsed+=e,this.isPaused||(this.willUpdate&&(this.sceneManager.update(e,t),St(this,"update",e,t)),this.willRender&&this.renderer.render(this.sceneManager.render(this.frame))),this.frame++,a(this.frame),h(this.elapsed),requestAnimationFrame(t=>this.step(t))}destroy(){}},t.GameObjects=sr,t.Input=dr,t.Loader=class extends Wt{constructor(){super(),this.baseURL="",this.path="",this.crossOrigin="anonymous",this.maxParallelDownloads=-1,this.isLoading=!1,this.reset()}reset(){this.isLoading=!1,this.queue=new Set,this.inflight=new Set,this.completed=new Set,this.progress=0}add(...t){return t.forEach(t=>{t.loader=this,this.queue.add(t)}),this}start(){return this.isLoading?null:new Promise((t,e)=>{this.completed.clear(),this.progress=0,this.queue.size>0?(this.isLoading=!0,this.onComplete=t,this.onError=e,St(this,"start"),this.nextFile()):(this.progress=1,St(this,"complete"),t())})}nextFile(){let t=this.queue.size;if(-1!==this.maxParallelDownloads&&(t=Math.min(t,this.maxParallelDownloads)-this.inflight.size),t){const e=this.queue.values();for(;t>0;){const r=e.next().value;this.inflight.add(r),this.queue.delete(r),r.load().then(t=>this.fileComplete(t)).catch(t=>this.fileError(t)),t--}}else 0===this.inflight.size&&this.stop()}stop(){this.isLoading&&(this.isLoading=!1,St(this,"complete",this.completed),this.onComplete(),this.completed.clear())}updateProgress(t){this.inflight.delete(t),this.completed.add(t);const e=this.completed.size,r=this.queue.size+this.inflight.size;e>0&&(this.progress=e/(e+r)),St(this,"progress",this.progress,e,r),this.nextFile()}fileComplete(t){St(this,"filecomplete",t),this.updateProgress(t)}fileError(t){St(this,"fileerror",t),this.updateProgress(t)}totalFilesToLoad(){return this.queue.size+this.inflight.size}setBaseURL(t=""){return""!==t&&"/"!==t.substr(-1)&&(t=t.concat("/")),this.baseURL=t,this}setPath(t=""){return""!==t&&"/"!==t.substr(-1)&&(t=t.concat("/")),this.path=t,this}setCORS(t){return this.crossOrigin=t,this}setMaxParallelDownloads(t){return this.maxParallelDownloads=t,this}},t.Math=Mr,t.Scene=class{constructor(t){this.game=i(),this.events=new Map,rn(this,t)}},t.Textures=kr,t.Time=Ur,t.WebGL1=Gr,t.WebGLRenderer=Ze,t.World=Qr}));
