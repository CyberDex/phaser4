/**
  * @author       Richard Davey <rich@photonstorm.com>
  * @copyright    2020 Photon Storm Ltd.
  * @license      {@link https://opensource.org/licenses/MIT|MIT License}
  */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).Phaser4={})}(this,(function(t){"use strict";let e,n=0,r=0;const i=()=>e,s=t=>{e=t},o=()=>n,a=t=>{n=t},h=t=>{r=t};const u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c=new Uint8Array(256);for(let t=0;t<u.length;t++)c[u.charCodeAt(t)]=t;function l(){}class d{constructor(t){const e=new Float32Array(16);this.data=e,this.onChange=l,t?Array.isArray(t)?this.fromArray(t):this.fromArray(t.data):(e[0]=1,e[5]=1,e[10]=1,e[15]=1)}set(t,e,n,r,i,s,o,a,h,u,c,l,d,f,x,y){const p=this.data;return p[0]=t,p[1]=e,p[2]=n,p[3]=r,p[4]=i,p[5]=s,p[6]=o,p[7]=a,p[8]=h,p[9]=u,p[10]=c,p[11]=l,p[12]=d,p[13]=f,p[14]=x,p[15]=y,this.onChange(this),this}toArray(t=[],e=0){const n=this.data;for(let r=0;r<16;r++)t[e+r]=n[r];return t}fromArray(t,e=0){const n=this.data;for(let r=0;r<16;r++)n[r]=t[e+r];return this.onChange(this),this}toString(){return"[ mat4="+this.data.join(", ")+" ]"}destroy(){this.onChange=l,this.data=null}}function f(t,e,n,r=new d){const{x:i,y:s,z:o,w:a}=t,h=i+i,u=s+s,c=o+o,l=i*h,f=i*u,x=i*c,y=s*u,p=s*c,m=o*c,w=a*h,g=a*u,M=a*c,{x:b,y:v,z:_}=n,{x:C,y:z,z:S}=e;return r.set((1-(y+m))*b,(f+M)*b,(x-g)*b,0,(f-M)*v,(1-(l+m))*v,(p+w)*v,0,(x+g)*_,(p-w)*_,(1-(l+y))*_,0,C,z,S,1)}function x(t,e,n=!0,r=new d){const{x:i,y:s,z:o}=e,a=Math.sin(t.x),h=Math.cos(t.x),u=Math.sin(t.y),c=Math.cos(t.y);let l=i,f=s,x=o;const y=-a,p=0-y*u,m=0-h*u,w=y*c,g=h*c;return n||(l=c*i+u*o,f=p*i+h*s+w*o,x=m*i+a*s+g*o),r.set(c,p,m,0,0,h,a,0,u,w,g,0,l,f,x,1)}class y{constructor(t=0,e=0,n=0){this.set(t,e,n)}set(t=0,e=0,n=0){return this.x=t,this.y=e,this.z=n,this}toArray(t=[],e=0){const{x:n,y:r,z:i}=this;return t[e]=n,t[e+1]=r,t[e+2]=i,t}fromArray(t,e=0){return this.set(t[e],t[e+1],t[e+2])}toString(){const{x:t,y:e,z:n}=this;return`{ x=${t}, y=${e}, z=${n} }`}}function p(t,e=new y){const[n,r,i,s,o,a,h,u,c,l,d]=t.data;return e.set(Math.hypot(n,r,i),Math.hypot(o,a,h),Math.hypot(c,l,d))}class m{constructor(t=0,e=0,n=0,r=1){this._x=t,this._y=e,this._z=n,this._w=r,this.onChange=l}set(t=0,e=0,n=0,r=1){return this._x=t,this._y=e,this._z=n,this._w=r,this.onChange(this),this}set x(t){const e=this._x;this._x=t,t!==e&&this.onChange(this)}get x(){return this._x}set y(t){const e=this._y;this._y=t,t!==e&&this.onChange(this)}get y(){return this._y}set z(t){const e=this._z;this._z=t,t!==e&&this.onChange(this)}get z(){return this._z}set w(t){const e=this._w;this._w=t,t!==e&&this.onChange(this)}get w(){return this._w}toArray(t=[],e=0){const{x:n,y:r,z:i,w:s}=this;return t[e]=n,t[e+1]=r,t[e+2]=i,t[e+3]=s,t}fromArray(t,e=0){return this.set(t[e],t[e+1],t[e+2],t[e+3])}destroy(){this.onChange=l}toString(){const{x:t,y:e,z:n,w:r}=this;return`{ x=${t}, y=${e}, z=${n}, w=${r} }`}}function w(t=new d){return t.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}function g(t,e=new d){const[n,r,i,s,o,a,h,u,c,l,f,x,y,p,m,w]=t.data,g=f*w-m*x,M=l*w-p*x,b=l*m-p*f,v=c*w-y*x,_=c*m-f*y,C=c*p-y*l,z=+(a*g-h*M+u*b),S=-(o*g-h*v+u*_),E=+(o*M-a*v+u*C),T=-(o*b-a*_+h*C),R=n*z+r*S+i*E+s*T;if(0===R)return e;const A=1/R,D=h*w-m*u,F=a*w-p*u,P=a*m-p*h,I=o*w-y*u,O=o*m-y*h,L=o*p-y*a,k=h*x-f*u,B=a*x-l*u,G=a*f-l*h,U=o*x-c*u,V=o*f-c*h,N=o*l-c*a,j=-(r*g-i*M+s*b),W=+(n*g-i*v+s*_),q=-(n*M-r*v+s*C),H=+(n*b-r*_+i*C),X=+(r*D-i*F+s*P),K=-(n*D-i*I+s*O),Y=+(n*F-r*I+s*L),$=-(n*P-r*O+i*L),Z=-(r*k-i*B+s*G),J=+(n*k-i*U+s*V),Q=-(n*B-r*U+s*N),tt=+(n*G-r*V+i*N);return e.set(z*A,j*A,X*A,Z*A,S*A,W*A,K*A,J*A,E*A,q*A,Y*A,Q*A,T*A,H*A,$*A,tt*A)}function M(t,e,n,r=new d){const{x:i,y:s,z:o}=t,{x:a,y:h,z:u}=n,{x:c,y:l,z:f}=e;if(Math.abs(i-c)<1e-5&&Math.abs(s-l)<1e-5&&Math.abs(o-f)<1e-5)return w(r);let x=i-c,y=s-l,p=o-f,m=1/Math.hypot(x,y,p);x*=m,y*=m,p*=m;let g=h*p-u*y,M=u*x-a*p,b=a*y-h*x;m=Math.hypot(g,M,b),m?(m=1/m,g*=m,M*=m,b*=m):(g=0,M=0,b=0);let v=y*b-p*M,_=p*g-x*b,C=x*M-y*g;return m=Math.hypot(v,_,C),m?(m=1/m,v*=m,_*=m,C*=m):(v=0,_=0,C=0),r.set(g,v,x,0,M,_,y,0,b,C,p,0,-(g*i+M*s+b*o),-(v*i+_*s+C*o),-(x*i+y*s+p*o),1)}function b(t,e,n=new d){const[r,i,s,o,a,h,u,c,l,f,x,y,p,m,w,g]=t.data,[M,b,v,_,C,z,S,E,T,R,A,D,F,P,I,O]=e.data;return n.set(M*r+b*a+v*l+_*p,b*i+b*h+v*f+_*m,v*s+b*u+v*x+_*w,_*o+b*c+v*y+_*g,C*r+z*a+S*l+E*p,C*i+z*h+S*f+E*m,C*s+z*u+S*x+E*w,C*o+z*c+S*y+E*g,T*r+R*a+A*l+D*p,T*i+R*h+A*f+D*m,T*s+R*u+A*x+D*w,T*o+R*c+A*y+D*g,F*r+P*a+I*l+O*p,F*i+P*h+I*f+O*m,F*s+P*u+I*x+O*w,F*o+P*c+I*y+O*g)}function v(t,e,n,r,i,s,o=new d){const a=1/(t-e),h=1/(n-r),u=1/(i-s);return o.set(-2*a,0,0,0,0,-2*h,0,0,0,0,2*u,0,(t+e)*a,(r+n)*h,(s+i)*u,1)}function _(t,e,n,r,i=new d){const s=1/Math.tan(t/2);let o=-1,a=-2*n;if(null!==r&&r!==1/0){const t=1/(n-r);o=(r+n)*t,a=2*r*n*t}return i.set(s/e,0,0,0,0,s,0,0,0,0,o,-1,0,0,a,0)}function C(t,e,n,r,i=new d){const s=t.data,[o,a,h,u,c,l,f,x,y,p,m,w,g,M,b,v]=s;return t===i?(s[12]=o*e+c*n+y*r+g,s[13]=a*e+l*n+p*r+M,s[14]=h*e+f*n+m*r+b,s[15]=u*e+x*n+w*r+v):i.set(o,a,h,u,c,l,f,x,y,p,m,w,o*e+c*n+y*r+g,a*e+l*n+p*r+M,h*e+f*n+m*r+b,u*e+x*n+w*r+v),i}function z(t,e=new d){const[n,r,i,s,o,a,h,u,c,l,f,x,y,p,m,w]=t.data;return e.set(n,o,c,y,r,a,l,p,i,h,f,m,s,u,x,w)}var S=Object.freeze({__proto__:null,Add:function(t,e,n=new d){const[r,i,s,o,a,h,u,c,l,f,x,y,p,m,w,g]=t.data,[M,b,v,_,C,z,S,E,T,R,A,D,F,P,I,O]=e.data;return n.set(r+M,i+b,s+v,o+_,a+C,h+z,u+S,c+E,l+T,f+R,x+A,y+D,p+F,m+P,w+I,g+O)},AddTranslationFromFloats:function(t,e,n,r){const i=t.data;return i[12]+=e,i[13]+=n,i[14]+=r,t.onChange(t),t},Adjoint:function(t,e=new d){const[n,r,i,s,o,a,h,u,c,l,f,x,y,p,m,w]=t.data,g=n*a-r*o,M=n*h-i*o,b=n*u-s*o,v=r*h-i*a,_=r*u-s*a,C=i*u-s*h,z=c*p-l*y,S=c*m-f*y,E=c*w-x*y,T=l*m-f*p,R=l*w-x*p,A=f*w-x*m;return e.set(a*A-h*R+u*T,i*R-r*A-s*T,p*C-m*_+w*v,f*_-l*C-x*v,h*E-o*A-u*S,n*A-i*E+s*S,m*b-y*C-w*M,c*C-f*b+x*M,o*R-a*E+u*z,r*E-n*R-s*z,y*_-p*b+w*g,l*b-c*_-x*g,a*S-o*T-h*z,n*T-r*S+i*z,p*M-y*v-m*g,c*v-l*M+f*g)},Clone:function(t){return new d(t)},CopyFrom:function(t,e){return e.fromArray(t.data)},CopyPosition:function(t,e){const n=t.data,r=e.data;return r[12]=n[12],r[13]=n[13],r[14]=n[14],e.onChange(e),e},Determinant:function(t){const[e,n,r,i,s,o,a,h,u,c,l,d,f,x,y,p]=t.data,m=l*p-y*d,w=c*p-x*d,g=c*y-x*l,M=u*p-f*d,b=u*y-l*f,v=u*x-f*c;return e*+(o*m-a*w+h*g)+n*-(s*m-a*M+h*b)+r*+(s*w-o*M+h*v)+i*-(s*g-o*b+a*v)},Equals:function(t,e){const[n,r,i,s,o,a,h,u,c,l,d,f,x,y,p,m]=t.data,[w,g,M,b,v,_,C,z,S,E,T,R,A,D,F,P]=e.data;return n===w&&r===g&&i===M&&s===b&&o===v&&a===_&&h===C&&u===z&&c===S&&l===E&&d===T&&f===R&&x===A&&y===D&&p===F&&m===P},Frobenius:function(t){const[e,n,r,i,s,o,a,h,u,c,l,d,f,x,y,p]=t.data;return Math.hypot(e,n,r,i,s,o,a,h,u,c,l,d,f,x,y,p)},FromQuat:function(t,e=new d){const{x:n,y:r,z:i,w:s}=t,o=n+n,a=r+r,h=i+i,u=n*o,c=r*o,l=r*a,f=i*o,x=i*a,y=i*h,p=s*o,m=s*a,w=s*h;return e.set(1-l-y,c+w,f-m,0,c-w,1-u-y,x+p,0,f+m,x-p,1-u-l,0,0,0,0,1)},FromRotation:function(t,e,n=new d){let{x:r,y:i,z:s}=e,o=Math.hypot(r,i,s);if(o<1e-5)return null;o=1/o,r*=o,i*=o,s*=o;const a=Math.sin(t),h=Math.cos(t),u=1-h;return n.set(r*r*u+h,i*r*u+s*a,s*r*u-i*a,0,r*i*u-s*a,i*i*u+h,s*i*u+r*a,0,r*s*u+i*a,i*s*u-r*a,s*s*u+h,0,0,0,0,1)},FromRotationTranslation:function(t,e,n=new d){const{x:r,y:i,z:s,w:o}=t,a=r+r,h=i+i,u=s+s,c=r*a,l=r*h,f=r*u,x=i*h,y=i*u,p=s*u,m=o*a,w=o*h,g=o*u,{x:M,y:b,z:v}=e;return n.set(1-(x+p),l+g,f-w,0,l-g,1-(c+p),y+m,0,f+w,y-m,1-(c+x),0,M,b,v,1)},FromRotationTranslationScale:f,FromRotationTranslationScaleOrigin:function(t,e,n,r,i=new d){const{x:s,y:o,z:a,w:h}=t,u=s+s,c=o+o,l=a+a,f=s*u,x=s*c,y=s*l,p=o*c,m=o*l,w=a*l,g=h*u,M=h*c,b=h*l,{x:v,y:_,z:C}=n,{x:z,y:S,z:E}=r,{x:T,y:R,z:A}=e,D=(1-(p+w))*v,F=(x+b)*v,P=(y-M)*v,I=(x-b)*_,O=(1-(f+w))*_,L=(m+g)*_,k=(y+M)*C,B=(m-g)*C,G=(1-(f+p))*C;return i.set(D,F,P,0,I,O,L,0,k,B,G,0,T+z-(D*z+I*S+k*E),R+S-(F*z+O*S+B*E),A+E-(P*z+L*S+G*E),1)},FromRotationXYTranslation:x,FromScaling:function(t,e=new d){const{x:n,y:r,z:i}=t;return e.set(n,0,0,0,0,r,0,0,0,0,i,0,0,0,0,1)},FromTranslation:function(t,e=new d){const{x:n,y:r,z:i}=t;return e.set(1,0,0,0,0,1,0,0,0,0,1,0,n,r,i,1)},FromXRotation:function(t,e=new d){const n=Math.cos(t),r=Math.sin(t);return e.set(1,0,0,0,0,n,r,0,0,-r,n,0,0,0,0,1)},FromYRotation:function(t,e=new d){const n=Math.cos(t),r=Math.sin(t);return e.set(n,0,-r,0,0,1,0,0,r,0,n,0,0,0,0,1)},FromZRotation:function(t,e=new d){const n=Math.cos(t),r=Math.sin(t);return e.set(n,r,0,0,-r,n,0,0,0,0,1,0,0,0,0,1)},Frustum:function(t,e,n,r,i,s,o=new d){const a=1/(e-t),h=1/(r-n),u=1/(i-s);return o.set(2*i*a,0,0,0,0,2*i*h,0,0,(e+t)*a,(r+n)*h,(s+i)*u,-1,0,0,s*i*2*u,0)},GetRotation:function(t,e=new m){const n=p(t),r=1/n.x,i=1/n.y,s=1/n.z,[o,a,h,u,c,l,d,f,x,y,w]=t.data,g=o*r,M=a*i,b=h*s,v=c*r,_=l*i,C=d*s,z=x*r,S=y*i,E=w*s,T=g+_+E;let R=0;return T>0?(R=2*Math.sqrt(T+1),e.set((C-S)/R,(z-b)/R,(M-v)/R,.25*R)):g>_&&g>E?(R=2*Math.sqrt(1+g-_-E),e.set(.25*R,(M+v)/R,(z+b)/R,(C-S)/R)):_>E?(R=2*Math.sqrt(1+_-g-E),e.set((M+v)/R,.25*R,(C+S)/R,(z-b)/R)):(R=2*Math.sqrt(1+E-g-_),e.set((z+b)/R,(C+S)/R,.25*R,(M-v)/R))},GetScaling:p,GetTranslation:function(t,e=new y){const n=t.data;return e.set(n[12],n[13],n[14])},Identity:w,Invert:g,LookAt:M,Matrix4:d,Multiply:b,MultiplyScalar:function(t,e,n=new d){const[r,i,s,o,a,h,u,c,l,f,x,y,p,m,w,g]=t.data;return n.set(r*e,i*e,s*e,o*e,a*e,h*e,u*e,c*e,l*e,f*e,x*e,y*e,p*e,m*e,w*e,g*e)},MultiplyScalarAndAdd:function(t,e,n,r=new d){const[i,s,o,a,h,u,c,l,f,x,y,p,m,w,g,M]=t.data,[b,v,_,C,z,S,E,T,R,A,D,F,P,I,O,L]=e.data;return r.set(i+b*n,s+v*n,o+_*n,a+C*n,h+z*n,u+S*n,c+E*n,l+T*n,f+R*n,x+A*n,y+D*n,p+F*n,m+P*n,w+I*n,g+O*n,M+L*n)},Ortho:v,Perspective:_,PerspectiveFromFieldOfView:function(t,e,n,r=new d){const i=Math.tan(t.upDegrees*Math.PI/180),s=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),a=Math.tan(t.rightDegrees*Math.PI/180),h=2/(o+a),u=2/(i+s);return r.set(h,0,0,0,0,u,0,0,-(o-a)*h*.5,(i-s)*u*.5,n/(e-n),-1,0,0,n*e/(e-n),0)},Rotate:function(t,e,n,r=new d){let{x:i,y:s,z:o}=n,a=Math.hypot(i,s,o);if(a<1e-5)return null;a=1/a,i*=a,s*=a,o*=a;const h=Math.sin(e),u=Math.cos(e),c=1-u,[l,f,x,y,p,m,w,g,M,b,v,_,C,z,S,E]=t.data,T=i*i*c+u,R=s*i*c+o*h,A=o*i*c-s*h,D=i*s*c-o*h,F=s*s*c+u,P=o*s*c+i*h,I=i*o*c+s*h,O=s*o*c-i*h,L=o*o*c+u;return r.set(l*T+p*R+M*A,f*T+m*R+b*A,x*T+w*R+v*A,y*T+g*R+_*A,l*D+p*F+M*P,f*D+m*F+b*P,x*D+w*F+v*P,y*D+g*F+_*P,l*I+p*O+M*L,f*I+m*O+b*L,x*I+w*O+v*L,y*I+g*O+_*L,C,z,S,E)},RotateX:function(t,e,n=new d){const r=Math.sin(e),i=Math.cos(e),[s,o,a,h,u,c,l,f,x,y,p,m,w,g,M,b]=t.data;return n.set(s,o,a,h,u*i+x*r,c*i+y*r,l*i+p*r,f*i+m*r,x*i-u*r,y*i-c*r,p*i-l*r,m*i-f*r,w,g,M,b)},RotateY:function(t,e,n=new d){const r=Math.sin(e),i=Math.cos(e),[s,o,a,h,u,c,l,f,x,y,p,m,w,g,M,b]=t.data;return n.set(s*i-x*r,o*i-y*r,a*i-p*r,h*i-m*r,u,c,l,f,s*r+x*i,o*r+y*i,a*r+p*i,h*r+m*i,w,g,M,b)},RotateZ:function(t,e,n=new d){const r=Math.sin(e),i=Math.cos(e),[s,o,a,h,u,c,l,f,x,y,p,m,w,g,M,b]=t.data;return n.set(s*i+u*r,o*i+c*r,a*i+l*r,h*i+f*r,u*i-s*r,c*i-o*r,l*i-a*r,f*i-h*r,x,y,p,m,w,g,M,b)},Scale:function(t,e,n=new d){const[r,i,s,o,a,h,u,c,l,f,x,y,p,m,w,g]=t.data,{x:M,y:b,z:v}=e;return n.set(r*M,i*M,s*M,o*M,a*b,h*b,u*b,c*b,l*v,f*v,x*v,y*v,p,m,w,g)},SetTranslation:function(t,e){const n=t.data,{x:r,y:i,z:s}=e;return n[12]=r,n[13]=i,n[14]=s,t.onChange(t),t},SetTranslationFromFloats:function(t,e,n,r){const i=t.data;return i[12]=e,i[13]=n,i[14]=r,t.onChange(t),t},Subtract:function(t,e,n=new d){const[r,i,s,o,a,h,u,c,l,f,x,y,p,m,w,g]=t.data,[M,b,v,_,C,z,S,E,T,R,A,D,F,P,I,O]=e.data;return n.set(r-M,i-b,s-v,o-_,a-C,h-z,u-S,c-E,l-T,f-R,x-A,y-D,p-F,m-P,w-I,g-O)},TargetTo:function(t,e,n,r=new d){const{x:i,y:s,z:o}=t,{x:a,y:h,z:u}=n,{x:c,y:l,z:f}=e;let x=i-c,y=s-l,p=o-f,m=x*x+y*y+p*p;m>0&&(m=1/Math.sqrt(m),x*=m,y*=m,p*=m);let w=h*p-u*y,g=u*x-a*p,M=a*y-h*x;return m=w*w+g*g+M*M,m>0&&(m=1/Math.sqrt(m),w*=m,g*=m,M*=m),r.set(w,g,M,0,y*M-p*g,p*w-x*M,x*g-y*w,0,x,y,p,0,i,s,o,1)},Translate:function(t,e,n=new d){const{x:r,y:i,z:s}=e,o=t.data,[a,h,u,c,l,f,x,y,p,m,w,g,M,b,v,_]=o;return t===n?(o[12]=a*r+l*i+p*s+M,o[13]=h*r+f*i+m*s+b,o[14]=u*r+x*i+w*s+v,o[15]=c*r+y*i+g*s+_):n.set(a,h,u,c,l,f,x,y,p,m,w,g,a*r+l*i+p*s+M,h*r+f*i+m*s+b,u*r+x*i+w*s+v,c*r+y*i+g*s+_),n},TranslateFromFloats:C,Transpose:z,Zero:function(t){return t.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}});class E{constructor(t=1,e=0,n=0,r=1,i=0,s=0){this.set(t,e,n,r,i,s)}set(t=1,e=0,n=0,r=1,i=0,s=0){return this.a=t,this.b=e,this.c=n,this.d=r,this.tx=i,this.ty=s,this}identity(){return this.set()}toArray(){const{a:t,b:e,c:n,d:r,tx:i,ty:s}=this;return[t,e,n,r,i,s]}fromArray(t){return this.set(t[0],t[1],t[2],t[3],t[4],t[5])}}function T(t,e,n){return!(t.width<=0||t.height<=0)&&(t.x<=e&&t.x+t.width>=e&&t.y<=n&&t.y+t.height>=n)}class R{constructor(t=0,e=0,n=0,r=0){this.set(t,e,n,r)}set(t=0,e=0,n=0,r=0){return this.x=t,this.y=e,this.width=n,this.height=r,this}contains(t,e){return T(this,t,e)}set right(t){t<=this.x?this.width=0:this.width=t-this.x}get right(){return this.x+this.width}set bottom(t){t<=this.y?this.height=0:this.height=t-this.y}get bottom(){return this.y+this.height}}class A{constructor(t=0,e=0){this.set(t,e)}set(t=0,e=0){return this.x=t,this.y=e,this}toArray(t=[],e=0){const{x:n,y:r}=this;return t[e]=n,t[e+1]=r,t}fromArray(t,e=0){return this.set(t[e],t[e+1])}toString(){const{x:t,y:e}=this;return`{ x=${t}, y=${e} }`}}class D extends A{constructor(t=l,e=0,n=0){super(e,n),this.onChange=l,this.onChange=t}destroy(){this.onChange=l}set(t=0,e=0){return this._x=t,this._y=e,this.onChange(this),this}get x(){return this._x}set x(t){const e=this._x;this._x=t,e!==t&&this.onChange(this)}get y(){return this._y}set y(t){const e=this._y;this._y=t,e!==t&&this.onChange(this)}}const F={PI2:2*Math.PI,HALF_PI:.5*Math.PI,EPSILON:1e-6,DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER||-9007199254740991,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991};function P(t){return(t%=F.PI2)>=0?t:t+F.PI2}function I(t,e,n){const r=n-e;return e+((t-e)%r+r)%r}function O(t){return I(t,-Math.PI,Math.PI)}var L=Object.freeze({__proto__:null,AngleBetween:function(t,e,n,r){return Math.atan2(r-e,n-t)},AngleBetweenY:function(t,e,n,r){return Math.atan2(n-t,r-e)},CounterClockwise:function(t){return t>Math.PI&&(t-=F.PI2),Math.abs(((t+F.HALF_PI)%F.PI2-F.PI2)%F.PI2)},NormalizeAngle:P,ReverseAngle:function(t){return P(t+Math.PI)},RotateAngleTo:function(t,e,n=.05){return t===e||(Math.abs(e-t)<=n||Math.abs(e-t)>=F.PI2-n?t=e:(Math.abs(e-t)>Math.PI&&(e<t?e+=F.PI2:e-=F.PI2),e>t?t+=n:e<t&&(t-=n))),t},ShortestAngleBetween:function(t,e){const n=e-t;return 0===n?0:n-360*Math.floor((n- -180)/360)},WrapAngle:O,WrapAngleDegrees:function(t){return I(t,-180,180)}});class k{constructor(){this._rotation=0,this.type="Camera",this.dirtyRender=!0;const t=i();this.renderer=t.renderer,this.matrix=w(),this.bounds=new R,this.worldTransform=new E,this.position=new D(()=>this.updateTransform(),0,0),this.scale=new D(()=>this.updateTransform(),1,1),this.origin=new D(()=>this.updateTransform(),.5,.5),this.reset()}updateTransform(){const t=this.matrix.data,e=this.position.x,n=this.position.y,r=this.scale.x,i=this.scale.y,s=-e+this.width*this.origin.x,o=-n+this.height*this.origin.y,a=Math.sin(this.rotation),h=Math.cos(this.rotation),u=a+a,c=a*u,l=h*u,d=(1-c)*r,f=l*r,x=-l*i,y=(1-c)*i;t[0]=d,t[1]=f,t[4]=x,t[5]=y,t[12]=e+s-(d*s+x*o),t[13]=n+o-(f*s+y*o),this.worldTransform.set(h*r,a*r,-a*i,h*i,-e,-n);const p=this.width*(1/r),m=this.height*(1/i);this.bounds.set(s-p/2,o-m/2,p,m),this.dirtyRender=!0}reset(){const t=this.renderer.width,e=this.renderer.height;this.width=t,this.height=e,this.bounds.set(0,0,t,e)}set rotation(t){t!==this._rotation&&(this._rotation=O(t),this.updateTransform())}get rotation(){return this._rotation}destroy(){this.position.destroy(),this.scale.destroy(),this.origin.destroy(),this.world=null,this.worldTransform=null,this.renderer=null,this.matrix=null,this.bounds=null}}class B{constructor(){this.type="StaticCamera",this.dirtyRender=!0;const t=i();this.renderer=t.renderer,this.matrix=w(),this.bounds=new R,this.worldTransform=new E,this.reset()}reset(){const t=this.renderer;if(t){const e=t.width,n=t.height;this.width=e,this.height=n}this.bounds.set(0,0,this.width,this.height)}destroy(){this.world=null,this.worldTransform=null,this.renderer=null,this.matrix=null,this.bounds=null}}var G=Object.freeze({__proto__:null,Camera:k,StaticCamera:B});function U(){return new y(0,0,-1)}function V(){return new y(0,-1,0)}function N(){return new y(0,0,1)}function j(){return new y(-1,0,0)}function W(){return new y(1,0,0)}function q(){return new y(0,1,0)}function H(){return new y(0,0,0)}const X=q(),K=V(),Y=j(),$=W(),Z=N(),J=U(),Q=H();function tt(t,e,n=new y){return n.set(t.x+e.x,t.y+e.y,t.z+e.z)}function et(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}function nt(t,e,n,r,i){const s=1-i,o=s*s,a=i*i;return t*(o*s)+e*(3*i*o)+n*(3*a*s)+r*(a*i)}function rt(t,e,n,r,i){const s=.5*(r-e),o=.5*(i-n),a=t*t;return(2*n-2*r+s+o)*(t*a)+(-3*n+3*r-2*s-o)*a+s*t+n}function it(t,e,n=new y){return n.set(t.x*e,t.y*e,t.z*e)}function st(t,e,n){return Math.max(e,Math.min(n,t))}function ot(t,e,n=new y){const{x:r,y:i,z:s}=t;return n.set(r/e,i/e,s/e)}function at(t){const{x:e,y:n,z:r}=t;return Math.sqrt(e*e+n*n+r*r)}function ht(t,e,n=new y){const{x:r,y:i,z:s}=t,{x:o,y:a,z:h}=e,u=i*h-s*a,c=s*o-r*h,l=r*a-i*o;let d=u*u+c*c+l*l;return d>0&&(d=1/Math.sqrt(d)),n.set(u*d,c*d,l*d)}function ut(t,e){const n=t.x-e.x,r=t.y-e.y,i=t.z-e.z;return n*n+r*r+i*i}function ct(t,e,n=1e-4){return Math.abs(t-e)<n}function lt(t,e,n,r,i){const s=i*i;return t*(s*(2*i-3)+1)+e*(s*(i-2)+i)+n*(s*(i-1))+r*(s*(3-2*i))}function dt(t,e=new y){const{x:n,y:r,z:i}=t;let s=n*n+r*r+i*i;return s>0&&(s=1/Math.sqrt(s)),e.set(n*s,r*s,i*s)}function ft(t,e,n=new y){const[r,i,s,o,a,h,u,c,l,d,f,x,p,m,w,g]=e.data,{x:M,y:b,z:v}=t;let _=o*M+c*b+x*v+g;return _=_||1,n.set((r*M+a*b+l*v+p)/_,(i*M+h*b+d*v+m)/_,(s*M+u*b+f*v+w)/_)}const xt=new d,yt=new d;class pt extends y{constructor(t,e=0,n=0,r=0){super(e,n,r),this.onChange=t}destroy(){this.onChange=l}set(t=0,e=0,n=0){return this._x=t,this._y=e,this._z=n,this.onChange&&this.onChange(this),this}get x(){return this._x}set x(t){const e=this._x;this._x=t,e!==t&&this.onChange(this)}get y(){return this._y}set y(t){const e=this._y;this._y=t,e!==t&&this.onChange(this)}get z(){return this._z}set z(t){const e=this._z;this._z=t,e!==t&&this.onChange(this)}}class mt extends pt{constructor(t,e=0,n=0,r=0){super(t,e,n,r)}set r(t){this.x=t}get r(){return this.x}set g(t){this.y=t}get g(){return this.y}set b(t){this.z=t}get b(){return this.z}toString(){const{x:t,y:e,z:n}=this;return`[ r=${t}, g=${e}, b=${n} ]`}}function wt(t,e,n=new y){return n.set(t.x-e.x,t.y-e.y,t.z-e.z)}function gt(t,e,n,r=new y){return r.set(t.x+e.x*n,t.y+e.y*n,t.z+e.z*n)}function Mt(t,e,n=new y){const[r,i,s,o,a,h,u,c,l,d,f]=e.data,{x:x,y:p,z:m}=t;return n.set(r*x+a*p+l*m,i*x+h*p+d*m,s*x+u*p+f*m)}function bt(t,e,n=new y){const{x:r,y:i,z:s,w:o}=e,{x:a,y:h,z:u}=t;let c=i*u-s*h,l=s*a-r*u,d=r*h-i*a,f=i*d-s*l,x=s*c-r*d,p=r*l-i*c;const m=2*o;return c*=m,l*=m,d*=m,f*=2,x*=2,p*=2,n.set(a+c+f,h+l+x,u+d+p)}const vt=new d,_t=new y;var Ct=Object.freeze({__proto__:null,Abs:function(t,e=new y){return e.set(Math.abs(t.x),Math.abs(t.y),Math.abs(t.z))},Add:tt,AddScalar:function(t,e,n=new y){return n.set(t.x+e,t.y+e,t.z+e)},Angle:function(t,e){const{x:n,y:r,z:i}=t,{x:s,y:o,z:a}=e,h=Math.sqrt(n*n+r*r+i*i)*Math.sqrt(s*s+o*o+a*a),u=h&&et(t,e)/h;return Math.acos(Math.min(Math.max(u,-1),1))},Backward:U,Bezier:function(t,e,n,r,i,s=new y){return s.set(nt(i,t.x,e.x,n.x,r.x),nt(i,t.y,e.y,n.y,r.y),nt(i,t.z,e.z,n.z,r.z))},CatmullRom:function(t,e,n,r,i,s=new y){return s.set(rt(i,t.x,e.x,n.x,r.x),rt(i,t.y,e.y,n.y,r.y),rt(i,t.z,e.z,n.z,r.z))},Ceil:function(t,e=new y){return e.set(Math.ceil(t.x),Math.ceil(t.y),Math.ceil(t.z))},Center:function(t,e,n=new y){return tt(t,e,n),it(n,.5,n)},Clamp:function(t,e,n,r=new y){return r.set(st(t.x,e.x,n.x),st(t.y,e.y,n.y),st(t.z,e.z,n.z))},ClampLength:function(t,e,n,r=new y){const i=at(t);return ot(t,i||1,r),it(r,st(e,n,i),r)},ClampScalar:function(t,e,n,r=new y){return r.set(st(t.x,e,n),st(t.y,e,n),st(t.z,e,n))},Clone:function(t){const{x:e,y:n,z:r}=t;return new y(e,n,r)},CopyFrom:function(t,e){const{x:n,y:r,z:i}=t;return e.set(n,r,i)},Cross:function(t,e,n=new y){const{x:r,y:i,z:s}=t,{x:o,y:a,z:h}=e;return n.set(i*h-s*a,s*o-r*h,r*a-i*o)},CrossNormalize:ht,Distance:function(t,e){return Math.sqrt(ut(t,e))},DistanceSquared:ut,Divide:function(t,e,n=new y){return n.set(t.x/e.x,t.y/e.y,t.z/e.z)},DivideScalar:ot,Dot:et,Down:V,Equals:function(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z},Floor:function(t,e=new y){return e.set(Math.floor(t.x),Math.floor(t.y),Math.floor(t.z))},Forward:N,Fract:function(t,e=new y){return e.set(t.x-Math.floor(t.x),t.y-Math.floor(t.y),t.z-Math.floor(t.z))},FuzzyEquals:function(t,e,n=1e-4){return ct(t.x,e.x,n)&&ct(t.y,e.y,n)&&ct(t.z,e.z,n)},Hermite:function(t,e,n,r,i,s=new y){return s.set(lt(i,t.x,e.x,n.x,r.x),lt(i,t.y,e.y,n.y,r.y),lt(i,t.z,e.z,n.z,r.z))},Inverse:function(t,e=new y){return e.set(1/t.x,1/t.y,1/t.z)},IsNonUniform:function(t){const e=Math.abs(t.x),n=Math.abs(t.y),r=Math.abs(t.z);return e!==n||e!==r||n!==r},Left:j,Length:at,LengthSquared:function(t){const{x:e,y:n,z:r}=t;return e*e+n*n+r*r},Lerp:function(t,e,n,r=new y){const{x:i,y:s,z:o}=t;return r.set(i+n*(e.x-i),s+n*(e.y-s),o+n*(e.z-o))},ManhattanDistance:function(t,e){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)+Math.abs(t.z-e.z)},ManhattanLength:function(t){return Math.abs(t.x)+Math.abs(t.y)+Math.abs(t.z)},Max:function(t,e,n=new y){const{x:r,y:i,z:s}=t,{x:o,y:a,z:h}=e;return n.set(Math.max(r,o),Math.max(i,a),Math.max(s,h))},Min:function(t,e,n=new y){const{x:r,y:i,z:s}=t,{x:o,y:a,z:h}=e;return n.set(Math.min(r,o),Math.min(i,a),Math.min(s,h))},Multiply:function(t,e,n=new y){return n.set(t.x*e.x,t.y*e.y,t.z*e.z)},MultiplyByFloats:function(t,e,n,r,i=new y){return i.set(t.x*e,t.y*n,t.z*r)},Negate:function(t,e=new y){return e.set(-t.x,-t.y,-t.z)},Normalize:dt,One:function(){return new y(1,1,1)},Project:function(t,e,n,r,i=new y){const{x:s,y:o,width:a,height:h}=r;return xt.set(a/2,0,0,0,0,-h/2,0,0,0,0,.5,0,s+a/2,h/2+o,.5,1),b(e,n,yt),b(yt,xt,yt),ft(t,yt,i)},Random:function(t,e=1,n=new y){const r=2*Math.random()*Math.PI,i=2*Math.random()-1,s=Math.sqrt(1-i*i)*e;return n.set(Math.cos(r)*s,Math.sin(r)*s,i*e)},Reflect:function(t,e,n=new y){return it(e,2*et(t,e),n),wt(t,n,n)},RGBCallback:mt,Right:W,RotateX:function(t,e,n,r=new y){const{x:i,y:s,z:o}=t,{x:a,y:h,z:u}=e,c=s-h,l=o-u,d=i-a,f=c*Math.cos(n)-l*Math.sin(n),x=c*Math.sin(n)+l*Math.cos(n);return r.set(d+a,f+h,x+u)},RotateY:function(t,e,n,r=new y){const{x:i,y:s,z:o}=t,{x:a,y:h,z:u}=e,c=i-a,l=s-h,d=o-u,f=d*Math.sin(n)+c*Math.cos(n),x=l,p=d*Math.cos(n)-c*Math.sin(n);return r.set(f+a,x+h,p+u)},RotateZ:function(t,e,n,r=new y){const{x:i,y:s,z:o}=t,{x:a,y:h,z:u}=e,c=i-a,l=s-h,d=o-u,f=c*Math.cos(n)-l*Math.sin(n),x=c*Math.sin(n)+l*Math.cos(n),p=d;return r.set(f+a,x+h,p+u)},Round:function(t,e=new y){return e.set(Math.round(t.x),Math.round(t.y),Math.round(t.z))},RoundToZero:function(t,e=new y){return e.set(t.x<0?Math.ceil(t.x):Math.floor(t.x),t.y<0?Math.ceil(t.y):Math.floor(t.y),t.z<0?Math.ceil(t.z):Math.floor(t.z))},Scale:it,ScaleAndAdd:gt,SetFromCylindricalCoords:function(t,e,n,r=new y){return r.set(t*Math.sin(e),n,t*Math.cos(e))},SetFromSphericalCoords:function(t,e,n,r=new y){const i=Math.sin(e)*t;return r.set(i*Math.sin(n),Math.cos(e)*t,i*Math.cos(n))},SetLength:function(t,e,n=new y){return dt(t,n),it(n,e,n)},Subtract:wt,SubtractScalar:function(t,e,n=new y){return n.set(t.x-e,t.y-e,t.z-e)},TransformMat4:ft,TransformMat4Zero:Mt,TransformQuat:bt,Unproject:function(t,e,n,r,i,s,o=new y){b(r,i,vt),b(vt,s,vt),g(vt,vt);const{x:a,y:h,z:u}=t;_t.set(a/e*2-1,-(h/n*2-1),2*u-1),ft(_t,vt,o);const c=vt.data;return it(o,1/(_t.x*c[3]+_t.y*c[7]+_t.z*c[11]+c[15]),o)},Up:q,Vec3:y,Vec3Callback:pt,Zero:H,BACKWARD:J,DOWN:K,FORWARD:Z,LEFT:Y,RIGHT:$,UP:X,ZERO:Q});function zt(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w}function St(t,e){const{x:n,y:r,z:i,w:s}=t;return e.set(n,r,i,s)}function Et(t,e,n,r=new m){const i=.5*n,s=.5*e,o=.5*t,a=Math.sin(i),h=Math.cos(i),u=Math.sin(s),c=Math.cos(s),l=Math.sin(o),d=Math.cos(o);return r.set(d*u*h+l*c*a,l*c*h-d*u*a,d*c*a-l*u*h,d*c*h+l*u*a)}function Tt(t,e){const n=zt(t,e);return Math.acos(2*n*n-1)}function Rt(t){const{x:e,y:n,z:r,w:i}=t;return Math.sqrt(e*e+n*n+r*r+i*i)}function At(t,e,n=new m){const{x:r,y:i,z:s,w:o}=t;return n.set(r*e,i*e,s*e,o*e)}function Dt(t,e=new m){const n=Rt(t);return 0===n?e.set(0,0,0,1):At(t,n,e)}function Ft(t,e,n,r=new m){if(0===n)return St(t,r);if(1===n)return St(e,r);const{x:i,y:s,z:o,w:a}=t,{x:h,y:u,z:c,w:l}=e;let d=a*l+i*h+s*u+o*c;if(d<0?(r.set(-h,-u,-c,-l),d=-d):St(e,r),d>=1)return r.set(i,s,o,a);const f=1-d*d;if(f<=Number.EPSILON){const t=1-n;return r.set(t*i+n*r.x,t*s+n*r.y,t*o+n*r.z,t*a+n*r.w),Dt(r,r)}const x=Math.sqrt(f),y=Math.atan2(x,d),p=Math.sin((1-n)*y)/x,w=Math.sin(n*y)/x;return r.set(i*p+r.x*w,s*p+r.y*w,o*p+r.z*w,a*p+r.w*w)}function Pt(t,e,n=new m){e*=.5;const{x:r,y:i,z:s,w:o}=t,a=Math.sin(e),h=Math.cos(e);return n.set(r*h+o*a,i*h+s*a,s*h-i*a,o*h-r*a)}function It(t,e,n=new m){e*=.5;const{x:r,y:i,z:s,w:o}=t,a=Math.sin(e),h=Math.cos(e);return n.set(r*h-s*a,i*h+o*a,s*h+r*a,o*h-i*a)}function Ot(t,e,n=new m){e*=.5;const{x:r,y:i,z:s,w:o}=t,a=Math.sin(e),h=Math.cos(e);return n.set(r*h+i*a,i*h-r*a,s*h+o*a,o*h-s*a)}function Lt(t,e,n=new m){const{x:r,y:i,z:s}=t;e*=.5;const o=Math.sin(e);return n.set(r*o,i*o,s*o,Math.cos(e))}var kt=Object.freeze({__proto__:null,Add:function(t,e,n=new m){return n.set(t.x+e.x,t.y+e.y,t.z+e.z,t.w+e.w)},AddScalar:function(t,e,n=new m){return n.set(t.x+e,t.y+e,t.z+e,t.w+e)},AngleTo:function(t,e){return 2*Math.acos(Math.abs(st(zt(t,e),-1,1)))},AreClose:function(t,e){return zt(t,e)>=0},Clone:function(t){const{x:e,y:n,z:r,w:i}=t;return new m(e,n,r,i)},Conjugate:function(t,e=new m){const{x:n,y:r,z:i,w:s}=t;return e.set(-1*n,-1*r,-1*i,s)},CopyFrom:St,Dot:zt,Equals:function(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w},FromEulerAngles:function(t,e,n,r=new m){return Et(e,t,n,r)},FromEulerVector:function(t,e=new m){return Et(t.y,t.x,t.z,e)},FromRotationAxis:function(t,e,n=new m){const r=Math.sin(e/2);dt(t,t);const{x:i,y:s,z:o}=t;return n.set(i*r,s*r,o*r,Math.cos(e/2))},FromRotationMatrix:function(t,e=new m){const[n,r,i,s,o,a,h,u,c,l,d]=t.data,f=n+a+d;let x;return f>0?(x=.5/Math.sqrt(f+1),e.set((h-l)*x,(c-i)*x,(r-o)*x,.25/x)):n>a&&n>d?(x=2*Math.sqrt(1+n-a-d),e.set(.25*x,(o+r)/x,(c+i)/x,(h-l)/x)):a>d?(x=2*Math.sqrt(1+a-n-d),e.set((o+r)/x,.25*x,(l+h)/x,(c-i)/x)):(x=2*Math.sqrt(1+d-n-a),e.set((c+i)/x,(l+h)/x,.25*x,(r-o)/x))},FuzzyEquals:function(t,e,n=1e-4){return ct(t.x,e.x,n)&&ct(t.y,e.y,n)&&ct(t.z,e.z,n)&&ct(t.w,e.w,n)},GetAngle:Tt,GetAxisAngle:function(t,e=new m){const n=2*Math.acos(t.w),r=Math.sin(n/2);return r>1e-6?e.set(t.x/r,t.y/r,t.z/r):e.set(1,0,0),n},Hermite:function(t,e,n,r,i,s=new m){return s.set(lt(i,t.x,e.x,n.x,r.x),lt(i,t.y,e.y,n.y,r.y),lt(i,t.z,e.z,n.z,r.z),lt(i,t.w,e.w,n.w,r.w))},Invert:function(t,e=new m){const{x:n,y:r,z:i,w:s}=t,o=n*n+r*r+i*i+s*s,a=o?1/o:0;return e.set(-n*a,-r*a,-i*a,s*a)},Length:Rt,LengthSquared:function(t){const{x:e,y:n,z:r,w:i}=t;return e*e+n*n+r*r+i*i},Multiply:function(t,e,n=new m){const{x:r,y:i,z:s,w:o}=t,{x:a,y:h,z:u,w:c}=e;return n.set(r*c+o*a+i*u-s*h,i*c+o*h+s*a-r*u,s*c+o*u+r*h-i*a,o*c-r*a-i*h-s*u)},MultiplyByFloats:function(t,e,n,r,i,s=new m){return s.set(t.x*e,t.y*n,t.z*r,t.w*i)},Normalize:Dt,Quaternion:m,RotateTowards:function(t,e,n,r=new m){const i=Tt(t,e);return 0===i?St(t,r):Ft(t,e,Math.min(1,n/i),r)},RotateX:Pt,RotateY:It,RotateZ:Ot,RotationAlphaBetaGamma:function(t,e,n,r=new m){const i=.5*(n+t),s=.5*(n-t),o=.5*e;return r.set(Math.cos(s)*Math.sin(o),Math.sin(s)*Math.sin(o),Math.sin(i)*Math.cos(o),Math.cos(i)*Math.cos(o))},RotationYawPitchRoll:Et,Scale:At,ScaleAndAdd:function(t,e,n,r=new m){return r.set(t.x+e.x*n,t.y+e.y*n,t.z+e.z*n,t.w+e.w*n)},SetAxisAngle:Lt,SetFromUnitVectors:function(t,e,n,r=new m){const{x:i,y:s,z:o}=e,{x:a,y:h,z:u}=n;let c=et(e,n)+1;return c<1e-6?(c=0,Math.abs(i)>Math.abs(o)?r.set(-s,i,0,c):r.set(0,-o,s,c)):r.set(s*u-o*h,o*a-i*u,i*h-s*a,c)},Slerp:Ft,Subtract:function(t,e,n=new m){return n.set(t.x-e.x,t.y-e.y,t.z-e.z,t.w-e.w)},SubtractScalar:function(t,e,n=new m){const{x:r,y:i,z:s,w:o}=t;return n.set(r-e,i-e,s-e,o-e)},ToEulerAngles:function(t,e=new y){const{x:n,y:r,z:i,w:s}=t,o=s*s,a=i*i,h=n*n,u=r*r,c=r*i-n*s;return c<-.4999999?e.set(Math.PI/2,2*Math.atan2(r,s),0):c>.4999999?e.set(-Math.PI/2,2*Math.atan2(r,s),0):e.set(Math.asin(-2*(i*r-n*s)),Math.atan2(2*(i*n+r*s),a-h-u+o),Math.atan2(2*(n*r+i*s),-a-h+u+o))},Zero:function(){return new m(0,0,0,0)}});function Bt(t,e=1.70158){return t*t*((e+1)*t-e)}function Gt(t,e=1.70158){const n=1.525*e;return(t*=2)<1?t*t*((n+1)*t-n)*.5:.5*((t-=2)*t*((n+1)*t+n)+2)}function Ut(t,e=1.70158){return--t*t*((e+1)*t+e)+1}var Vt=Object.freeze({__proto__:null,In:Bt,InOut:Gt,Out:Ut});function Nt(t){return(t=1-t)<1/2.75?1-7.5625*t*t:t<2/2.75?1-(7.5625*(t-=1.5/2.75)*t+.75):t<2.5/2.75?1-(7.5625*(t-=2.25/2.75)*t+.9375):1-(7.5625*(t-=2.625/2.75)*t+.984375)}function jt(t){let e=!1;return t<.5?(t=1-2*t,e=!0):t=2*t-1,t<1/2.75?t*=7.5625*t:t=t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,e?.5*(1-t):.5*t+.5}function Wt(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}var qt=Object.freeze({__proto__:null,In:Nt,InOut:jt,Out:Wt});function Ht(t){return 1-Math.sqrt(1-t*t)}function Xt(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}function Kt(t){return Math.sqrt(1- --t*t)}var Yt=Object.freeze({__proto__:null,In:Ht,InOut:Xt,Out:Kt});function $t(t){return t*t*t}function Zt(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}function Jt(t){return--t*t*t+1}var Qt=Object.freeze({__proto__:null,In:$t,InOut:Zt,Out:Jt});function te(t,e=.1,n=.1){if(0===t)return 0;if(1===t)return 1;{let r=n/4;return e<1?e=1:r=n*Math.asin(1/e)/(2*Math.PI),-e*Math.pow(2,10*(t-=1))*Math.sin((t-r)*(2*Math.PI)/n)}}function ee(t,e=.1,n=.1){if(0===t)return 0;if(1===t)return 1;{let r=n/4;return e<1?e=1:r=n*Math.asin(1/e)/(2*Math.PI),(t*=2)<1?e*Math.pow(2,10*(t-=1))*Math.sin((t-r)*(2*Math.PI)/n)*-.5:e*Math.pow(2,-10*(t-=1))*Math.sin((t-r)*(2*Math.PI)/n)*.5+1}}function ne(t,e=.1,n=.1){if(0===t)return 0;if(1===t)return 1;{let r=n/4;return e<1?e=1:r=n*Math.asin(1/e)/(2*Math.PI),e*Math.pow(2,-10*t)*Math.sin((t-r)*(2*Math.PI)/n)+1}}var re=Object.freeze({__proto__:null,In:te,InOut:ee,Out:ne});function ie(t){return Math.pow(2,10*(t-1))-.001}function se(t){return 0==t?0:1==t?1:(t*=2)<1?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*(t-1)))}function oe(t){return 1-Math.pow(2,-10*t)}var ae=Object.freeze({__proto__:null,In:ie,InOut:se,Out:oe});function he(t){return t*t}function ue(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}function ce(t){return t*(2-t)}var le=Object.freeze({__proto__:null,In:he,InOut:ue,Out:ce});function de(t){return t*t*t*t}function fe(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}function xe(t){return-(--t*t*t*t-1)}var ye=Object.freeze({__proto__:null,In:de,InOut:fe,Out:xe});function pe(t){return t*t*t*t*t}function me(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}function we(t){return(t-=1)*t*t*t*t+1}var ge=Object.freeze({__proto__:null,In:pe,InOut:me,Out:we});function Me(t){return 0===t?0:1===t?1:1-Math.cos(t*Math.PI/2)}function be(t){return 0===t?0:1===t?1:.5*(1-Math.cos(Math.PI*t))}function ve(t){return 0===t?0:1===t?1:Math.sin(t*Math.PI/2)}var _e=Object.freeze({__proto__:null,In:Me,InOut:be,Out:ve});function Ce(t){return t}var ze=Object.freeze({__proto__:null,Linear:Ce});function Se(t,e=1){return t<=0?0:t>=1?1:1/e*(1+(e*t|0))}var Ee=Object.freeze({__proto__:null,Stepped:Se});const Te=new Map([["power0",Ce],["power1",ce],["power2",Jt],["power3",xe],["power4",we],["linear",Ce],["quad",ce],["cubic",Jt],["quart",xe],["quint",we],["sine",ve],["expo",oe],["circ",Kt],["elastic",ne],["back",Ut],["bounce",Wt],["stepped",Se],["quad.in",he],["cubic.in",$t],["quart.in",de],["quint.in",pe],["sine.in",Me],["expo.in",ie],["circ.in",Ht],["elastic.in",te],["back.in",Bt],["bounce.in",Nt],["quad.out",ce],["cubic.out",Jt],["quart.out",xe],["quint.out",we],["sine.out",ve],["expo.out",oe],["circ.out",Kt],["elastic.out",ne],["back.out",Ut],["bounce.out",Wt],["quad.inout",ue],["cubic.inout",Zt],["quart.inout",fe],["quint.inout",me],["sine.inout",be],["expo.inout",se],["circ.inout",Xt],["elastic.inout",ee],["back.inout",Gt],["bounce.inout",jt]]);var Re=Object.freeze({__proto__:null,GetEase:function(t){return t=(t=t.toLowerCase()).replace("ease",""),Te.has(t)?Te.get(t):Ce}}),Ae=Object.freeze({__proto__:null,Back:Vt,Bounce:qt,Circular:Yt,Cubic:Qt,Elastic:re,Expo:ae,GetEase:Re,Linear:ze,Quadratic:le,Quartic:ye,Quintic:ge,Sine:_e,Stepped:Ee});var De=Object.freeze({__proto__:null,FuzzyCeil:function(t,e=1e-4){return Math.ceil(t-e)},FuzzyEqual:ct,FuzzyFloor:function(t,e=1e-4){return Math.floor(t+e)},FuzzyGreaterThan:function(t,e,n=1e-4){return t>e-n},FuzzyLessThan:function(t,e,n=1e-4){return t<e+n}});function Fe(t){if(0===t)return 1;let e=t;for(;--t;)e*=t;return e}function Pe(t,e){return Fe(t)/Fe(e)/Fe(t-e)}function Ie(t,e,n){return(e-t)*n+t}function Oe(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)}function Le(t,e,n){return(t=Math.max(0,Math.min(1,(t-e)/(n-e))))*t*t*(t*(6*t-15)+10)}var ke=Object.freeze({__proto__:null,BezierInterpolation:function(t,e){let n=0;const r=t.length-1;for(let i=0;i<=r;i++)n+=Math.pow(1-e,r-i)*Math.pow(e,i)*t[i]*Pe(r,i);return n},CatmullRomInterpolation:function(t,e){const n=t.length-1;let r=n*e,i=Math.floor(r);return t[0]===t[n]?(e<0&&(i=Math.floor(r=n*(1+e))),rt(r-i,t[(i-1+n)%n],t[i],t[(i+1)%n],t[(i+2)%n])):e<0?t[0]-(rt(-r,t[0],t[0],t[1],t[1])-t[0]):e>1?t[n]-(rt(r-n,t[n],t[n],t[n-1],t[n-1])-t[n]):rt(r-i,t[i?i-1:0],t[i],t[n<i+1?n:i+1],t[n<i+2?n:i+2])},CubicBezierInterpolation:function(t,e,n,r,i){return function(t,e){const n=1-t;return n*n*n*e}(t,e)+function(t,e){const n=1-t;return 3*n*n*t*e}(t,n)+function(t,e){return 3*(1-t)*t*t*e}(t,r)+function(t,e){return t*t*t*e}(t,i)},LinearInterpolation:function(t,e){const n=t.length-1,r=n*e,i=Math.floor(r);return e<0?Ie(t[0],t[1],r):e>1?Ie(t[n],t[n-1],n-r):Ie(t[i],t[i+1>n?n:i+1],r-i)},QuadraticBezierInterpolation:function(t,e,n,r){return function(t,e){const n=1-t;return n*n*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,n)+function(t,e){return t*t*e}(t,r)},SmoothStepInterpolation:function(t,e,n){return e+(n-e)*Oe(t,0,1)},SmootherStepInterpolation:function(t,e,n){return e+(n-e)*Le(t,0,1)}});function Be(t,e,n=new E){const{a:r,b:i,c:s,d:o,tx:a,ty:h}=t,{a:u,b:c,c:l,d:d,tx:f,ty:x}=e;return n.set(u*r+c*s,u*i+c*o,l*r+d*s,l*i+d*o,f*r+x*s+a,f*i+x*o+h)}function Ge(t,e){const{a:n,b:r,c:i,d:s,tx:o,ty:a}=t;return e.set(n,r,i,s,o,a)}function Ue(t,e){return t.a===e.a&&t.b===e.b&&t.c===e.c&&t.d===e.d&&t.tx===e.tx&&t.ty===e.ty}function Ve(t,e,n=new E){const{a:r,b:i,c:s,d:o,tx:a,ty:h}=t,u=Math.sin(e),c=Math.cos(e);return n.set(r*c+s*u,i*c+o*u,r*-u+s*c,i*-u+o*c,a,h)}function Ne(t,e,n,r=new E){const{a:i,b:s,c:o,d:a,tx:h,ty:u}=t;return r.set(i*e,s*e,o*n,a*n,h,u)}function je(t,e,n,r=new E){const{a:i,b:s,c:o,d:a,tx:h,ty:u}=t;return r.tx=i*e+o*n+h,r.ty=s*e+a*n+u,r}function We(t,e,n,r=new A){const{a:i,b:s,c:o,d:a,tx:h,ty:u}=t,c=1/(i*a+o*-s);return r.set(a*c*e+-o*c*n+(u*o-h*a)*c,i*c*n+-s*c*e+(-u*i+h*s)*c)}var qe=Object.freeze({__proto__:null,Add:function(t,e,n=new E){return n.set(t.a+e.a,t.b+e.b,t.c+e.c,t.d+e.d,t.tx+e.tx,t.ty+e.ty)},Append:Be,Clone:function(t){return new E(t.a,t.b,t.c,t.d,t.tx,t.ty)},CopyFrom:Ge,CopyToContext:function(t,e){const{a:n,b:r,c:i,d:s,tx:o,ty:a}=t;return e.transform(n,r,i,s,o,a),e},Determinant:function(t){const{a:e,b:n,c:r,d:i}=t;return e*i-n*r},Equals:function(t,e,n=1e-6){const{a:r,b:i,c:s,d:o,tx:a,ty:h}=t,{a:u,b:c,c:l,d:d,tx:f,ty:x}=e;return Math.abs(r-u)<=n*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(i-c)<=n*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(s-l)<=n*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(o-d)<=n*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(a-f)<=n*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(h-x)<=n*Math.max(1,Math.abs(h),Math.abs(x))},ExactEquals:Ue,Frobenius:function(t){return Math.hypot(t.a,t.b,t.c,t.d,t.tx,t.ty,1)},FromRotation:function(t){const e=new E;return Ve(e,t,e)},FromScaling:function(t,e=t){const n=new E;return Ne(n,t,e,n)},FromTranslation:function(t,e){const n=new E;return je(n,t,e,n)},GlobalToLocal:We,Identity:function(){return new E},Invert:function(t,e=new E){const{a:n,b:r,c:i,d:s,tx:o,ty:a}=t;let h=n*s-r*i;return h&&(h=1/h,e.set(s*h,-r*h,-i*h,n*h,(i*a-s*o)*h,(r*o-n*a)*h)),e},ITRS:function(t,e,n,r,i,s){if(0===r)return t.set(1,0,0,1,e,n);{const o=Math.sin(r),a=Math.cos(r);return t.set(a*i,o*i,-o*s,a*s,e,n)}},ITRSS:function(t,e,n,r=0,i=1,s=1,o=0,a=0){return 0===r?t.set(1,0,0,1,e,n):t.set(Math.cos(r+a)*i,Math.sin(r+a)*i,-Math.sin(r-o)*s,Math.cos(r-o)*s,e,n)},LocalToGlobal:function(t,e,n,r=new A){const{a:i,b:s,c:o,d:a,tx:h,ty:u}=t;return r.set(i*e+o*n+h,s*e+a*n+u)},Matrix2D:E,Multiply:function(t,e,n=new E){const{a:r,b:i,c:s,d:o,tx:a,ty:h}=t,{a:u,b:c,c:l,d:d,tx:f,ty:x}=e;return n.set(r*u+s*c,i*u+o*c,r*l+s*d,i*l+o*d,r*f+s*x+a,i*f+o*x+h)},MultiplyScalar:function(t,e,n=new E){const{a:r,b:i,c:s,d:o,tx:a,ty:h}=t;return n.set(r*e,i*e,s*e,o*e,a*e,h*e)},MultiplyScalarAndAdd:function(t,e,n,r=new E){const{a:i,b:s,c:o,d:a,tx:h,ty:u}=e,{a:c,b:l,c:d,d:f,tx:x,ty:y}=t;return r.set(c+i*n,l+s*n,d+o*n,f+a*n,x+h*n,y+u*n)},Rotate:Ve,Scale:Ne,SetToContext:function(t,e){const{a:n,b:r,c:i,d:s,tx:o,ty:a}=t;return e.setTransform(n,r,i,s,o,a),e},Skew:function(t,e,n,r=new E){const{a:i,b:s,c:o,d:a,tx:h,ty:u}=t;return r.set(i,s+Math.tan(e),o+Math.tan(n),a,h,u)},Subtract:function(t,e,n=new E){return n.set(t.a-e.a,t.b-e.b,t.c-e.c,t.d-e.d,t.tx-e.tx,t.ty-e.ty)},Translate:je,Zero:function(t){return t.set(0,0,0,0,0,0)}});function He(t,e){return!(t<1||e<1)&&(0==(t&t-1)&&0==(e&e-1))}var Xe=Object.freeze({__proto__:null,GetPowerOfTwo:function(t){const e=Math.log(t)/.6931471805599453;return 1<<Math.ceil(e)},IsSizePowerOfTwo:He,IsValuePowerOfTwo:function(t){return t>0&&0==(t&t-1)}});var Ke=Object.freeze({__proto__:null,SnapCeil:function(t,e,n=0,r=!1){return 0===e?t:(t-=n,t=e*Math.ceil(t/e),r?(n+t)/e:n+t)},SnapFloor:function(t,e,n=0,r=!1){return 0===e?t:(t-=n,t=e*Math.floor(t/e),r?(n+t)/e:n+t)},SnapTo:function(t,e,n=0,r=!1){return 0===e?t:(t-=n,t=e*Math.round(t/e),r?(n+t)/e:n+t)}});function Ye(t,e,n=new A){return n.set(t.x+e.x,t.y+e.y)}function $e(t,e,n=new A){return n.set(t.x*e,t.y*e)}function Ze(t,e){const n=t.x-e.x,r=t.y-e.y;return n*n+r*r}function Je(t,e){return Math.sqrt(Ze(t,e))}function Qe(t,e){return t.x*e.x+t.y*e.y}function tn(t,e,n,r=new A){return r.set(t.x*e,t.y*n)}function en(t,e,n=new A){return n.set(t.x-e.x,t.y-e.y)}function nn(t,e,n=new A){return n.set(t.x/e,t.y/e)}function rn(t,e,n,r,i,s,o,a=new A){const h=Math.sin(i),u=Math.cos(i),c=u*s,l=h*s,d=-h*o,f=u*o,x=1/(c*f+d*-l);return a.set(f*x*t+-d*x*e+(r*d-n*f)*x,c*x*e+-l*x*t+(-r*c+n*l)*x)}function sn(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function on(t,e=new A){return nn(t,sn(t)||1,e)}var an=Object.freeze({__proto__:null,Abs:function(t,e=new A){return e.set(Math.abs(t.x),Math.abs(t.y))},Add:Ye,AddScalar:function(t,e,n=new A){return n.set(t.x+e,t.y+e)},Angle:function(t,e){return Math.atan2(e.y-t.y,e.x-t.x)},AngleY:function(t,e){return Math.atan2(e.x-t.x,e.y-t.y)},Bezier:function(t,e,n,r,i,s=new A){return s.set(nt(i,t.x,e.x,n.x,r.x),nt(i,t.y,e.y,n.y,r.y))},CatmullRom:function(t,e,n,r,i,s=new A){return s.set(rt(i,t.x,e.x,n.x,r.x),rt(i,t.y,e.y,n.y,r.y))},Ceil:function(t,e=new A){return e.set(Math.ceil(t.x),Math.ceil(t.y))},Center:function(t,e,n=new A){return Ye(t,e,n),$e(n,.5,n)},ChebyshevDistance:function(t,e){return Math.max(Math.abs(t.x-e.x),Math.abs(t.y-e.y))},Clamp:function(t,e,n,r=new A){return r.set(st(t.x,e.x,n.x),st(t.y,e.y,n.y))},ClampScalar:function(t,e,n,r=new A){return r.set(st(t.x,e,n),st(t.y,e,n))},Clone:function(t){return new A(t.x,t.y)},CopyFrom:function(t,e){return e.set(t.x,t.y)},Cross:function(t,e){return t.x*e.y-t.y*e.x},Distance:Je,DistanceFromSegment:function(t,e,n){if(0===Ze(e,n))return Je(t,e);const r=en(n,e);en(t,e,t);const i=Math.max(0,Math.min(1,Qe(t,r)/12));return Je(t,Ye(e,tn(r,i,i,r)))},DistancePower:function(t,e,n=2){return Math.sqrt(Math.pow(e.x-t.x,n)+Math.pow(e.y-t.y,n))},DistanceSquared:Ze,Divide:function(t,e,n=new A){return n.set(t.x/e.x,t.y/e.y)},DivideScalar:nn,Dot:Qe,Equals:function(t,e){return t.x===e.x&&t.y===e.y},Floor:function(t,e=new A){return e.set(Math.floor(t.x),Math.floor(t.y))},Fract:function(t,e=new A){return e.set(t.x-Math.floor(t.x),t.y-Math.floor(t.y))},FromGridIndex:function(t,e,n,r=new A){let i=0,s=0;return t>0&&t<=e*n&&(t>e-1?(s=Math.floor(t/e),i=t-s*e):i=t,r.set(i,s)),r},FromTransform:rn,FuzzyEquals:function(t,e,n=1e-4){return ct(t.x,e.x,n)&&ct(t.y,e.y,n)},Hermite:function(t,e,n,r,i,s=new A){return s.set(lt(i,t.x,e.x,n.x,r.x),lt(i,t.y,e.y,n.y,r.y))},Inverse:function(t,e=new A){return e.set(1/t.x,1/t.y)},Length:sn,LengthSquared:function(t){return t.x*t.x+t.y*t.y},Lerp:function(t,e,n,r=new A){const i=t.x,s=t.y;return r.set(i+n*(e.x-i),s+n*(e.y-s))},ManhattanDistance:function(t,e){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)},ManhattanLength:function(t){return Math.abs(t.x)+Math.abs(t.y)},Max:function(t,e,n=new A){const{x:r,y:i}=t,{x:s,y:o}=e;return n.set(Math.max(r,s),Math.max(i,o))},Min:function(t,e,n=new A){const{x:r,y:i}=t,{x:s,y:o}=e;return n.set(Math.min(r,s),Math.min(i,o))},Multiply:function(t,e,n=new A){return n.set(t.x*e.x,t.y*e.y)},MultiplyByFloats:tn,Negate:function(t,e=new A){return e.set(-t.x,-t.y)},Normalize:on,One:function(){return new A(1,1)},PerpDot:function(t,e){return t.x*e.y-t.y*e.x},Random:function(t,e=1,n=new A){const r=2*Math.random()*Math.PI;return n.set(Math.cos(r)*e,Math.sin(r)*e)},Rotate:function(t,e,n,r=new A){const i=Math.sin(n),s=Math.cos(n),o=t.x-e.x,a=t.y-e.y;return r.set(o*s-a*i+e.x,o*i+a*s+e.y)},Round:function(t,e=new A){return e.set(Math.round(t.x),Math.round(t.y))},RoundToZero:function(t,e=new A){return e.set(t.x<0?Math.ceil(t.x):Math.floor(t.x),t.y<0?Math.ceil(t.y):Math.floor(t.y))},Scale:$e,ScaleAndAdd:function(t,e,n,r=new A){return r.set(t.x+e.x*n,t.y+e.y*n)},SetLength:function(t,e,n=new A){return on(t,n),$e(n,e,n)},Subtract:en,SubtractScalar:function(t,e,n=new A){return n.set(t.x-e,t.y-e)},Transform:function(t,e,n,r,i,s,o=new A){return rn(t.x,t.y,e,n,r,i,s,o)},TransformMat2d:function(t,e,n=new A){const{a:r,b:i,c:s,d:o,tx:a,ty:h}=e;return n.set(r*t.x+s*t.y+a,i*t.x+o*t.y+h)},TransformMat4:function(t,e,n=new A){const r=e.data;return n.set(r[0]*t.x+r[4]*t.y+r[12],r[1]*t.x+r[5]*t.y+r[13])},Vec2:A,Vec2Callback:D,Zero:function(){return new A(0,0)}});class hn{constructor(t=0,e=0,n=0,r=1){this.set(t,e,n,r)}set(t=0,e=0,n=0,r=1){return this.x=t,this.y=e,this.z=n,this.w=r,this}toArray(t=[],e=0){const{x:n,y:r,z:i,w:s}=this;return t[e]=n,t[e+1]=r,t[e+2]=i,t[e+3]=s,t}fromArray(t,e=0){return this.set(t[e],t[e+1],t[e+2],t[e+3])}toString(){const{x:t,y:e,z:n,w:r}=this;return`{ x=${t}, y=${e}, z=${n}, w=${r} }`}}function un(t,e,n=new hn){return n.set(t.x+e.x,t.y+e.y,t.z+e.z,t.w+e.w)}function cn(t,e,n=new hn){const{x:r,y:i,z:s,w:o}=t;return n.set(r*e,i*e,s*e,o*e)}function ln(t,e,n=new hn){const{x:r,y:i,z:s,w:o}=t;return n.set(r/e,i/e,s/e,o/e)}function dn(t){const{x:e,y:n,z:r,w:i}=t;return Math.sqrt(e*e+n*n+r*r+i*i)}function fn(t,e){const n=t.x-e.x,r=t.y-e.y,i=t.z-e.z,s=t.w-e.w;return n*n+r*r+i*i+s*s}function xn(t,e=new hn){return ln(t,dn(t)||1,e)}class yn extends hn{constructor(t,e=0,n=0,r=0,i=0){super(e,n,r,i),this.onChange=t}destroy(){this.onChange=l}set(t=0,e=0,n=0,r=0){return this._x=t,this._y=e,this._z=n,this._w=r,this.onChange&&this.onChange(this),this}get x(){return this._x}set x(t){const e=this._x;this._x=t,e!==t&&this.onChange(this)}get y(){return this._y}set y(t){const e=this._y;this._y=t,e!==t&&this.onChange(this)}get z(){return this._z}set z(t){const e=this._z;this._z=t,e!==t&&this.onChange(this)}get w(){return this._w}set w(t){const e=this._w;this._w=t,e!==t&&this.onChange(this)}}var pn=Object.freeze({__proto__:null,Abs:function(t,e=new hn){return e.set(Math.abs(t.x),Math.abs(t.y),Math.abs(t.z),Math.abs(t.w))},Add:un,AddScalar:function(t,e,n=new hn){return n.set(t.x+e,t.y+e,t.z+e,t.w+e)},Bezier:function(t,e,n,r,i,s=new hn){return s.set(nt(i,t.x,e.x,n.x,r.x),nt(i,t.y,e.y,n.y,r.y),nt(i,t.z,e.z,n.z,r.z),nt(i,t.w,e.w,n.w,r.w))},CatmullRom:function(t,e,n,r,i,s=new hn){return s.set(rt(i,t.x,e.x,n.x,r.x),rt(i,t.y,e.y,n.y,r.y),rt(i,t.z,e.z,n.z,r.z),rt(i,t.w,e.w,n.w,r.w))},Ceil:function(t,e=new hn){const{x:n,y:r,z:i,w:s}=t;return e.set(Math.ceil(n),Math.ceil(r),Math.ceil(i),Math.ceil(s))},Center:function(t,e,n=new hn){return un(t,e,n),cn(n,.5,n)},Clamp:function(t,e,n,r=new hn){return r.set(st(t.x,e.x,n.x),st(t.y,e.y,n.y),st(t.z,e.z,n.z),st(t.w,e.w,n.w))},ClampLength:function(t,e,n,r=new hn){const i=dn(t);return ln(t,i||1,r),cn(r,st(e,n,i),r)},ClampScalar:function(t,e,n,r=new hn){return r.set(st(t.x,e,n),st(t.y,e,n),st(t.z,e,n),st(t.w,e,n))},Clone:function(t){const{x:e,y:n,z:r,w:i}=t;return new hn(e,n,r,i)},CopyFrom:function(t,e){const{x:n,y:r,z:i,w:s}=t;return e.set(n,r,i,s)},Cross:function(t,e,n,r=new hn){const{x:i,y:s,z:o,w:a}=t,{x:h,y:u,z:c,w:l}=e,{x:d,y:f,z:x,w:y}=n,p=h*f-u*d,m=h*x-c*d,w=h*y-l*d,g=u*x-c*f,M=u*y-l*f,b=c*y-l*x,v=i,_=s,C=o,z=a;return r.set(_*b-C*M+z*g,-v*b+C*w-z*m,v*M-_*w+z*p,-v*g+_*m-C*p)},Distance:function(t,e){return Math.sqrt(fn(t,e))},DistanceSquared:fn,Divide:function(t,e,n=new hn){return n.set(t.x/e.x,t.y/e.y,t.z/e.z,t.w/e.w)},DivideScalar:ln,Dot:function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w},Equals:function(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w},Floor:function(t,e=new hn){const{x:n,y:r,z:i,w:s}=t;return e.set(Math.floor(n),Math.floor(r),Math.floor(i),Math.floor(s))},Fract:function(t,e=new hn){return e.set(t.x-Math.floor(t.x),t.y-Math.floor(t.y),t.z-Math.floor(t.z),t.w-Math.floor(t.w))},FuzzyEquals:function(t,e,n=1e-4){return ct(t.x,e.x,n)&&ct(t.y,e.y,n)&&ct(t.z,e.z,n)&&ct(t.w,e.w,n)},Hermite:function(t,e,n,r,i,s=new hn){return s.set(lt(i,t.x,e.x,n.x,r.x),lt(i,t.y,e.y,n.y,r.y),lt(i,t.z,e.z,n.z,r.z),lt(i,t.w,e.w,n.w,r.w))},Length:dn,LengthSquared:function(t){const{x:e,y:n,z:r,w:i}=t;return e*e+n*n+r*r+i*i},Lerp:function(t,e,n,r=new hn){const{x:i,y:s,z:o,w:a}=t;return r.set(i+n*(e.x-i),s+n*(e.y-s),o+n*(e.z-o),a+n*(e.w-a))},ManhattanDistance:function(t,e){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)+Math.abs(t.z-e.z)+Math.abs(t.w-e.w)},ManhattanLength:function(t){const{x:e,y:n,z:r,w:i}=t;return Math.abs(e)+Math.abs(n)+Math.abs(r)+Math.abs(i)},Max:function(t,e,n=new hn){const{x:r,y:i,z:s,w:o}=t,{x:a,y:h,z:u,w:c}=e;return n.set(Math.max(r,a),Math.max(i,h),Math.max(s,u),Math.max(o,c))},Min:function(t,e,n=new hn){const{x:r,y:i,z:s,w:o}=t,{x:a,y:h,z:u,w:c}=e;return n.set(Math.min(r,a),Math.min(i,h),Math.min(s,u),Math.min(o,c))},Multiply:function(t,e,n=new hn){return n.set(t.x*e.x,t.y*e.y,t.z*e.z,t.w*e.w)},MultiplyByFloats:function(t,e,n,r,i,s=new hn){return s.set(t.x*e,t.y*n,t.z*r,t.w*i)},Negate:function(t,e=new hn){return e.set(-t.x,-t.y,-t.z,-t.w)},Normalize:xn,One:function(){return new hn(1,1,1,1)},RGBACallback:class extends yn{constructor(t,e=0,n=0,r=0,i=1){super(t,e,n,r,i)}set r(t){this.x=t}get r(){return this.x}set g(t){this.y=t}get g(){return this.y}set b(t){this.z=t}get b(){return this.z}set a(t){this.w=t}get a(){return this.w}toString(){const{x:t,y:e,z:n,w:r}=this;return`[ r=${t}, g=${e}, b=${n}, a=${r} ]`}},Random:function(t,e=1,n=new hn){let r,i,s,o,a,h;do{r=2*Math.random()-1,i=2*Math.random()-1,a=r*r+i*i}while(a>=1);do{s=2*Math.random()-1,o=2*Math.random()-1,h=s*s+o*o}while(h>=1);const u=Math.sqrt((1-a)/h);return n.set(e*r,e*i,e*s*u,e*o*u)},Round:function(t,e=new hn){const{x:n,y:r,z:i,w:s}=t;return e.set(Math.round(n),Math.round(r),Math.round(i),Math.round(s))},RoundToZero:function(t,e=new hn){const{x:n,y:r,z:i,w:s}=t;return e.set(n<0?Math.ceil(n):Math.floor(n),r<0?Math.ceil(r):Math.floor(r),i<0?Math.ceil(i):Math.floor(i),s<0?Math.ceil(s):Math.floor(s))},Scale:cn,ScaleAndAdd:function(t,e,n,r=new hn){return r.set(t.x+e.x*n,t.y+e.y*n,t.z+e.z*n,t.w+e.w*n)},SetLength:function(t,e,n=new hn){return xn(t,n),cn(n,e,n)},Subtract:function(t,e,n=new hn){return n.set(t.x-e.x,t.y-e.y,t.z-e.z,t.w-e.w)},SubtractScalar:function(t,e,n=new hn){const{x:r,y:i,z:s,w:o}=t;return n.set(r-e,i-e,s-e,o-e)},TransformMat4:function(t,e,n=new hn){const[r,i,s,o,a,h,u,c,l,d,f,x,y,p,m,w]=e.data,{x:g,y:M,z:b,w:v}=t;return n.set(r*g+a*M+l*b+y*v,i*g+h*M+d*b+p*v,s*g+u*M+f*b+m*v,o*g+c*M+x*b+w*v)},Vec4:hn,Vec4Callback:yn,Zero:function(){return new hn(0,0,0,0)}});function mn(t,e){return Math.floor(Math.random()*(e-t+1)+t)}function wn(t){return t*F.DEG_TO_RAD}function gn(t,e,n){return(n-e)*(t=st(t,0,1))}var Mn=Object.freeze({__proto__:null,Angle:L,Easing:Ae,Average:function(t){let e=0;for(let n=0;n<t.length;n++)e+=+t[n];return e/t.length},Bernstein:Pe,Between:mn,Bezier:nt,CatmullRom:rt,CeilTo:function(t,e=0,n=10){const r=Math.pow(n,-e);return Math.ceil(t*r)/r},Clamp:st,DegToRad:wn,Difference:function(t,e){return Math.abs(t-e)},Factorial:Fe,FloatBetween:function(t,e){return Math.random()*(e-t)+t},FloorTo:function(t,e=0,n=10){const r=Math.pow(n,-e);return Math.floor(t*r)/r},FromPercent:gn,Fuzzy:De,GetSpeed:function(t,e){return t/e/1e3},Hermite:lt,Interpolation:ke,Linear:Ie,MATH_CONST:F,Matrix2D:qe,Matrix4:S,MaxAdd:function(t,e,n){return Math.min(t+e,n)},MinSub:function(t,e,n){return Math.max(t-e,n)},Percent:function(t,e,n,r){void 0===n&&(n=e+1);let i=(t-e)/(n-e);return i>1?void 0!==r?(i=(r-t)/(r-n),i<0&&(i=0)):i=1:i<0&&(i=0),i},Pow2:Xe,Quaternion:kt,RadToDeg:function(t){return t*F.RAD_TO_DEG},RoundAwayFromZero:function(t){return t>0?Math.ceil(t):Math.floor(t)},RoundTo:function(t,e=0,n=10){const r=Math.pow(n,-e);return Math.round(t*r)/r},SinCosTableGenerator:function(t,e=1,n=1,r=1){r*=Math.PI/t;const i=[],s=[];for(let o=0;o<t;o++)e+=(n-=e*r)*r,i[o]=n,s[o]=e;return{sin:s,cos:i,length:t}},SmootherStep:Le,SmoothStep:Oe,Snap:Ke,Vec2:an,Vec3:Ct,Vec4:pn,Within:function(t,e,n){return Math.abs(t-e)<=n},Wrap:I});var bn=Object.freeze({__proto__:null,Camera3D:class{constructor(t=0,e=0,n=0,r=45,s=.1,o=1e3){this.dirtyRender=!0,this.type="Camera3D";const a=i();this.renderer=a.renderer,this.position=new pt(()=>this.update(),t,e,n),this.direction=new pt(()=>this.update(),0,1,0),this._lookAtPosition=new y,this._lookAtView=new d,this._axis=new m,this.up=q(),this.left=j(),this._fov=r,this._near=s,this._far=o,this.aspectRatio=this.renderer.width/this.renderer.height,this.viewMatrix=new d,this.projectionMatrix=_(wn(r),this.aspectRatio,s,o),this.lookAt(new y)}updateProjectionMatrix(){return _(wn(this._fov),this.aspectRatio,this._near,this._far,this.projectionMatrix),this}lookAt(t){const e=this.position,n=this.direction,r=this.left;return wt(t,e,n),dt(n,n),ht(X,n,r),ht(n,r,this.up),this.update()}rotateOnAxis(t,e){const n=this.direction,r=this.left,i=this.up,s=Lt(t,e,this._axis);return bt(n,s,n),bt(r,s,r),bt(i,s,i),dt(i,i),dt(r,r),dt(n,n),this.update()}yaw(t){return this.rotateOnAxis(this.up,t)}pitch(t){return this.rotateOnAxis(this.left,t)}roll(t){return this.rotateOnAxis(this.direction,t)}forward(t){const e=this.position,{x:n,y:r,z:i}=e,{x:s,y:o,z:a}=this.direction;return e.set(n-t*s,r-t*o,i-t*a),this.update()}update(){const t=this._lookAtPosition,e=this._lookAtView,n=this.position;return tt(n,this.direction,t),M(n,t,this.up,e),C(e,-n.x,-n.y,-n.z,this.viewMatrix),this}reset(){}destroy(){this.position.destroy(),this.direction.destroy(),this.up=null,this.left=null,this.viewMatrix=null,this.projectionMatrix=null,this._lookAtPosition=null,this._lookAtView=null,this._axis=null}get fov(){return this._fov}set fov(t){t>0&&t<180&&(this._fov=t,this.updateProjectionMatrix())}get near(){return this._near}set near(t){t>0&&(this._near=t,this.updateProjectionMatrix())}get far(){return this._far}set far(t){t>0&&(this._far=t,this.updateProjectionMatrix())}}});function vn(t){let e;return t&&("string"==typeof t?e=document.getElementById(t):"object"==typeof t&&1===t.nodeType&&(e=t)),e||(e=document.body),e}function _n(t){const e=document.readyState;if("complete"===e||"interactive"===e)return void t();const n=()=>{document.removeEventListener("deviceready",n,!0),document.removeEventListener("DOMContentLoaded",n,!0),window.removeEventListener("load",n,!0),t()};document.body?window.hasOwnProperty("cordova")?document.addEventListener("deviceready",n,!0):(document.addEventListener("DOMContentLoaded",n,!0),window.addEventListener("load",n,!0)):window.setTimeout(n,20)}function Cn(t){let e;try{return e=(new DOMParser).parseFromString(t,"text/xml"),e&&e.documentElement&&!e.getElementsByTagName("parsererror").length?e:null}catch(t){return null}}var zn=Object.freeze({__proto__:null,AddToDOM:function(t,e){return vn(e).appendChild(t),t},DOMContentLoaded:_n,GetElement:vn,ParseXML:Cn,RemoveFromDOM:function(t){t.parentNode&&t.parentNode.removeChild(t)}});let Sn;function En(t,e){return e||(Sn||(Sn=document.createElement("audio")),e=Sn),e&&""!==e.canPlayType(t)}function Tn(t){return En("audio/x-m4a",t)||En("audio/aac",t)}function Rn(t){return En('audio/mpeg; codecs="mp3"',t)}function An(t){return En('audio/ogg; codecs="vorbis"',t)}function Dn(t){return En('audio/ogg; codecs="opus"',t)||En('audio/webm; codecs="opus"',t)}function Fn(t){return En('audio/wav; codecs="1"',t)}function Pn(t){return En('audio/webm; codecs="vorbis"',t)}function In(){return window&&window.hasOwnProperty("Audio")}function On(){return window&&(window.hasOwnProperty("AudioContext")||window.hasOwnProperty("webkitAudioContext"))}function Ln(){const t={audioData:In(),m4a:!1,mp3:!1,ogg:!1,opus:!1,wav:!1,webAudio:On(),webm:!1};return t.audioData&&(t.m4a=Tn(),t.mp3=Rn(),t.ogg=An(),t.opus=Dn(),t.wav=Fn(),t.webm=Pn()),t}var kn=Object.freeze({__proto__:null,CanPlayAudioType:En,CanPlayM4A:Tn,CanPlayMP3:Rn,CanPlayOGG:An,CanPlayOpus:Dn,CanPlayWAV:Fn,CanPlayWebM:Pn,GetAudio:Ln,HasAudio:In,HasWebAudio:On});function Bn(){const t=/Chrome\/(\d+)/.test(navigator.userAgent);return{chrome:t,chromeVersion:t?parseInt(RegExp.$1,10):0}}function Gn(){return{edge:/Edge\/\d+/.test(navigator.userAgent)}}function Un(){const t=/Firefox\D+(\d+)/.test(navigator.userAgent);return{firefox:t,firefoxVersion:t?parseInt(RegExp.$1,10):0}}function Vn(){const t=/MSIE (\d+\.\d+);/.test(navigator.userAgent);return{ie:t,ieVersion:t?parseInt(RegExp.$1,10):0}}function Nn(){const t=navigator.userAgent,e={iOS:!1,iOSVersion:0,iPhone:!1,iPad:!1};if(/iP[ao]d|iPhone/i.test(t)){const n=/OS (\d+)/.exec(navigator.appVersion);e.iOS=!0,e.iOSVersion=parseInt(n[0],10),e.iPhone=t.toLowerCase().includes("iphone"),e.iPad=t.toLowerCase().includes("ipad")}return e}function jn(){const{iOS:t}=Nn();return{mobileSafari:navigator.userAgent.includes("AppleWebKit")&&t}}function Wn(){return{opera:navigator.userAgent.includes("Opera")}}function qn(){const t=navigator.userAgent;return/Windows Phone/i.test(t)||/IEMobile/i.test(t)}function Hn(){const t=navigator.userAgent;return{safari:t.includes("Safari")&&!qn(),safariVersion:/Version\/(\d+)\./.test(t)?parseInt(RegExp.$1,10):0}}function Xn(){return{silk:navigator.userAgent.includes("Silk")}}function Kn(){const t=/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(navigator.userAgent);return{trident:t,tridentVersion:t?parseInt(RegExp.$1,10):0,tridentIEVersion:t?parseInt(RegExp.$3,10):0}}function Yn(){const{chrome:t,chromeVersion:e}=Bn(),{edge:n}=Gn(),{firefox:r,firefoxVersion:i}=Un();let{ie:s,ieVersion:o}=Vn();const{mobileSafari:a}=jn(),{opera:h}=Wn(),{safari:u,safariVersion:c}=Hn(),{silk:l}=Xn(),{trident:d,tridentVersion:f,tridentIEVersion:x}=Kn();d&&(s=!0,o=x);return{chrome:t,chromeVersion:e,edge:n,firefox:r,firefoxVersion:i,ie:s,ieVersion:o,mobileSafari:a,opera:h,safari:u,safariVersion:c,silk:l,trident:d,tridentVersion:f}}var $n=Object.freeze({__proto__:null,GetBrowser:Yn,IsChrome:Bn,IsEdge:Gn,IsFirefox:Un,IsMobileSafari:jn,IsMSIE:Vn,IsOpera:Wn,IsSafari:Hn,IsSilk:Xn,IsTrident:Kn});function Zn(){return navigator.userAgent.includes("Android")}function Jn(){return navigator.userAgent.includes("CrOS")}function Qn(){return window.hasOwnProperty("cordova")}function tr(){return navigator.userAgent.includes("Crosswalk")}function er(){return window.hasOwnProperty("ejecta")}function nr(){const t=navigator.userAgent;return t.includes("Kindle")||/\bKF[A-Z][A-Z]+/.test(t)||/Silk.*Mobile Safari/.test(t)}function rr(){return navigator.userAgent.includes("Linux")}function ir(){const t=navigator.userAgent;return t.includes("Mac OS")&&!t.includes("like Mac OS")}function sr(){return"undefined"!=typeof process&&"object"==typeof process.versions&&process.versions.hasOwnProperty("node")}function or(){return sr()&&!!process.versions.hasOwnProperty("node-webkit")}function ar(){return navigator.hasOwnProperty("standalone")}function hr(){return navigator.userAgent.includes("Windows")}function ur(){const t=navigator.userAgent,{iOS:e,iOSVersion:n,iPad:r,iPhone:i}=Nn(),s={android:Zn(),chromeOS:Jn(),cordova:Qn(),crosswalk:tr(),desktop:!1,ejecta:er(),iOS:e,iOSVersion:n,iPad:r,iPhone:i,kindle:nr(),linux:rr(),macOS:ir(),node:sr(),nodeWebkit:or(),pixelRatio:1,webApp:ar(),windows:hr(),windowsPhone:qn()};s.windowsPhone&&(s.android=!1,s.iOS=!1,s.macOS=!1,s.windows=!0);const o=t.includes("Silk");return(s.windows||s.macOS||s.linux&&!o||s.chromeOS)&&(s.desktop=!0),(s.windowsPhone||/Windows NT/i.test(t)&&/Touch/i.test(t))&&(s.desktop=!1),s}var cr=Object.freeze({__proto__:null,GetOS:ur,IsAndroid:Zn,IsChromeOS:Jn,IsCordova:Qn,IsCrosswalk:tr,IsEjecta:er,IsiOS:Nn,IsKindle:nr,IsLinux:rr,IsMacOS:ir,IsNode:sr,IsNodeWebkit:or,IsWebApp:ar,IsWindows:hr,IsWindowsPhone:qn});let lr;function dr(t,e){return e||(lr||(lr=document.createElement("video")),e=lr),e&&""!==e.canPlayType(t)}function fr(t){return dr('video/mp4; codecs="avc1.42E01E"',t)}function xr(t){return dr('application/x-mpegURL; codecs="avc1.42E01E"',t)}function yr(t){return dr('video/ogg; codecs="theora"',t)}function pr(t){return dr('video/webm; codecs="vp9"',t)}function mr(t){return dr('video/webm; codecs="vp8, vorbis"',t)}function wr(){return{h264Video:fr(),hlsVideo:xr(),oggVideo:yr(),vp9Video:pr(),webmVideo:mr()}}var gr=Object.freeze({__proto__:null,CanPlayH264Video:fr,CanPlayHLSVideo:xr,CanPlayOGGVideo:yr,CanPlayVP9Video:pr,CanPlayVideoType:dr,CanPlayWebMVideo:mr,GetVideo:wr}),Mr=Object.freeze({__proto__:null,Audio:kn,Browser:$n,OS:cr,Video:gr,CanPlayAudioType:En,CanPlayM4A:Tn,CanPlayMP3:Rn,CanPlayOGG:An,CanPlayOpus:Dn,CanPlayWAV:Fn,CanPlayWebM:Pn,GetAudio:Ln,HasAudio:In,HasWebAudio:On,GetBrowser:Yn,IsChrome:Bn,IsEdge:Gn,IsFirefox:Un,IsMobileSafari:jn,IsMSIE:Vn,IsOpera:Wn,IsSafari:Hn,IsSilk:Xn,IsTrident:Kn,GetOS:ur,IsAndroid:Zn,IsChromeOS:Jn,IsCordova:Qn,IsCrosswalk:tr,IsEjecta:er,IsiOS:Nn,IsKindle:nr,IsLinux:rr,IsMacOS:ir,IsNode:sr,IsNodeWebkit:or,IsWebApp:ar,IsWindows:hr,IsWindowsPhone:qn,CanPlayH264Video:fr,CanPlayHLSVideo:xr,CanPlayOGGVideo:yr,CanPlayVP9Video:pr,CanPlayVideoType:dr,CanPlayWebMVideo:mr,GetVideo:wr});function br(t){const e=[t],n=[];for(;e.length>0;){const t=e.shift();n.push(t);const r=t.numChildren;if(r>0)for(let n=r-1;n>=0;n--)e.unshift(t.children[n])}return n.shift(),n}function vr(t,e){return t.children.indexOf(e)}function _r(t,e){const n=t.children;let r;if(e>=0&&e<n.length){const t=n.splice(e,1);t[0]&&(r=t[0],r.parent=null)}return r}function Cr(t,e){const n=vr(t,e);return n>-1&&_r(t,n),e}function zr(t,e,...n){if(0===t.events.size||!t.events.has(e))return!1;const r=t.events.get(e);for(const t of r)t.callback.apply(t.context,n),t.once&&r.delete(t);return 0===r.size&&t.events.delete(e),!0}function Sr(t,...e){return e.forEach(e=>{e.world&&(zr(e.world,"removedfromworld",e,e.world),zr(e,"removedfromworld",e,e.world)),e.world=t,zr(t,"addedtoworld",e,t),zr(e,"addedtoworld",e,t)}),e}function Er(t,...e){e.forEach(e=>{e.parent&&Cr(e.parent,e),e.parent=t});const n=t.world;return n&&Sr(n,...br(t)),e}function Tr(t,e){return t.children.push(e),Er(t,e),e.transform.updateWorld(),e}const Rr=1,Ar=4,Dr=16,Fr=32,Pr=64,Ir=51;function Or(t,e=[]){for(let n=0;n<t.numChildren;n++){const r=t.children[n],i=[];e.push({node:r,children:i}),r.numChildren>0&&Or(r,i)}return e}function Lr(t){return`${t.numChildren>0?"Parent":"Child"} [ type=${t.type}, name=${t.name} ]`}function kr(t,e=0,n){const r=t.children;void 0===n&&(n=r.length);const i=n-e;if(i>0&&i<=n){const t=r.splice(e,i);return t.forEach(t=>{t.parent=null}),t}return[]}function Br(t,e=0,n){kr(t,e,n).forEach(t=>{t.destroy()})}function Gr(t,e){return!(t.width<=0||t.height<=0||e.width<=0||e.height<=0)&&!(t.right<e.x||t.bottom<e.y||t.x>e.right||t.y>e.bottom)}function Ur(t,...e){return e.forEach(e=>{Cr(t,e)}),e}function Vr(t,e,n=0,r){const i=kr(t,n,r);return Er(e,...i),i.forEach(t=>{t.transform.updateWorld()}),i}var Nr=Object.freeze({__proto__:null,AddChild:Tr,AddChildAt:function(t,e,n){const r=t.children;return e>=0&&e<=r.length&&(Er(t,n),r.splice(e,0,n),n.transform.updateWorld()),n},AddChildren:function(t,...e){return e.forEach(e=>{Tr(t,e)}),e},AddChildrenAt:function(t,e,...n){const r=t.children;return e>=0&&e<=r.length&&n.reverse().forEach(r=>{n.splice(e,0,r),Er(t,r),r.transform.updateWorld()}),n},AddPosition:function(t,e,...n){return n.forEach(n=>{n.x+=t,n.y+=e}),n},AddRotation:function(t,...e){return e.forEach(e=>{e.rotation+=t}),e},AddScale:function(t,e,...n){return n.forEach(n=>{n.scaleX+=t,n.scaleY+=e}),n},AddSkew:function(t,e,...n){return n.forEach(n=>{n.skewX+=t,n.skewY+=e}),n},BringChildToTop:function(t,e){const n=t.children,r=vr(t,e);return-1!==r&&r<n.length&&(n.splice(r,1),n.push(e),e.setDirty(Rr)),e},ConsoleTreeChildren:function(t){const e=Or(t);t.world===t?console.group("World"):console.group(Lr(t)),e.forEach(t=>{t.children.length?function t(e){console.group(Lr(e.node)),e.children.forEach(e=>{e.children.length>0?t(e):console.log(Lr(e.node))}),console.groupEnd()}(t):console.log(Lr(t.node))}),console.groupEnd()},CountMatchingChildren:function(t,e,n){const r=t.children;let i=0;return r.forEach(t=>{const r=Object.getOwnPropertyDescriptor(t,e);!r||void 0!==n&&n!==r.value||i++}),i},DepthFirstSearch:br,DepthFirstSearchRecursive:function t(e,n=[]){for(let r=0;r<e.numChildren;r++){const i=e.children[r];n.push(i),i.numChildren>0&&t(i,n)}return n},DepthFirstSearchRecursiveNested:Or,DestroyChildren:Br,FindChildByName:function(t,e){const n=br(t),r=RegExp(e);for(let t=0;t<n.length;t++){const e=n[t];if(r.test(e.name))return e}},FindChildrenByName:function(t,e){const n=br(t),r=RegExp(e),i=[];return n.forEach(t=>{r.test(t.name)&&i.push(t)}),i},GetAllChildren:function(t,e,n){const r=br(t);if(!e)return r;const i=[];return r.forEach(t=>{const r=Object.getOwnPropertyDescriptor(t,e);!r||void 0!==n&&n!==r.value||i.push(t)}),i},GetChildAt:function(t,e){const n=t.children;if(e<0||e>n.length)throw new Error("Index out of bounds: "+e);return n[e]},GetChildIndex:vr,GetChildren:function(t,e,n){const r=t.children;if(!e)return[...r];const i=[];return r.forEach(t=>{const r=Object.getOwnPropertyDescriptor(t,e);!r||void 0!==n&&n!==r.value||i.push(t)}),i},GetClosestChild:function(t,e){const n=t.children;let r=null,i=0;return n.forEach(t=>{const n=Je(e,t.transform.position);(!r||n<i)&&(r=t,i=n)}),r},GetFirstChild:function(t,e,n){const r=t.children;for(let t=0;t<r.length;t++){const i=r[t],s=Object.getOwnPropertyDescriptor(i,e);if(s&&(void 0===n||n===s.value))return i}},GetFurthestChild:function(t,e){const n=t.children;let r=null,i=0;return n.forEach(t=>{const n=Je(e,t.transform.position);(!r||n>i)&&(r=t,i=n)}),r},GetLastChild:function(t,e,n){const r=t.children;for(let t=r.length-1;t>=0;t--){const i=r[t],s=Object.getOwnPropertyDescriptor(i,e);if(s&&(void 0===n||n===s.value))return i}},GetParents:function(t){const e=[];for(;t.parent;)e.push(t.parent),t=t.parent;return e},GetRandomChild:function(t,e=0,n){const r=t.children;return n||(n=r.length),r[e+Math.floor(Math.random()*n)]},MoveChildDown:function(t,e){const n=t.children,r=vr(t,e);if(r>0){const t=n[r-1],i=n.indexOf(t);n[r]=t,n[i]=e,e.setDirty(Rr),t.setDirty(Rr)}return e},MoveChildTo:function(t,e,n){const r=t.children,i=vr(t,e);if(-1===i||n<0||n>=r.length)throw new Error("Index out of bounds");return i!==n&&(r.splice(i,1),r.splice(n,0,e),e.setDirty(Rr)),e},MoveChildUp:function(t,e){const n=t.children,r=vr(t,e);if(-1!==r&&r>0){const t=n[r+1],i=n.indexOf(t);n[r]=t,n[i]=e,e.setDirty(Rr),t.setDirty(Rr)}return e},Overlap:function(t,...e){const n=t.bounds.get();for(let t=0;t<e.length;t++){if(Gr(n,e[t].bounds.get()))return!0}return!1},RemoveChild:Cr,RemoveChildAt:_r,RemoveChildren:Ur,RemoveChildrenAt:function(t,...e){const n=[];return e.sort((t,e)=>t-e),e.reverse().forEach(e=>{const r=_r(t,e);r&&n.push(r)}),n},RemoveChildrenBetween:kr,ReparentChildren:Vr,RotateChildrenLeft:function(t,e=1){const n=t.children;let r=null;for(let t=0;t<e;t++)r=n.shift(),n.push(r),r.setDirty(Rr);return r},RotateChildrenRight:function(t,e=1){const n=t.children;let r=null;for(let t=0;t<e;t++)r=n.pop(),n.unshift(r),r.setDirty(Rr);return r},SendChildToBack:function(t,e){const n=t.children,r=vr(t,e);return-1!==r&&r>0&&(n.splice(r,1),n.unshift(e),e.setDirty(Rr)),e},SetBounds:function(t,e,n,r,...i){return i.forEach(i=>{i.bounds.set(t,e,n,r)}),i},SetChildrenValue:function(t,e,n){const r=br(t);return r.forEach(t=>{const r=Object.getOwnPropertyDescriptor(t,e);r&&r.set(n)}),r},SetName:function(t,...e){return e.forEach(e=>{e.name=t}),e},SetOrigin:function(t,e,...n){return n.forEach(n=>{n.setOrigin(t,e)}),n},SetParent:Er,SetPosition:function(t,e,...n){return n.forEach(n=>{n.setPosition(t,e)}),n},SetRotation:function(t,...e){return e.forEach(e=>{e.rotation=t}),e},SetScale:function(t,e,...n){return n.forEach(n=>{n.setScale(t,e)}),n},SetSize:function(t,e,...n){return n.forEach(n=>{n.setSize(t,e)}),n},SetSkew:function(t,e,...n){return n.forEach(n=>{n.setSkew(t,e)}),n},SetType:function(t,...e){return e.forEach(e=>{e.type=t}),e},SetValue:function(t,e,...n){return n.forEach(n=>{const r=Object.getOwnPropertyDescriptor(n,t);r&&r.set(e)}),n},SetVisible:function(t,...e){return e.forEach(e=>{e.visible=t}),e},SetWorld:Sr,ShuffleChildren:function(t){const e=t.children;for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1)),r=e[t];e[t]=e[n],e[n]=r,r.setDirty(Rr)}return e},SwapChildren:function(t,e){if(t.parent===e.parent){const n=t.parent.children,r=vr(t.parent,t),i=vr(e.parent,e);r!==i&&(n[r]=e,n[i]=t)}}});function jr(t){const e=[t],n=[];for(;e.length>0;){const t=e.shift();n.push(t);const r=t.numChildren;if(r>0)for(let n=r-1;n>=0;n--)e.unshift(t.children[n])}return n.shift(),n}function Wr(t,e){return t.children.indexOf(e)}function qr(t,e){const n=t.children;let r;if(e>=0&&e<n.length){const t=n.splice(e,1);t[0]&&(r=t[0],r.parent=null)}return r}function Hr(t,e){const n=Wr(t,e);return n>-1&&qr(t,n),e}function Xr(t,...e){return e.forEach(e=>{e.world&&(zr(e.world,"removedfromworld",e,e.world),zr(e,"removedfromworld",e,e.world)),e.world=t,zr(t,"addedtoworld",e,t),zr(e,"addedtoworld",e,t)}),e}function Kr(t,...e){e.forEach(e=>{e.parent&&Hr(e.parent,e),e.parent=t});const n=t.world;return n&&Xr(n,...jr(t)),e}function Yr(t,e){return t.children.push(e),Kr(t,e),e}function $r(t,e,n){const r=t.children;return e>=0&&e<=r.length&&(Kr(t,n),r.splice(e,0,n)),n}function Zr(t,e=[]){for(let n=0;n<t.numChildren;n++){const r=t.children[n],i=[];e.push({node:r,children:i}),r.numChildren>0&&Zr(r,i)}return e}function Jr(t){return`${t.numChildren>0?"Parent":"Child"} [ type=${t.type}, name=${t.name} ]`}function Qr(t,e=0,n){const r=t.children;void 0===n&&(n=r.length);const i=n-e;if(i>0&&i<=n){const t=r.splice(e,i);return t.forEach(t=>{t.parent=null}),t}return[]}function ti(t,e,n){const r=t.children,i=Wr(t,e);if(-1===i||n<0||n>=r.length)throw new Error("Index out of bounds");return i!==n&&(r.splice(i,1),r.splice(n,0,e),e.setDirty(Rr)),e}function ei(t,...e){return e.forEach(e=>{Hr(t,e)}),e}var ni=Object.freeze({__proto__:null,AddChild3D:Yr,AddChild3DAt:$r,AddChildren3D:function(t,...e){return e.forEach(e=>{Yr(t,e)}),e},AddChildren3DAt:function(t,e,...n){const r=t.children;return e>=0&&e<=r.length&&n.reverse().forEach(r=>{n.splice(e,0,r),Kr(t,r)}),n},ConsoleTreeChildren3D:function(t){const e=Zr(t);t.world===t?console.group("World"):console.group(Jr(t)),e.forEach(t=>{t.children.length?function t(e){console.group(Jr(e.node)),e.children.forEach(e=>{e.children.length>0?t(e):console.log(Jr(e.node))}),console.groupEnd()}(t):console.log(Jr(t.node))}),console.groupEnd()},CountMatchingChildren3D:function(t,e,n){const r=t.children;let i=0;return r.forEach(t=>{const r=Object.getOwnPropertyDescriptor(t,e);!r||void 0!==n&&n!==r.value||i++}),i},DepthFirstSearch3D:jr,DepthFirstSearchRecursive3D:function t(e,n=[]){for(let r=0;r<e.numChildren;r++){const i=e.children[r];n.push(i),i.numChildren>0&&t(i,n)}return n},DepthFirstSearchRecursiveNested3D:Zr,DestroyChildren3D:function(t,e=0,n){Qr(t,e,n).forEach(t=>{t.destroy()})},FindChild3DByName:function(t,e){const n=jr(t),r=RegExp(e);for(let t=0;t<n.length;t++){const e=n[t];if(r.test(e.name))return e}},FindChildren3DByName:function(t,e){const n=jr(t),r=RegExp(e),i=[];return n.forEach(t=>{r.test(t.name)&&i.push(t)}),i},GetAllChildren3D:function(t,e,n){const r=jr(t);if(!e)return r;const i=[];return r.forEach(t=>{const r=Object.getOwnPropertyDescriptor(t,e);!r||void 0!==n&&n!==r.value||i.push(t)}),i},GetChild3DAt:function(t,e){const n=t.children;if(e<0||e>n.length)throw new Error("Index out of bounds: "+e);return n[e]},GetChild3DIndex:Wr,GetChildren3D:function(t,e,n){const r=t.children;if(!e)return[...r];const i=[];return r.forEach(t=>{const r=Object.getOwnPropertyDescriptor(t,e);!r||void 0!==n&&n!==r.value||i.push(t)}),i},GetFirstChild3D:function(t,e,n){const r=t.children;for(let t=0;t<r.length;t++){const i=r[t],s=Object.getOwnPropertyDescriptor(i,e);if(s&&(void 0===n||n===s.value))return i}},GetLastChild3D:function(t,e,n){const r=t.children;for(let t=r.length-1;t>=0;t--){const i=r[t],s=Object.getOwnPropertyDescriptor(i,e);if(s&&(void 0===n||n===s.value))return i}},GetParents3D:function(t){const e=[];for(;t.parent;)e.push(t.parent),t=t.parent;return e},GetRandomChild3D:function(t,e=0,n){const r=t.children;return n||(n=r.length),r[e+Math.floor(Math.random()*n)]},MoveChild3DTo:ti,RemoveChild3D:Hr,RemoveChild3DAt:qr,RemoveChildren3D:ei,RemoveChildren3DAt:function(t,...e){const n=[];return e.sort((t,e)=>t-e),e.reverse().forEach(e=>{const r=qr(t,e);r&&n.push(r)}),n},RemoveChildren3DBetween:Qr,ReparentChildren3D:function(t,e,n=0,r){const i=Qr(t,n,r);return Kr(e,...i),i.forEach(t=>{}),i},ReplaceChild3D:function(t,e){const n=t.parent,r=e.parent,i=Wr(n,t);return n===r?(ti(n,e,i),Hr(n,t)):(Hr(n,t),Hr(r,e),$r(n,i,e)),t},SetChildren3DValue:function(t,e,n){const r=jr(t);return r.forEach(t=>{const r=Object.getOwnPropertyDescriptor(t,e);r&&r.set(n)}),r},SetParent3D:Kr,SetWorld3D:Xr,SwapChildren3D:function(t,e){if(t.parent===e.parent){const n=t.parent.children,r=Wr(t.parent,t),i=Wr(e.parent,e);r!==i&&(n[r]=e,n[i]=t)}}});class ri{constructor(){this.events=new Map}}class ii{constructor(t,e,n=!1){this.callback=t,this.context=e,this.once=n}}function si(t,e,n,r,i){const s=t.events,o=s.get(e);if(n)if(n instanceof ii)o.delete(n);else{const t=!r,e=void 0!==i;for(const s of o)s.callback===n&&t&&s.context===r&&e&&s.once===i&&o.delete(s)}else s.delete(e);return 0===o.size&&s.delete(e),t}function oi(t,e,n,r=t,i=!1){if("function"!=typeof n)throw new TypeError("Listener not a function");const s=new ii(n,r,i),o=t.events.get(e);return o?o.add(s):t.events.set(e,new Set([s])),s}function ai(t,e,n,r=t){return oi(t,e,n,r,!0)}var hi=Object.freeze({__proto__:null,ClearEvent:function(t,e){return t.events.delete(e),t},Emit:zr,EventEmitter:ri,EventInstance:ii,GetEventNames:function(t){return[...t.events.keys()]},GetListenerCount:function(t,e){const n=t.events.get(e);return n?n.size:0},GetListeners:function(t,e){const n=[];return t.events.get(e).forEach(t=>{n.push(t.callback)}),n},Off:si,On:oi,Once:ai,RemoveAllListeners:function(t,e){e?t.events.delete(e):t.events.clear()}});function ui(t){const{a:e,b:n,c:r,d:i,tx:s,ty:o}=t.world,{x:a,y:h,right:u,bottom:c}=t.extent;return{x0:a*e+h*r+s,y0:a*n+h*i+o,x1:a*e+c*r+s,y1:a*n+c*i+o,x2:u*e+c*r+s,y2:u*n+c*i+o,x3:u*e+h*r+s,y3:u*n+h*i+o}}class ci{constructor(t){this.fixed=!1,this.includeChildren=!0,this.visibleOnly=!0,this.entity=t,this.area=new R}set(t,e,n,r){this.area.set(t,e,n,r)}get(){return this.entity.isDirty(Fr)&&!this.fixed&&this.update(),this.area}updateLocal(){const{x0:t,y0:e,x1:n,y1:r,x2:i,y2:s,x3:o,y3:a}=ui(this.entity.transform),h=Math.min(t,n,i,o),u=Math.min(e,r,s,a),c=Math.max(t,n,i,o),l=Math.max(e,r,s,a);return this.area.set(h,u,c-h,l-u)}update(){const t=this.updateLocal();if(this.entity.clearDirty(Fr),!this.includeChildren||!this.entity.numChildren)return t;const e=this.visibleOnly,n=this.entity.children;let r=t.x,i=t.y,s=t.right,o=t.bottom;for(let t=0;t<n.length;t++){const a=n[t];if(!a||e&&!a.visible)continue;const h=a.bounds.get();h.x<r&&(r=h.x),h.y<i&&(i=h.y),h.right>s&&(s=h.right),h.bottom>o&&(o=h.bottom)}return t.set(r,i,s-r,o-i)}destroy(){this.entity=null,this.area=null}}var li=Object.freeze({__proto__:null,BoundsComponent:ci});class di{constructor(t){this.enabled=!1,this.enabledChildren=!0,this.entity=t}destroy(){this.entity=null,this.hitArea=null}}var fi=Object.freeze({__proto__:null,InputComponent:di});function xi(t,e,n){return t.x=e-t.width/2,t.y=n-t.height/2,t}function yi(t){return t.x+t.width/2}function pi(t){return t.y+t.height/2}function mi(t,e){return!(e.width*e.height>t.width*t.height)&&(e.x>t.x&&e.x<t.right&&e.right>t.x&&e.right<t.right&&e.y>t.y&&e.y<t.bottom&&e.bottom>t.y&&e.bottom<t.bottom)}function wi(t,e=[]){return e.push(new A(t.x,t.y),new A(t.right,t.y),new A(t.right,t.bottom),new A(t.x,t.bottom)),e}function gi(t){return 0===t.height?NaN:t.width/t.height}class Mi{constructor(t=0,e=0,n=0,r=0){this.set(t,e,n,r)}set(t=0,e=0,n=0,r=0){return this.x1=t,this.y1=e,this.x2=n,this.y2=r,this}get left(){return Math.min(this.x1,this.x2)}set left(t){this.x1<=this.x2?this.x1=t:this.x2=t}get right(){return Math.max(this.x1,this.x2)}set right(t){this.x1>this.x2?this.x1=t:this.x2=t}get top(){return Math.min(this.y1,this.y2)}set top(t){this.y1<=this.y2?this.y1=t:this.y2=t}get bottom(){return Math.max(this.y1,this.y2)}set bottom(t){this.y1>this.y2?this.y1=t:this.y2=t}}function bi(t){const{x:e,y:n,right:r,bottom:i}=t;return[new Mi(e,n,r,n),new Mi(r,n,r,i),new Mi(r,i,e,i),new Mi(e,i,e,n)]}function vi(t){return 2*(t.width+t.height)}function _i(t,e,n=new A){if(e<=0||e>=1)return n.set(t.x,t.y);let r=vi(t)*e;return e>.5?(r-=t.width+t.height,r<=t.width?n.set(t.right-r,t.bottom):n.set(t.x,t.bottom-(r-t.width))):r<=t.width?n.set(t.x+r,t.y):n.set(t.right,t.y+(r-t.width))}var Ci=Object.freeze({__proto__:null,Area:function(t){return t.width*t.height},Ceil:function(t){return t.x=Math.ceil(t.x),t.y=Math.ceil(t.y),t},CeilAll:function(t){return t.x=Math.ceil(t.x),t.y=Math.ceil(t.y),t.width=Math.ceil(t.width),t.height=Math.ceil(t.height),t},CenterOn:xi,CenterX:yi,CenterY:pi,Clone:function(t){return new R(t.x,t.y,t.width,t.height)},Contains:T,ContainsPoint:function(t,e){return T(t,e.x,e.y)},ContainsRect:mi,CopyFrom:function(t,e){return e.set(t.x,t.y,t.width,t.height)},Decompose:wi,Equals:function(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height},FitInside:function(t,e){const n=gi(t);let r=e.width,i=e.height;return n<gi(e)?r=e.height*n:i=e.width/n,t.set(yi(e)-t.width/2,pi(e)-t.height/2,r,i)},FitOutside:function(t,e){const n=gi(t);let r=e.width,i=e.height;return n>gi(e)?r=e.height*n:i=e.width/n,t.set(yi(e)-t.width/2,pi(e)-t.height/2,r,i)},Floor:function(t){return t.x=Math.floor(t.x),t.y=Math.floor(t.y),t},FloorAll:function(t){return t.x=Math.floor(t.x),t.y=Math.floor(t.y),t.width=Math.floor(t.width),t.height=Math.floor(t.height),t},FromPoints:function(t,e=new R){if(0===t.length)return e;let n=Number.MAX_VALUE,r=Number.MAX_VALUE,i=F.MIN_SAFE_INTEGER,s=F.MIN_SAFE_INTEGER;for(let e=0;e<t.length;e++){const o=t[e].x,a=t[e].y;n=Math.min(n,o),r=Math.min(r,a),i=Math.max(i,o),s=Math.max(s,a)}return e.set(n,r,i-n,s-r)},GetAspectRatio:gi,GetCenter:function(t,e=new A){return e.set(yi(t),pi(t))},GetEdges:bi,GetPoint:_i,GetPoints:function(t,e,n=0,r=[]){n||(n=vi(t)/e);for(let e=0;e<n;e++)r.push(_i(t,e/n));return r},GetSize:function(t,e=new A){return e.set(t.width,t.height)},Inflate:function(t,e,n){const r=yi(t),i=pi(t);return t.width=t.width+2*e,t.height=t.height+2*n,xi(t,r,i)},Intersection:function(t,e,n=new R){return Gr(t,e)?n.set(Math.max(t.x,e.x),Math.max(t.y,e.y),Math.min(t.right,e.right)-n.x,Math.min(t.bottom,e.bottom)-n.y):n.set(),n},MarchingAnts:function(t,e,n,r=[]){if(!e&&!n)return r;e?n=Math.round(vi(t)/e):e=vi(t)/n;let i=t.x,s=t.y,o=0;for(let a=0;a<n;a++)switch(r.push(new A(i,s)),o){case 0:i+=e,i>=t.right&&(o=1,s+=i-t.right,i=t.right);break;case 1:s+=e,s>=t.bottom&&(o=2,i-=s-t.bottom,s=t.bottom);break;case 2:i-=e,i<=t.x&&(o=3,s-=t.x-i,i=t.x);break;case 3:s-=e,s<=t.y&&(o=0,s=t.y)}return r},MergePoints:function(t,e){let n=t.x,r=t.right,i=t.y,s=t.bottom;for(let t=0;t<e.length;t++)n=Math.min(n,e[t].x),r=Math.max(r,e[t].x),i=Math.min(i,e[t].y),s=Math.max(s,e[t].y);return t.set(n,i,r-n,s-i)},MergeRect:function(t,e){const n=Math.min(t.x,e.x),r=Math.max(t.right,e.right),i=Math.min(t.y,e.y),s=Math.max(t.bottom,e.bottom);return t.set(n,i,r-n,s-i)},MergeXY:function(t,e,n){const r=Math.min(t.x,e),i=Math.max(t.right,e),s=Math.min(t.y,n),o=Math.max(t.bottom,n);return t.set(r,s,i-r,o-s)},Offset:function(t,e,n){return t.x+=e,t.y+=n,t},OffsetPoint:function(t,e){return t.x+=e.x,t.y+=e.y,t},Overlaps:function(t,e){return t.x<e.right&&t.right>e.x&&t.y<e.bottom&&t.bottom>e.y},Perimeter:vi,PerimeterPoint:function(t,e,n=new A){e=wn(e);const r=Math.sin(e),i=Math.cos(e);let s=i>0?t.width/2:t.width/-2,o=r>0?t.height/2:t.height/-2;return Math.abs(s*r)<Math.abs(o*i)?o=s*r/i:s=o*i/r,n.set(s+yi(t),o+pi(t))},Random:function(t,e=new A){return e.set(t.x+Math.random()*t.width,t.y+Math.random()*t.height)},RandomOutside:function(t,e,n=new A){if(mi(t,e))switch(mn(0,3)){case 0:n.x=t.x+Math.random()*(e.right-t.x),n.y=t.y+Math.random()*(e.y-t.y);break;case 1:n.x=e.x+Math.random()*(t.right-e.x),n.y=e.bottom+Math.random()*(t.bottom-e.bottom);break;case 2:n.x=t.x+Math.random()*(e.x-t.x),n.y=e.y+Math.random()*(t.bottom-e.y);break;case 3:n.x=e.right+Math.random()*(t.right-e.right),n.y=t.y+Math.random()*(e.bottom-t.y)}return n},Rectangle:R,SameDimensions:function(t,e){return t.width===e.width&&t.height===e.height},Scale:function(t,e,n=e){return t.width*=e,t.height*=n,t},Union:function(t,e,n=new R){const r=Math.min(t.x,e.x),i=Math.min(t.y,e.y),s=Math.max(t.right,e.right)-r,o=Math.max(t.bottom,e.bottom)-i;return n.set(r,i,s,o)}});function zi(t){const e=t.local,n=t.position.x,r=t.position.y,i=t.rotation,s=t.scale.x,o=t.scale.y,a=t.skew.x,h=t.skew.y;e.set(Math.cos(i+h)*s,Math.sin(i+h)*s,-Math.sin(i-a)*o,Math.cos(i-a)*o,n,r)}function Si(t){const e=t.parent,n=t.transform,r=n.local,i=n.world;if(e)if(n.passthru)Ge(e.transform.world,i);else{const{a:t,b:n,c:s,d:o,tx:a,ty:h}=r,{a:u,b:c,c:l,d:d,tx:f,ty:x}=e.transform.world;i.set(t*u+n*l,t*c+n*d,s*u+o*l,s*c+o*d,a*u+h*l+f,a*c+h*d+x)}else Ge(r,i)}class Ei{constructor(t,e=0,n=0){this.passthru=!1,this._rotation=0,this.entity=t,this.local=new E,this.world=new E,this.position=new D(()=>this.update(),e,n),this.scale=new D(()=>this.update(),1,1),this.skew=new D(()=>this.update()),this.origin=new D(()=>this.updateExtent(),.5,.5),this.extent=new R}update(){this.updateLocal(),this.updateWorld()}updateLocal(){this.entity.setDirty(Rr,Fr),zi(this)}updateWorld(){const t=this.entity;t.setDirty(Rr,Fr),Si(t),t.numChildren&&this.updateChildren()}updateChildren(){const t=this.entity.children;for(let e=0;e<t.length;e++){t[e].transform.updateWorld()}}globalToLocal(t,e,n=new A){const{a:r,b:i,c:s,d:o,tx:a,ty:h}=this.world,u=1/(r*o+s*-i);return n.x=o*u*t+-s*u*e+(h*s-a*o)*u,n.y=r*u*e+-i*u*t+(-h*r+a*i)*u,n}localToGlobal(t,e,n=new A){const{a:r,b:i,c:s,d:o,tx:a,ty:h}=this.world;return n.x=r*t+s*e+a,n.y=i*t+o*e+h,n}setExtent(t,e,n,r){this.extent.set(t,e,n,r),this.entity.setDirty(Rr,Fr)}updateExtent(t,e){const n=this.extent,r=this.entity;void 0!==t&&(n.width=t),void 0!==e&&(n.height=e),n.x=-this.origin.x*n.width,n.y=-this.origin.y*n.height,r.setDirty(Rr,Fr)}set rotation(t){t!==this._rotation&&(this._rotation=t,this.update())}get rotation(){return this._rotation}destroy(){this.position.destroy(),this.scale.destroy(),this.skew.destroy(),this.origin.destroy(),this.entity=null,this.local=null,this.world=null,this.position=null,this.scale=null,this.skew=null,this.origin=null,this.extent=null}}var Ti=Object.freeze({__proto__:null,GetVertices:ui,TransformComponent:Ei,UpdateLocalTransform:zi,UpdateWorldTransform:Si});function Ri(t,e){return((255&(255*e|0))<<24|t)>>>0}class Ai{constructor(t=0,e=0,n=0){this.x=0,this.y=0,this.z=0,this.u=0,this.v=0,this.texture=0,this.tint=16777215,this.alpha=1,this.color=4294967295,this.x=t,this.y=e,this.z=n}setPosition(t,e,n=0){return this.x=t,this.y=e,this.z=n,this}setUV(t,e){return this.u=t,this.v=e,this}setColor(t,e=1){return this.tint=t,this.alpha=e,this.packColor(),this}setAlpha(t){return this.alpha=t,this}setTint(t){return this.tint=t,this}packColor(){this.color=Ri(this.tint,this.alpha)}}var Di=Object.freeze({__proto__:null,Bounds:li,Input:fi,Transform:Ti,Vertex:Ai});let Fi;const Pi={get:()=>Fi,set:t=>{Fi=t}};function Ii(t,e){if(!e&&!(e=t.currentViewport))return;const n=Fi.getParameter(Fi.VIEWPORT);n[0]===e.x&&n[1]===e.y&&n[2]===e.width&&n[3]===e.height||Fi.viewport(e.x,e.y,e.width,e.height)}function Oi(t,e=0,n=0,r=0,i=0){const s=function(t,e=0,n=0,r=0,i=0){const s=new R(e,n,r,i);return t.viewportStack.push(s),s}(t,e,n,r,i);Ii(t,s),t.currentViewport=s}function Li(t,e=!0,n){n||(n=t.currentFramebuffer);const{framebuffer:r,viewport:i}=n;Fi.bindFramebuffer(Fi.FRAMEBUFFER,r),e&&(Fi.clearColor(0,0,0,0),Fi.clear(Fi.COLOR_BUFFER_BIT|Fi.DEPTH_BUFFER_BIT)),i&&Oi(t,i.x,i.y,i.width,i.height)}function ki(t){const e=t.framebufferStack;e.length>1&&(t.currentFramebuffer.viewport&&function(t){const e=t.viewportStack;e.length>1&&e.pop(),t.currentViewport=e[e.length-1],Ii(t)}(t),e.pop()),t.currentFramebuffer=e[e.length-1],Li(t,!1)}function Bi(t,e,n=!0,r){const i=function(t,e,n){const r={framebuffer:e,viewport:n};return t.framebufferStack.push(r),r}(t,e,r);Li(t,n,i),t.currentFramebuffer=i}function Gi(t,e){e&&(t.count=e);const n=t.count;return 0!==n&&(function(t){const e=t.count;if(0===e)return;const n=t.currentVertexBuffer,r=t.currentShader,i=r.shader.renderToFramebuffer;if(i&&Bi(t,r.shader.framebuffer,!0),e===n.batchSize){const t=n.isDynamic?Fi.DYNAMIC_DRAW:Fi.STATIC_DRAW;Fi.bufferData(Fi.ARRAY_BUFFER,n.data,t)}else{const t=n.indexed?e*n.entryElementSize:e*n.vertexElementSize,r=n.vertexViewF32.subarray(0,t);Fi.bufferSubData(Fi.ARRAY_BUFFER,0,r)}n.indexed?Fi.drawElements(Fi.TRIANGLES,e*n.entryIndexSize,Fi.UNSIGNED_SHORT,0):Fi.drawArrays(Fi.TRIANGLES,0,e),i&&ki(t)}(t),t.prevCount=n,t.count=0,t.flushTotal++,!0)}function Ui(t,e=0){const n=t.currentVertexBuffer;t.count+e>=n.batchSize&&Gi(t);const r=n.indexed?t.count*n.entryElementSize:t.count*n.vertexElementSize;return t.count+=e,{buffer:n,F32:n.vertexViewF32,U32:n.vertexViewU32,offset:r}}function Vi(t,e){const n=e.binding,r=t.currentActiveTexture;return n.indexCounter<t.startActiveTexture&&(n.indexCounter=t.startActiveTexture,r<t.maxTextures?(n.setIndex(r),Fi.activeTexture(Fi.TEXTURE0+r),Fi.bindTexture(Fi.TEXTURE_2D,n.texture),t.currentActiveTexture++):(Gi(t),t.startActiveTexture++,n.indexCounter=t.startActiveTexture,n.setIndex(1),Fi.activeTexture(Fi.TEXTURE1),Fi.bindTexture(Fi.TEXTURE_2D,n.texture),t.currentActiveTexture=2)),n.index}class Ni{constructor(t=0,e=0){this.type="GameObject",this.name="",this.willUpdate=!0,this.willUpdateChildren=!0,this.willRender=!0,this.willRenderChildren=!0,this.willCacheChildren=!1,this.dirty=0,this.dirtyFrame=0,this.visible=!0,this.children=[],this.events=new Map,this.transform=new Ei(this,t,e),this.bounds=new ci(this),this.input=new di(this),this.dirty=Ir,this.transform.update()}isRenderable(){return this.visible&&this.willRender}isDirty(t){return 0!=(this.dirty&t)}clearDirty(t){return this.isDirty(t)&&(this.dirty^=t),this}setDirty(t,e){return this.isDirty(t)||(this.dirty^=t,this.dirtyFrame=o()),this.isDirty(e)||(this.dirty^=e),this}update(t,e){if(this.willUpdateChildren){const n=this.children;for(let r=0;r<n.length;r++){const i=n[r];i&&i.willUpdate&&i.update(t,e)}}this.postUpdate(t,e)}postUpdate(t,e){}renderGL(t){}renderCanvas(t){}postRenderGL(t){}postRenderCanvas(t){}get numChildren(){return this.children.length}destroy(t){t?Vr(this,t):Br(this),zr(this,"destroy",this),this.transform.destroy(),this.bounds.destroy(),this.input.destroy(),this.events.clear(),this.world=null,this.parent=null,this.children=null}}class ji extends Ni{constructor(t=0,e=0){super(t,e),this._alpha=1,this.type="Container"}setSize(t,e=t){return this.transform.updateExtent(t,e),this}setPosition(t,e){return this.transform.position.set(t,e),this}setOrigin(t,e=t){return this.transform.origin.set(t,e),this}setSkew(t,e=t){return this.transform.skew.set(t,e),this}setScale(t,e=t){return this.transform.scale.set(t,e),this}setRotation(t){return this.transform.rotation=t,this}set width(t){this.transform.updateExtent(t)}get width(){return this.transform.extent.width}set height(t){this.transform.updateExtent(void 0,t)}get height(){return this.transform.extent.height}set x(t){this.transform.position.x=t}get x(){return this.transform.position.x}set y(t){this.transform.position.y=t}get y(){return this.transform.position.y}set originX(t){this.transform.origin.x=t}get originX(){return this.transform.origin.x}set originY(t){this.transform.origin.y=t}get originY(){return this.transform.origin.y}set skewX(t){this.transform.skew.x=t}get skewX(){return this.transform.skew.x}set skewY(t){this.transform.skew.y=t}get skewY(){return this.transform.skew.y}set scaleX(t){this.transform.scale.x=t}get scaleX(){return this.transform.scale.x}set scaleY(t){this.transform.scale.y=t}get scaleY(){return this.transform.scale.y}set rotation(t){this.transform.rotation=t}get rotation(){return this.transform.rotation}get alpha(){return this._alpha}set alpha(t){t!==this._alpha&&(this._alpha=t,this.setDirty(Rr))}}function Wi(t){return t.vertices.forEach(t=>{t.packColor()}),t}function qi(t,e,...n){const r=t.getFrame(e),{u0:i,u1:s,v0:o,v1:a,pivot:h}=r;return n.forEach(t=>{if(!t||r===t.frame)return;t.frame=r,h&&t.setOrigin(h.x,h.y),t.frame.setExtent(t),t.hasTexture=!0;const e=t.vertices;e[0].setUV(i,o),e[1].setUV(i,a),e[2].setUV(s,a),e[3].setUV(s,o)}),n}const Hi=[],Xi=(t,e)=>{Hi.push({texture:t,glConfig:e})},Ki=()=>Hi,Yi=()=>{Hi.length=0};class $i{constructor(t,e,n,r,i,s){this.trimmed=!1,this.texture=t,this.key=e,this.x=n,this.y=r,this.width=i,this.height=s,this.sourceSizeWidth=i,this.sourceSizeHeight=s,this.updateUVs()}setPivot(t,e){this.pivot={x:t,y:e}}setSize(t,e){this.width=t,this.height=e,this.sourceSizeWidth=t,this.sourceSizeHeight=e,this.updateUVs()}setSourceSize(t,e){this.sourceSizeWidth=t,this.sourceSizeHeight=e}setTrim(t,e,n,r,i,s){this.trimmed=!0,this.sourceSizeWidth=t,this.sourceSizeHeight=e,this.spriteSourceSizeX=n,this.spriteSourceSizeY=r,this.spriteSourceSizeWidth=i,this.spriteSourceSizeHeight=s}getExtent(t,e){const n=this.sourceSizeWidth,r=this.sourceSizeHeight;let i,s,o,a;return this.trimmed?(i=this.spriteSourceSizeX-t*n,s=i+this.spriteSourceSizeWidth,o=this.spriteSourceSizeY-e*r,a=o+this.spriteSourceSizeHeight):(i=-t*n,s=i+n,o=-e*r,a=o+r),{left:i,right:s,top:o,bottom:a}}setExtent(t){const e=t.transform,n=e.origin.x,r=e.origin.y,i=this.sourceSizeWidth,s=this.sourceSizeHeight;let o,a,h,u;this.trimmed?(o=this.spriteSourceSizeX-n*i,a=this.spriteSourceSizeY-r*s,h=this.spriteSourceSizeWidth,u=this.spriteSourceSizeHeight):(o=-n*i,a=-r*s,h=i,u=s),e.setExtent(o,a,h,u)}updateUVs(){const{x:t,y:e,width:n,height:r}=this,i=this.texture.width,s=this.texture.height;this.u0=t/i,this.v0=e/s,this.u1=(t+n)/i,this.v1=(e+r)/s}}class Zi{constructor(t,e,n,r){this.key="",t&&(e=t.width,n=t.height),this.image=t,this.width=e,this.height=n,this.frames=new Map,this.data={},this.addFrame("__BASE",0,0,e,n),Xi(this,r)}addFrame(t,e,n,r,i){if(this.frames.has(t))return null;const s=new $i(this,t,e,n,r,i);return this.frames.set(t,s),this.firstFrame&&"__BASE"!==this.firstFrame.key||(this.firstFrame=s),s}getFrame(t){if(!t)return this.firstFrame;t instanceof $i&&(t=t.key);let e=this.frames.get(t);return e||(console.warn("Frame missing: "+t),e=this.firstFrame),e}setSize(t,e){this.width=t,this.height=e;this.frames.get("__BASE").setSize(t,e)}destroy(){this.binding&&this.binding.destroy(),this.frames.clear(),this.data=null,this.image=null,this.firstFrame=null}}let Ji;const Qi=()=>Ji,ts=t=>{Ji=t};class es extends ji{constructor(t,e,n,r){super(t,e),this.hasTexture=!1,this._tint=16777215,this.type="Sprite",this.vertices=[new Ai,new Ai,new Ai,new Ai],this.setTexture(n,r)}setTexture(t,e){return function(t,e,...n){if(t){let r;r=t instanceof Zi?t:Qi().get(t),r?(n.forEach(t=>{t.texture=r}),qi(r,e,...n)):console.warn("Invalid Texture key: "+t)}else n.forEach(t=>{t.texture=null,t.frame=null,t.hasTexture=!1})}(t,e,this),this}setFrame(t){return qi(this.texture,t,this),this}isRenderable(){return this.visible&&this.willRender&&this.hasTexture&&this.alpha>0}preRender(){this.isDirty(Dr)&&(Wi(this),this.clearDirty(Dr)),this.isDirty(Rr)&&(!function(t){const e=t.vertices,{x0:n,y0:r,x1:i,y1:s,x2:o,y2:a,x3:h,y3:u}=ui(t.transform);e[0].setPosition(n,r),e[1].setPosition(i,s),e[2].setPosition(o,a),e[3].setPosition(h,u)}(this),this.clearDirty(Rr))}renderGL(t){this.preRender(),function(t,e){const{F32:n,U32:r,offset:i}=Ui(e,1),s=Vi(e,t.texture);let o=i;t.vertices.forEach(t=>{n[o+0]=t.x,n[o+1]=t.y,n[o+2]=t.u,n[o+3]=t.v,n[o+4]=s,r[o+5]=t.color,o+=6})}(this,t)}renderCanvas(t){this.preRender(),function(t,e){const n=t.frame;if(!n)return;const r=e.ctx,i=t.transform,{a:s,b:o,c:a,d:h,tx:u,ty:c}=i.world,{x:l,y:d}=i.extent;r.save(),r.setTransform(s,o,a,h,u,c),r.globalAlpha=t.alpha,r.drawImage(n.texture.image,n.x,n.y,n.width,n.height,l,d,n.width,n.height),r.restore()}(this,t)}get alpha(){return this._alpha}set alpha(t){t!==this._alpha&&(this._alpha=t,this.vertices.forEach(e=>{e.setAlpha(t)}),this.setDirty(Dr))}get tint(){return this._tint}set tint(t){t!==this._tint&&(this._tint=t,this.vertices.forEach(e=>{e.setTint(t)}),this.setDirty(Dr))}destroy(t){super.destroy(t),this.texture=null,this.frame=null,this.hasTexture=!1,this.vertices=[]}}function ns(t,e){e||(e=t.currentShader);e.shader.bind(t,e.textureID)&&e.shader.setAttributes(t)}function rs(t,e){e||(e=t.currentVertexBuffer);const n=e.indexed?e.indexBuffer:null;Fi.bindBuffer(Fi.ELEMENT_ARRAY_BUFFER,n),Fi.bindBuffer(Fi.ARRAY_BUFFER,e.vertexBuffer)}let is=0;function ss(){return is}const os=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function as(t){let e="";for(let n=0;n<t;++n)n>0&&(e+="\nelse "),n<t-1&&(e+=`if(test == ${n}.0){}`);return e}function hs(t){let e=function(t){const e=Fi.createShader(Fi.FRAGMENT_SHADER);for(;;){const n=os.replace(/%forloop%/gi,as(t));if(Fi.shaderSource(e,n),Fi.compileShader(e),Fi.getShaderParameter(e,Fi.COMPILE_STATUS))break;t=t/2|0}return t}(Fi.getParameter(Fi.MAX_TEXTURE_IMAGE_UNITS));const n=ss();0===n||n>0&&n>e?is=e:n>0&&n<e&&(e=Math.max(8,n));const r=t.tempTextures;r.length&&r.forEach(t=>{Fi.deleteTexture(t)});const i=[];for(let t=0;t<e;t++){const e=Fi.createTexture();Fi.activeTexture(Fi.TEXTURE0+t),Fi.bindTexture(Fi.TEXTURE_2D,e),Fi.texImage2D(Fi.TEXTURE_2D,0,Fi.RGBA,1,1,0,Fi.RGBA,Fi.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),r[t]=e,i.push(t)}t.maxTextures=e,t.textureIndex=i,t.currentActiveTexture=1}function us(t){const e=t.vertexBufferStack;e.length>1&&e.pop(),t.currentVertexBuffer=e[e.length-1],rs(t)}function cs(t,e){const n=function(t,e){return t.vertexBufferStack.push(e),e}(t,e);rs(t,n),t.currentVertexBuffer=n}function ls(t){const e=t.shaderStack;e.length>1&&e.pop(),t.currentShader=e[e.length-1],ns(t)}function ds(t){const{parent:e,flipY:n,unpackPremultiplyAlpha:r,minFilter:i,magFilter:s,wrapS:o,wrapT:a,generateMipmap:h,isPOT:u}=t,c=e.image;let l=e.width,d=e.height;const f=Fi.createTexture();return Fi.activeTexture(Fi.TEXTURE0),Fi.bindTexture(Fi.TEXTURE_2D,f),Fi.pixelStorei(Fi.UNPACK_FLIP_Y_WEBGL,n),Fi.pixelStorei(Fi.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),c?(Fi.texImage2D(Fi.TEXTURE_2D,0,Fi.RGBA,Fi.RGBA,Fi.UNSIGNED_BYTE,c),l=c.width,d=c.height):Fi.texImage2D(Fi.TEXTURE_2D,0,Fi.RGBA,l,d,0,Fi.RGBA,Fi.UNSIGNED_BYTE,null),Fi.texParameteri(Fi.TEXTURE_2D,Fi.TEXTURE_MIN_FILTER,i),Fi.texParameteri(Fi.TEXTURE_2D,Fi.TEXTURE_MAG_FILTER,s),Fi.texParameteri(Fi.TEXTURE_2D,Fi.TEXTURE_WRAP_S,o),Fi.texParameteri(Fi.TEXTURE_2D,Fi.TEXTURE_WRAP_T,a),h&&u&&Fi.generateMipmap(Fi.TEXTURE_2D),t.texture=f,f}function fs(t){Fi&&Fi.isFramebuffer(t)&&Fi.deleteFramebuffer(t)}function xs(t){Fi.isTexture(t)&&Fi.deleteTexture(t)}function ys(t,e=!0){Fi.activeTexture(Fi.TEXTURE0),Fi.bindTexture(Fi.TEXTURE_2D,t);const n=e?Fi.LINEAR:Fi.NEAREST;Fi.texParameteri(Fi.TEXTURE_2D,Fi.TEXTURE_MIN_FILTER,n),Fi.texParameteri(Fi.TEXTURE_2D,Fi.TEXTURE_MAG_FILTER,n)}function ps(t){const e=t.parent.image,n=e.width,r=e.height;return n>0&&r>0&&(Fi.activeTexture(Fi.TEXTURE0),Fi.bindTexture(Fi.TEXTURE_2D,t.texture),Fi.pixelStorei(Fi.UNPACK_FLIP_Y_WEBGL,t.flipY),Fi.texImage2D(Fi.TEXTURE_2D,0,Fi.RGBA,Fi.RGBA,Fi.UNSIGNED_BYTE,e)),t.texture}class ms{constructor(t,e={}){this.index=0,this.indexCounter=-1,this.dirtyIndex=!0,this.unpackPremultiplyAlpha=!0,this.flipY=!1,this.isPOT=!1,this.generateMipmap=!1,this.parent=t,this.isPOT=He(t.width,t.height);const{texture:n=null,framebuffer:r=null,depthbuffer:i=null,unpackPremultiplyAlpha:s=!0,minFilter:o=(this.isPOT?Fi.LINEAR_MIPMAP_LINEAR:Fi.LINEAR),magFilter:a=Fi.LINEAR,wrapS:h=Fi.CLAMP_TO_EDGE,wrapT:u=Fi.CLAMP_TO_EDGE,generateMipmap:c=this.isPOT,flipY:l=!1}=e;this.minFilter=o,this.magFilter=a,this.wrapS=h,this.wrapT=u,this.generateMipmap=c,this.flipY=l,this.unpackPremultiplyAlpha=s,r&&(this.framebuffer=r),i&&(this.depthbuffer=i),n?this.texture=n:ds(this)}setFilter(t){this.texture&&ys(this.texture,t)}create(){const t=this.texture;return t&&xs(t),ds(this)}update(){return this.texture?ps(this):ds(this)}setIndex(t){this.dirtyIndex=t!==this.index,this.index=t}destroy(){xs(this.texture),fs(this.framebuffer),this.parent=null,this.texture=null,this.framebuffer=null}}function ws(t){Fi.isBuffer(t)&&Fi.deleteBuffer(t)}class gs{constructor(t={}){this.indexed=!1,this.isDynamic=!1,this.count=0,this.offset=0;const{batchSize:e=1,dataSize:n=4,isDynamic:r=!0,elementsPerEntry:i=4,vertexElementSize:s=6}=t;this.batchSize=e,this.dataSize=n,this.vertexElementSize=s,this.isDynamic=r,this.elementsPerEntry=i,this.vertexByteSize=s*n,this.entryByteSize=this.vertexByteSize*i,this.bufferByteSize=e*this.entryByteSize,this.create()}resize(t){this.batchSize=t,this.bufferByteSize=t*this.entryByteSize,this.vertexBuffer&&ws(this.vertexBuffer),this.create()}create(){const t=new ArrayBuffer(this.bufferByteSize);this.data=t,this.vertexViewF32=new Float32Array(t),this.vertexViewU32=new Uint32Array(t),this.vertexBuffer=Fi.createBuffer(),Fi.bindBuffer(Fi.ARRAY_BUFFER,this.vertexBuffer);const e=this.isDynamic?Fi.DYNAMIC_DRAW:Fi.STATIC_DRAW;Fi.bufferData(Fi.ARRAY_BUFFER,t,e),Fi.bindBuffer(Fi.ARRAY_BUFFER,null)}add(t){this.count+=t,this.offset+=this.vertexElementSize*t}reset(){this.count=0,this.offset=0}canContain(t){return this.count+t<=this.batchSize}free(){return Math.max(0,1-this.count/this.batchSize)}bind(){Fi.bindBuffer(Fi.ELEMENT_ARRAY_BUFFER,null),Fi.bindBuffer(Fi.ARRAY_BUFFER,this.vertexBuffer)}destroy(){ws(this.vertexBuffer),this.data=null,this.vertexViewF32=null,this.vertexViewU32=null,this.vertexBuffer=null}}class Ms extends gs{constructor(t={}){super(t);const{indexSize:e=4,entryIndexSize:n=6,indexLayout:r=null}=t;this.indexed=!0,this.indexSize=e,this.entryIndexSize=n,this.entryElementSize=this.vertexElementSize*this.elementsPerEntry;const i=[];if(r){this.indexLayout=r;for(let t=0;t<this.batchSize*e;t+=e)for(let e=0;e<r.length;e++)i.push(t+r[e])}this.create(),this.createIndexBuffer(i)}createIndexBuffer(t){this.index=new Uint16Array(t),this.indexBuffer=Fi.createBuffer(),Fi.bindBuffer(Fi.ELEMENT_ARRAY_BUFFER,this.indexBuffer),Fi.bufferData(Fi.ELEMENT_ARRAY_BUFFER,this.index,Fi.STATIC_DRAW),Fi.bindBuffer(Fi.ELEMENT_ARRAY_BUFFER,null),t=[]}bind(){Fi.bindBuffer(Fi.ELEMENT_ARRAY_BUFFER,this.indexBuffer),Fi.bindBuffer(Fi.ARRAY_BUFFER,this.vertexBuffer)}destroy(){super.destroy(),ws(this.indexBuffer),this.index=null,this.indexLayout=null,this.indexBuffer=null}}function bs(...t){t.forEach(t=>{Fi.deleteShader(t)})}function vs(t,e){const n=Fi.createShader(e);Fi.shaderSource(n,t),Fi.compileShader(n);if(!Fi.getShaderParameter(n,Fi.COMPILE_STATUS)){const e=Fi.getShaderInfoLog(n),r=t.split("\n").map((t,e)=>`${e}: ${t}`);return console.error("Error compiling shader: "+e,r.join("\n")),Fi.deleteShader(n),null}return n}function _s(t,e,n=!1){switch(t.type){case Fi.INT:case Fi.BOOL:return n?t=>{Fi.uniform1iv(e,t)}:t=>{Fi.uniform1i(e,t)};case Fi.INT_VEC2:case Fi.BOOL_VEC2:return t=>{Fi.uniform2iv(e,t)};case Fi.INT_VEC3:case Fi.BOOL_VEC3:return t=>{Fi.uniform3iv(e,t)};case Fi.INT_VEC4:case Fi.BOOL_VEC4:return t=>{Fi.uniform4iv(e,t)};case Fi.FLOAT:return n?t=>{Fi.uniform1fv(e,t)}:t=>{Fi.uniform1f(e,t)};case Fi.FLOAT_VEC2:return t=>{Fi.uniform2fv(e,t)};case Fi.FLOAT_VEC3:return t=>{Fi.uniform3fv(e,t)};case Fi.FLOAT_VEC4:return t=>{Fi.uniform4fv(e,t)};case Fi.FLOAT_MAT2:return t=>{Fi.uniformMatrix2fv(e,!1,t)};case Fi.FLOAT_MAT3:return t=>{Fi.uniformMatrix3fv(e,!1,t)};case Fi.FLOAT_MAT4:return t=>{Fi.uniformMatrix4fv(e,!1,t)};case Fi.SAMPLER_2D:case Fi.SAMPLER_CUBE:return t.size>1?t=>{Fi.uniform1iv(e,t)}:t=>{Fi.uniform1i(e,t)}}}const Cs={aVertexPosition:{size:2,type:5126,normalized:!1,offset:0},aTextureCoord:{size:2,type:5126,normalized:!1,offset:8},aTextureId:{size:1,type:5126,normalized:!1,offset:16},aTintColor:{size:4,type:5121,normalized:!0,offset:20}},zs={uProjectionMatrix:new Float32Array,uCameraMatrix:new Float32Array,uTexture:0};function Ss(){return 800}function Es(){return 600}function Ts(){return 1}function Rs(t,e,n){Fi.bindFramebuffer(Fi.FRAMEBUFFER,t);const r=Fi.createRenderbuffer();return Fi.bindRenderbuffer(Fi.RENDERBUFFER,r),Fi.renderbufferStorage(Fi.RENDERBUFFER,Fi.DEPTH_COMPONENT16,e,n),Fi.framebufferRenderbuffer(Fi.FRAMEBUFFER,Fi.DEPTH_ATTACHMENT,Fi.RENDERBUFFER,r),Fi.bindFramebuffer(Fi.FRAMEBUFFER,null),r}function As(t,e){e||(e=Fi.COLOR_ATTACHMENT0);const n=Fi.createFramebuffer();return Fi.bindFramebuffer(Fi.FRAMEBUFFER,n),Fi.framebufferTexture2D(Fi.FRAMEBUFFER,e,Fi.TEXTURE_2D,t,0),Fi.bindFramebuffer(Fi.FRAMEBUFFER,null),n}const Ds="#define SHADER_NAME SINGLE_QUAD_FRAG\n\nprecision highp float;\n\nvarying vec2 vTextureCoord;\nvarying float vTextureId;\nvarying vec4 vTintColor;\n\nuniform sampler2D uTexture;\n\nvoid main (void)\n{\n    vec4 color = texture2D(uTexture, vTextureCoord);\n\n    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);\n}",Fs="#define SHADER_NAME SINGLE_QUAD_VERT\n\nprecision highp float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute float aTextureId;\nattribute vec4 aTintColor;\n\nuniform mat4 uProjectionMatrix;\nuniform mat4 uCameraMatrix;\n\nvarying vec2 vTextureCoord;\nvarying float vTextureId;\nvarying vec4 vTintColor;\n\nvoid main (void)\n{\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vTintColor = aTintColor;\n\n    gl_Position = uProjectionMatrix * uCameraMatrix * vec4(aVertexPosition, 0.0, 1.0);\n}";class Ps{constructor(t){this.renderToFramebuffer=!1,this.renderToDepthbuffer=!1,t&&this.fromConfig(t)}fromConfig(t){const{attributes:e=Cs,fragmentShader:n=Ds,height:r=Es(),renderToFramebuffer:i=!1,renderToDepthbuffer:s=!1,resolution:o=Ts(),vertexShader:a=Fs,width:h=Ss(),uniforms:u=zs}=t;if(this.create(n,a,u,e),i){this.renderToFramebuffer=!0;const t=new Zi(null,h*o,r*o),e=new ms(t);t.binding=e,e.framebuffer=As(e.texture),s&&(this.renderToDepthbuffer=!0,e.depthbuffer=Rs(e.framebuffer,t.width,t.height)),this.texture=t,this.framebuffer=e.framebuffer}}create(t,e,n,r){const i=vs(t,Fi.FRAGMENT_SHADER),s=vs(e,Fi.VERTEX_SHADER);if(!i||!s)return;const o=function(...t){const e=Fi.createProgram();if(t.forEach(t=>{Fi.attachShader(e,t)}),Fi.linkProgram(e),!Fi.getProgramParameter(e,Fi.LINK_STATUS)){const n=Fi.getProgramInfoLog(e);return console.error("Error linking program: "+n),Fi.deleteProgram(e),bs(...t),null}return e}(i,s);if(!o)return;const a=Fi.getParameter(Fi.CURRENT_PROGRAM);Fi.useProgram(o),this.program=o,this.uniformSetters=function(t){const e=new Map,n=Fi.getProgramParameter(t,Fi.ACTIVE_UNIFORMS);for(let r=0;r<n;r++){const n=Fi.getActiveUniform(t,r);let i=n.name;if(i.startsWith("gl_")||i.startsWith("webgl_"))continue;const s=Fi.getUniformLocation(t,n.name);if(s){let t=!1;"[0]"===i.substr(-3)&&(i=i.substr(0,i.length-3),t=n.size>1),e.set(i,_s(n,s,t))}}return e}(o),this.uniforms=new Map;for(const[t,e]of Object.entries(n))this.uniforms.set(t,e);this.attributes=function(t,e){const n=new Map,r={size:1,type:Fi.FLOAT,normalized:!1,stride:0,offset:0},i=Fi.getProgramParameter(t,Fi.ACTIVE_ATTRIBUTES);for(let s=0;s<i;s++){const i=Fi.getActiveAttrib(t,s);if(!i)break;const o=i.name,a=Fi.getAttribLocation(t,o);Fi.enableVertexAttribArray(a);const h=e.hasOwnProperty(o)?e[o]:{},{size:u=r.size,type:c=r.type,normalized:l=r.normalized,stride:d=r.stride,offset:f=r.offset}=h;n.set(o,{index:a,size:u,type:c,normalized:l,stride:d,offset:f})}return n}(o,r),Fi.useProgram(a)}updateUniforms(t){}bind(t){return this.updateUniforms(t),this.setUniforms(t)}setUniform(t,e){const n=this.uniforms;if(n.has(t)){n.set(t,e);this.uniformSetters.get(t)(e)}}setUniforms(t){if(!this.program)return!1;Fi.useProgram(this.program);const e=this.uniforms;for(const[t,n]of this.uniformSetters.entries())n(e.get(t));return!0}setAttributes(t){if(this.program){const e=t.currentVertexBuffer.vertexByteSize;this.attributes.forEach(t=>{Fi.vertexAttribPointer(t.index,t.size,t.type,t.normalized,e,t.offset)})}}destroy(){bs(this.program),xs(this.texture),fs(this.framebuffer),this.uniforms.clear(),this.uniformSetters.clear(),this.attributes.clear(),this.program=null,this.texture=null,this.framebuffer=null}}class Is extends Ps{constructor(t={}){const e=t;e.attributes=e.attributes?e.attributes:Cs,super(e)}bind(t){const e=this.uniforms;return e.set("uProjectionMatrix",t.projectionMatrix.data),e.set("uCameraMatrix",t.cameraMatrix.data),super.bind(t)}}class Os extends Is{constructor(t={}){t.fragmentShader||(t.fragmentShader="#define SHADER_NAME MULTI_QUAD_FRAG\n\nprecision highp float;\n\nvarying vec2 vTextureCoord;\nvarying float vTextureId;\nvarying vec4 vTintColor;\n\nuniform sampler2D uTexture[%count%];\n\nvoid main (void)\n{\n    vec4 color;\n\n    %forloop%\n\n    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);\n}"),super(t)}create(t,e,n,r){const i=ss();let s="";for(let t=1;t<i;t++)t>1&&(s+="\n\telse "),t<i-1&&(s+=`if (vTextureId < ${t}.5)`),s+="\n\t{",s+=`\n\t\tcolor = texture2D(uTexture[${t}], vTextureCoord);`,s+="\n\t}";t=(t=t.replace(/%count%/gi,""+i)).replace(/%forloop%/gi,s),super.create(t,e,n,r)}bind(t){return this.uniforms.set("uTexture",t.textureIndex),super.bind(t)}}class Ls{constructor(t){this.count=0,this.prevCount=0,this.flushTotal=0,this.maxTextures=0,this.currentActiveTexture=0,this.startActiveTexture=0,this.tempTextures=[],this.textureIndex=[],this.framebufferStack=[],this.currentFramebuffer=null,this.defaultFramebuffer=null,this.vertexBufferStack=[],this.currentVertexBuffer=null,this.defaultVertexBuffer=null,this.shaderStack=[],this.currentShader=null,this.defaultShader=null,this.viewportStack=[],this.currentViewport=null,this.defaultViewport=null,this.blendModeStack=[],this.currentBlendMode=null,this.defaultBlendMode=null,this.renderer=t,this.projectionMatrix=new d,this.reset()}reset(){const t=this.renderer.gl,e=[0,1,2,2,3,0];var n,r;this.quadShader=new Is,this.quadBuffer=new Ms({isDynamic:!1,indexLayout:e}),this.quadCamera=new B,hs(this),function(t,e=null,n){const r={framebuffer:e,viewport:n};t.framebufferStack[0]=r,t.currentFramebuffer=r,t.defaultFramebuffer=r}(this),function(t,e,n,r){const i={enable:e,sfactor:n,dfactor:r};t.blendModeStack[0]=i,t.currentBlendMode=i,t.defaultBlendMode=i}(this,!0,t.ONE,t.ONE_MINUS_SRC_ALPHA),n=this,r=new Ms({batchSize:4096,indexLayout:e}),n.vertexBufferStack[0]=r,n.currentVertexBuffer=r,n.defaultVertexBuffer=r,function(t,e,n){const r={shader:e,textureID:n};t.shaderStack[0]=r,t.currentShader=r,t.defaultShader=r}(this,new Os)}resize(t,e){v(0,t,e,0,-1e3,1e3,this.projectionMatrix),this.quadCamera.reset(),function(t,e=0,n=0,r=0,i=0){const s=new R(e,n,r,i);t.viewportStack[0]=s,t.currentViewport=s,t.defaultViewport=s}(this,0,0,t,e)}}function ks(t,e,n){const r=function(t,e,n){const r={shader:e,textureID:n};return t.shaderStack.push(r),r}(t,e,n);ns(t,r),t.currentShader=r}function Bs(t){t.current2DCamera=t.quadCamera,t.cameraMatrix=t.quadCamera.matrix,t.count=0,t.flushTotal=0,Li(t,!1,t.defaultFramebuffer),function(t,e){e||(e=t.currentBlendMode),e.enable?(Fi.enable(Fi.BLEND),Fi.blendFunc(e.sfactor,e.dfactor)):Fi.disable(Fi.BLEND)}(t,t.defaultBlendMode),Ii(t,t.defaultViewport),rs(t,t.defaultVertexBuffer)}function Gs(t,e,n){n||(n=t.quadShader);const{u0:r,v0:i,u1:s,v1:o}=e.firstFrame;!function(t,e=0){const n=t.binding;n.setIndex(e),Fi.activeTexture(Fi.TEXTURE0+e),Fi.bindTexture(Fi.TEXTURE_2D,n.texture)}(e,0),cs(t,t.quadBuffer),ks(t,n,0),function(t,e,n,r,i,s,o,a,h,u=0,c=4294967295){const{F32:l,U32:d,offset:f}=Ui(t,1);l[f+0]=e,l[f+1]=n,l[f+2]=s,l[f+3]=h,l[f+4]=u,d[f+5]=c,l[f+6]=e,l[f+7]=n+i,l[f+8]=s,l[f+9]=o,l[f+10]=u,d[f+11]=c,l[f+12]=e+r,l[f+13]=n+i,l[f+14]=a,l[f+15]=o,l[f+16]=u,d[f+17]=c,l[f+18]=e+r,l[f+19]=n,l[f+20]=a,l[f+21]=h,l[f+22]=u,d[f+23]=c}(t,0,0,e.width,e.height,r,i,s,o,0),Gi(t),us(t),ls(t),function(t,e=0){Fi.activeTexture(Fi.TEXTURE0+e),Fi.bindTexture(Fi.TEXTURE_2D,t.tempTextures[e]),e>0&&t.startActiveTexture++}(t)}let Us=[];let Vs,Ns={alpha:!1,antialias:!1,depth:!0,premultipliedAlpha:!1};const js=t=>{Vs=t};class Ws extends Ni{constructor(){super(),this.type="Layer",this.transform.passthru=!0,this.willRender=!1}}class qs extends Ws{constructor(){super(),this.type="RenderLayer",this.willRender=!0,this.willRenderChildren=!0,this.willCacheChildren=!0,this.setDirty(Ar);const t=Ss(),e=Es(),n=Ts(),r=new Zi(null,t*n,e*n),i=new ms(r);r.binding=i,i.framebuffer=As(i.texture),this.texture=r,this.framebuffer=i.framebuffer}renderGL(t){this.numChildren>0&&(Gi(t),!this.willCacheChildren||this.isDirty(Ar)?(Bi(t,this.framebuffer,!0),this.clearDirty(Ar)):(Bi(t,this.framebuffer,!1),this.postRenderGL(t)))}postRenderGL(t){Gi(t),ki(t),Gs(t,this.texture),this.clearDirty(Rr)}}function Hs(t,e,n,r,i,s,o=0,a=1,h=1,u=0,c=0){const l=Math.cos(o+c)*a,d=Math.sin(o+c)*a,f=-Math.sin(o-u)*h,x=Math.cos(o-u)*h;return{x0:t*l+n*f+i,y0:t*d+n*x+s,x1:t*l+r*f+i,y1:t*d+r*x+s,x2:e*l+r*f+i,y2:e*d+r*x+s,x3:e*l+n*f+i,y3:e*d+n*x+s}}function Xs(t,e){const n=document.createElement("canvas");return n.width=t,n.height=e,n.getContext("2d")}function Ks(t=32,e=32){const n=Xs(t,e);return new Zi(n.canvas)}var Ys=Object.freeze({__proto__:null,AnimatedSprite:class extends es{constructor(t,e,n,r){super(t,e,n,r),this.type="AnimatedSprite",this.anims=new Map,this.animData={currentAnim:"",currentFrames:[],frameIndex:0,animSpeed:0,nextFrameTime:0,repeatCount:0,isPlaying:!1,yoyo:!1,pendingStart:!1,playingForward:!0,delay:0,repeatDelay:0,onStart:null,onRepeat:null,onComplete:null}}stop(){const t=this.animData;t.isPlaying=!1,t.currentAnim="",t.onComplete&&t.onComplete(this,t.currentAnim)}nextFrame(){const t=this.animData;if(t.frameIndex++,t.frameIndex===t.currentFrames.length)if(t.yoyo)t.frameIndex--,t.playingForward=!1;else{if(!(-1===t.repeatCount||t.repeatCount>0))return t.frameIndex--,this.stop();t.frameIndex=0,-1!==t.repeatCount&&t.repeatCount--,t.onRepeat&&t.onRepeat(this,t.currentAnim),t.nextFrameTime+=t.repeatDelay}this.setFrame(t.currentFrames[t.frameIndex]),t.nextFrameTime+=t.animSpeed}prevFrame(){const t=this.animData;if(t.frameIndex--,-1===t.frameIndex){if(!(-1===t.repeatCount||t.repeatCount>0))return t.frameIndex=0,this.stop();t.frameIndex=0,t.playingForward=!0,-1!==t.repeatCount&&t.repeatCount--,t.onRepeat&&t.onRepeat(this,t.currentAnim),t.nextFrameTime+=t.repeatDelay}this.setFrame(t.currentFrames[t.frameIndex]),t.nextFrameTime+=t.animSpeed}update(t,e){super.update(t,e);const n=this.animData;n.isPlaying&&(n.nextFrameTime-=1e3*t,n.nextFrameTime=Math.max(n.nextFrameTime,0),0===n.nextFrameTime&&(n.pendingStart?(n.onStart&&n.onStart(this,n.currentAnim),n.pendingStart=!1,n.nextFrameTime=n.animSpeed):n.playingForward?this.nextFrame():this.prevFrame()))}get isPlaying(){return this.animData.isPlaying}get isPlayingForward(){return this.animData.isPlaying&&this.animData.playingForward}get currentAnimation(){return this.animData.currentAnim}destroy(t){super.destroy(t),this.anims.clear(),this.animData=null}},Components:Di,Container:ji,EffectLayer:class extends qs{constructor(...t){super(),this.shaders=[],this.type="EffectLayer",Array.isArray(t)&&(this.shaders=t)}postRenderGL(t){const e=this.shaders,n=this.texture;if(Gi(t),ki(t),0===e.length)Gs(t,n);else{let r=n;for(let n=0;n<e.length;n++){const i=e[n];Gs(t,r,i),r=i.texture}Gs(t,r)}this.clearDirty(Rr)}},Layer:Ws,RenderLayer:qs,GameObject:Ni,Sprite:es,SpriteBatch:class extends Ws{constructor(t,e){super(),this.glTextureIndex=0,this.hasTexture=!1,this.type="SpriteBatch",this.willRender=!0,this.setTexture(e),this.setMaxSize(t)}resetBuffers(){let t=[];for(let e=0;e<4*this.maxSize;e+=4)t.push(e+0,e+1,e+2,e+2,e+3,e+0);this.data=new ArrayBuffer(96*this.maxSize),this.index=new Uint16Array(t),this.vertexViewF32=new Float32Array(this.data),this.vertexViewU32=new Uint32Array(this.data),Fi&&(fs(this.vertexBuffer),fs(this.indexBuffer),this.vertexBuffer=Fi.createBuffer(),this.indexBuffer=Fi.createBuffer(),Fi.bindBuffer(Fi.ARRAY_BUFFER,this.vertexBuffer),Fi.bufferData(Fi.ARRAY_BUFFER,this.data,Fi.STATIC_DRAW),Fi.bindBuffer(Fi.ELEMENT_ARRAY_BUFFER,this.indexBuffer),Fi.bufferData(Fi.ELEMENT_ARRAY_BUFFER,this.index,Fi.STATIC_DRAW),Fi.bindBuffer(Fi.ARRAY_BUFFER,null)),t=[],this.count=0}setMaxSize(t){return this.maxSize=st(t,0,65535),this.resetBuffers(),this}setTexture(t){let e;return e=t instanceof Zi?t:Qi().get(t),e?(this.texture=e,this.hasTexture=!0,this.glTextureIndex=-1):console.warn("Invalid Texture key: "+t),this}isRenderable(){return this.visible&&this.willRender&&this.hasTexture&&this.count>0}clear(){return this.count=0,this}addToBatch(t,e,n,r,i,s,o,a,h,u){if(this.count>=this.maxSize)return console.warn("SpriteBatch full"),this;const{u0:c,u1:l,v0:d,v1:f}=t,x=this.vertexViewF32,y=this.vertexViewU32,p=24*this.count,m=this.texture.binding?this.texture.binding.index:0;return x[p+0]=n,x[p+1]=r,x[p+2]=c,x[p+3]=d,x[p+4]=m,y[p+5]=e,x[p+6]=i,x[p+7]=s,x[p+8]=c,x[p+9]=f,x[p+10]=m,y[p+11]=e,x[p+12]=o,x[p+13]=a,x[p+14]=l,x[p+15]=f,x[p+16]=m,y[p+17]=e,x[p+18]=h,x[p+19]=u,x[p+20]=l,x[p+21]=d,x[p+22]=m,y[p+23]=e,this.setDirty(Rr),this.count++,this}add(t){const{frame:e=null,x:n=0,y:r=0,rotation:i=0,scaleX:s=1,scaleY:o=1,skewX:a=0,skewY:h=0,originX:u=0,originY:c=0,alpha:l=1,tint:d=16777215}=t,f=this.texture.getFrame(e),{left:x,right:y,top:p,bottom:m}=f.getExtent(u,c),{x0:w,y0:g,x1:M,y1:b,x2:v,y2:_,x3:C,y3:z}=Hs(x,y,p,m,n,r,i,s,o,a,h),S=Ri(d,l);return this.addToBatch(f,S,w,g,M,b,v,_,C,z)}addXY(t,e,n){const r=this.texture.getFrame(n),{left:i,right:s,top:o,bottom:a}=r.getExtent(0,0),{x0:h,y0:u,x1:c,y1:l,x2:d,y2:f,x3:x,y3:y}=Hs(i,s,o,a,t,e);return this.addToBatch(r,4294967295,h,u,c,l,d,f,x,y)}updateTextureIndex(){const t=this.texture.binding.index;if(t===this.glTextureIndex)return;const e=this.vertexViewF32;this.glTextureIndex=t;for(let n=0;n<this.count;n++)e[24*n+4]=t,e[24*n+10]=t,e[24*n+16]=t,e[24*n+22]=t}renderGL(t){}destroy(){super.destroy(),fs(this.vertexBuffer),fs(this.indexBuffer),this.data=null,this.vertexViewF32=null,this.vertexViewU32=null,this.index=null,this.texture=null,this.hasTexture=!1}},Text:class extends es{constructor(t,e,n="",r,s){super(t,e,Ks()),this.splitRegExp=/(?:\r\n|\r|\n)/,this.padding={left:0,right:0,top:0,bottom:0},this.verticalAlign="ascent",this.lineSpacing=0,this.font="16px monospace",this.fillStyle="#fff",this.strokeStyle="",this.backgroundStyle="",this.cornerRadius=0,this.textAlign="left",this.textBaseline="alphabetic",this.lineWidth=0,this.lineDash=[],this.antialias=!1,this.type="Text";const o=i();this.resolution=o.renderer.resolution,this.canvas=this.texture.image,this.context=this.canvas.getContext("2d"),r&&(this.font=r),s&&(this.fillStyle=s),this.setText(n)}syncContext(t,e){this.preRenderCallback&&this.preRenderCallback(t,e),e.font=this.font,e.textBaseline=this.textBaseline,e.textAlign=this.textAlign,e.fillStyle=this.fillStyle,e.strokeStyle=this.strokeStyle,e.lineWidth=this.lineWidth,e.lineCap="round",e.lineJoin="round",e.setLineDash(this.lineDash),e.imageSmoothingEnabled=this.antialias}updateText(){const t=this.canvas,e=this.context,n=this.resolution,r=this._text.split(this.splitRegExp),i=this.padding,s=this.fillStyle,o=this.strokeStyle,a=this.lineWidth,h=this.lineSpacing,u=a>0?a/2:0;e.clearRect(0,0,t.width,t.height),this.syncContext(t,e),e.textAlign="start";let c=0,l=0,d=0;const f=[],x="ascent"===this.verticalAlign,y=e.measureText("|MÉq"),p=Math.ceil(Math.abs(y.actualBoundingBoxAscent)+Math.abs(y.actualBoundingBoxDescent))+a;for(let t=0;t<r.length;t++){const n=e.measureText(r[t]),i=n.actualBoundingBoxLeft,s=n.actualBoundingBoxRight;let o=n.actualBoundingBoxAscent,y=n.actualBoundingBoxDescent;(o||y)&&""!==r[t]||(o=p,y=0);const m=Math.ceil(Math.abs(i)+Math.abs(s))+a,w=Math.ceil(Math.abs(o)+Math.abs(y))+a;x?(d+=o+u,t>0&&(d+=h+u),l=d+y+u):(d=l+(w-y-u),l+=w,t<r.length-1&&(l+=h)),c=Math.max(c,m),f.push({lineWidth:m,lineHeight:w,ascent:o,descent:y,left:i,right:s,y:d})}c+=i.left+i.right,l+=i.top+i.bottom;const m=this.fixedWidth?this.fixedWidth:c,w=this.fixedHeight?this.fixedHeight:l,g=Math.ceil(m*n),M=Math.ceil(w*n);t.width===g&&t.height===M||(t.width=g,t.height=M,this.texture.setSize(m,w),this.setSize(m,w)),e.save(),e.scale(n,n),this.syncContext(t,e);const b=this.backgroundStyle;if(b){e.save(),e.fillStyle=b,e.strokeStyle=b;const t=this.cornerRadius,n=t>0?t/2:0;t&&(e.lineWidth=t,e.strokeRect(n,n,m-t,w-t)),e.fillRect(n,n,m-t,w-t),e.restore()}const v=this.textAlign,_="center"===v,C="right"===v||"end"===v,z=(w-l)/2+i.top;for(let t=0;t<r.length;t++){const n=r[t],a=f[t];let h=i.left+a.left+u;const c=z+a.y;_?h=m/2:C&&(h=m-u),o&&e.strokeText(n,h,c),s&&e.fillText(n,h,c)}return e.restore(),this.texture.binding&&this.texture.binding.update(),this.setDirty(Pr),this}get text(){return this._text}set text(t){this.setText(t)}setText(t=""){return Array.isArray(t)&&(t=t.join("\n")),t!==this._text&&(this._text=t.toString(),this.updateText()),this}destroy(t){this.texture.destroy(),this.fillStyle=null,this.strokeStyle=null,this.backgroundStyle=null,this.canvas=null,this.context=null,super.destroy(t)}}});class $s{constructor(t,e=0,n=0,r=0){this.passthru=!1,this.entity=t,this.local=new d,this.world=new d,this.normal=new d,this.position=new pt(()=>this.update(),e,n,r),this.scale=new pt(()=>this.update(),1,1,1),this.origin=new pt(()=>this.update()),this.rotation=new m,this.rotation.onChange=()=>this.update(),this.forward=N(),this.up=q(),this.right=W(),this.update()}rotateX(t){Pt(this.rotation,t,this.rotation)}rotateY(t){It(this.rotation,t,this.rotation)}rotateZ(t){Ot(this.rotation,t,this.rotation)}update(){const t=this.local,e=this.normal;f(this.rotation,this.position,this.scale,t),g(t,e),z(e,e)}updateLocal(){this.entity.setDirty(Rr,Fr)}updateWorld(){const t=this.entity;t.setDirty(Rr,Fr),t.numChildren&&this.updateChildren()}updateChildren(){const t=this.entity.children;for(let e=0;e<t.length;e++){t[e]}}destroy(){this.position.destroy(),this.scale.destroy(),this.origin.destroy(),this.rotation.destroy(),this.entity=null,this.local=null,this.world=null,this.position=null,this.scale=null,this.origin=null,this.rotation=null}}var Zs=Object.freeze({__proto__:null,Transform3DComponent:$s});function Js(){return{vertices:[],normals:[],uvs:[],indices:[],numberOfVertices:0}}var Qs=Object.freeze({__proto__:null,CreateFramebuffer:As,CreateGLTexture:ds,DeleteFramebuffer:fs,DeleteGLBuffer:ws,DeleteGLTexture:xs,GL:Pi,PackColor:Ri,PackColors:Wi,SetGLTextureFilterMode:ys,UpdateGLTexture:ps,WebGLRenderer:class{constructor(){this.clearColor=[0,0,0,1],this.clearBeforeRender=!0,this.optimizeRedraw=!1,this.autoResize=!0,this.contextLost=!1,this.width=Ss(),this.height=Es(),this.resolution=Ts(),this.setBackgroundColor(0);const t=document.createElement("canvas");t.addEventListener("webglcontextlost",t=>this.onContextLost(t),!1),t.addEventListener("webglcontextrestored",()=>this.onContextRestored(),!1),this.canvas=t,this.initContext(),js(this),this.renderPass=new Ls(this),this.resize(this.width,this.height,this.resolution)}initContext(){const t=this.canvas.getContext("webgl",Ns);Pi.set(t),this.gl=t,t.disable(t.DEPTH_TEST),t.disable(t.CULL_FACE)}resize(t,e,n=1){const r=t*n,i=e*n;this.width=r,this.height=i,this.resolution=n;const s=this.canvas;s.width=r,s.height=i,this.autoResize&&(s.style.width=t.toString()+"px",s.style.height=e.toString()+"px"),this.renderPass.resize(r,i)}onContextLost(t){t.preventDefault(),this.contextLost=!0}onContextRestored(){this.contextLost=!1,this.initContext()}setBackgroundColor(t){return function(t,e=[]){const n=t>>16&255,r=t>>8&255,i=255&t,s=t>16777215?t>>>24:255;e[0]=n/255,e[1]=r/255,e[2]=i/255,e[3]=s/255}(t,this.clearColor),this}reset(){}render(t){if(this.contextLost)return;const e=this.gl,n=this.renderPass;if(Ki().forEach(t=>{const{texture:e,glConfig:n}=t;e.binding||(e.binding=new ms(e,n))}),Yi(),this.optimizeRedraw&&0===t.numDirtyFrames&&0===t.numDirtyCameras)return;if(this.clearBeforeRender){const t=this.clearColor;e.clearColor(t[0],t[1],t[2],t[3]),e.clear(e.COLOR_BUFFER_BIT)}const r=t.worldData;Bs(n);for(let t=0;t<r.length;t++){const{world:e}=r[t];e.renderGL(n),e.postRenderGL(n)}!function(t){Gi(t)}(n)}destroy(){js(void 0)}}});class to{constructor(t,e,n,r,i,s,o,a,h,u=1){this.color=16777215,this.alpha=1,this.size=30,this.vertex1=new Ai(t.x*u,t.y*u,t.z*u),this.vertex2=new Ai(e.x*u,e.y*u,e.z*u),this.vertex3=new Ai(n.x*u,n.y*u,n.z*u),this.vertex1.setUV(o.x,o.y),this.vertex2.setUV(a.x,a.y),this.vertex3.setUV(h.x,h.y),this.normal1=r,this.normal2=i,this.normal3=s,this._packedColor=Ri(this.color,this.alpha)}setColor(t,e=1){this.color=t,this.alpha=e,this._packedColor=Ri(t,e)}addToBuffer(t,e,n,r){const i=this.vertex1,s=this.vertex2,o=this.vertex3,a=this.normal1,h=this.normal2,u=this.normal3,c=this._packedColor;return t[r++]=i.x,t[r++]=i.y,t[r++]=i.z,t[r++]=a.x,t[r++]=a.y,t[r++]=a.z,t[r++]=i.u,t[r++]=i.v,t[r++]=n,e[r++]=c,t[r++]=s.x,t[r++]=s.y,t[r++]=s.z,t[r++]=h.x,t[r++]=h.y,t[r++]=h.z,t[r++]=s.u,t[r++]=s.v,t[r++]=n,e[r++]=c,t[r++]=o.x,t[r++]=o.y,t[r++]=o.z,t[r++]=u.x,t[r++]=u.y,t[r++]=u.z,t[r++]=o.u,t[r++]=o.v,t[r++]=n,e[r++]=c,r}}function eo(t,e){return[t[3*e+0],t[3*e+1],t[3*e+2]]}function no(t,e){return[t[2*e+0],t[2*e+1]]}function ro(t){return t.indices&&t.indices.length>0?function(t){const{vertices:e,normals:n,uvs:r,indices:i}=t,s=new gs({batchSize:i.length/3,isDynamic:!1,vertexElementSize:8,elementsPerEntry:3}),o=s.vertexViewF32;let a=0;for(let t=0;t<i.length;t+=3){const s=i[t+0],h=i[t+1],u=i[t+2],c=eo(e,s),l=eo(e,h),d=eo(e,u),f=eo(n,s),x=eo(n,h),y=eo(n,u),p=no(r,s),m=no(r,h),w=no(r,u);o[a++]=c[0],o[a++]=c[1],o[a++]=c[2],o[a++]=f[0],o[a++]=f[1],o[a++]=f[2],o[a++]=p[0],o[a++]=p[1],o[a++]=l[0],o[a++]=l[1],o[a++]=l[2],o[a++]=x[0],o[a++]=x[1],o[a++]=x[2],o[a++]=m[0],o[a++]=m[1],o[a++]=d[0],o[a++]=d[1],o[a++]=d[2],o[a++]=y[0],o[a++]=y[1],o[a++]=y[2],o[a++]=w[0],o[a++]=w[1]}return s.count=i.length,s}(t):function(t){const{vertices:e,normals:n,uvs:r}=t,i=e.length,s=i/3,o=new gs({batchSize:s/3,isDynamic:!1,vertexElementSize:8,elementsPerEntry:3}),a=o.vertexViewF32;let h=0,u=0;for(let t=0;t<i;t+=3)a[h++]=e[t+0],a[h++]=e[t+1],a[h++]=e[t+2],a[h++]=n[t+0],a[h++]=n[t+1],a[h++]=n[t+2],a[h++]=r[u+0],a[h++]=r[u+1],u+=2;return o.count=s,o}(t)}class io{constructor(t){t&&(t.hasOwnProperty("vertices")?this.buffer=ro(t):this.buffer=t)}destroy(){this.buffer.destroy()}}class so{constructor(t,e=!0,n="untitled"){this.currentMaterial="",this.currentGroup="",this.smoothingGroup=0,this.result={materialLibraries:[],models:[]},this.fileContents=t,this.defaultModelName=n,this.flipUVs=e}parseAsync(){return new Promise((t,e)=>{try{t(this.parse())}catch(t){e(t)}})}parse(){const t=t=>{const e=t.indexOf("#");return e>-1?t.substring(0,e):t},e=this.fileContents.split("\n");for(const n of e){const e=t(n).replace(/\s\s+/g," ").trim().split(" ");switch(e[0].toLowerCase()){case"o":this.parseObject(e);break;case"g":this.parseGroup(e);break;case"v":this.parseVertexCoords(e);break;case"vt":this.parseTextureCoords(e);break;case"vn":this.parseVertexNormal(e);break;case"s":this.parseSmoothShadingStatement(e);break;case"f":this.parsePolygon(e);break;case"mtllib":this.parseMtlLib(e);break;case"usemtl":this.parseUseMtl(e)}}return this.fileContents="",this.result}currentModel(){return 0===this.result.models.length&&(this.result.models.push({faces:[],name:this.defaultModelName,textureCoords:[],vertexNormals:[],vertices:[]}),this.currentGroup="",this.smoothingGroup=0),this.result.models[this.result.models.length-1]}parseObject(t){const e=t.length>=2?t[1]:this.defaultModelName;this.result.models.push({faces:[],name:e,textureCoords:[],vertexNormals:[],vertices:[]}),this.currentGroup="",this.smoothingGroup=0}parseGroup(t){if(2!==t.length)throw"Group statements must have exactly 1 argument (eg. g group_1)";this.currentGroup=t[1]}parseVertexCoords(t){const e=t.length,n=e>=2?parseFloat(t[1]):0,r=e>=3?parseFloat(t[2]):0,i=e>=4?parseFloat(t[3]):0;this.currentModel().vertices.push({x:n,y:r,z:i})}parseTextureCoords(t){const e=t.length;let n=e>=2?parseFloat(t[1]):0,r=e>=3?parseFloat(t[2]):0,i=e>=4?parseFloat(t[3]):0;isNaN(n)&&(n=0),isNaN(r)&&(r=0),isNaN(i)&&(i=0),this.flipUVs&&(r=1-r),this.currentModel().textureCoords.push({u:n,v:r,w:i})}parseVertexNormal(t){const e=t.length,n=e>=2?parseFloat(t[1]):0,r=e>=3?parseFloat(t[2]):0,i=e>=4?parseFloat(t[3]):0;this.currentModel().vertexNormals.push({x:n,y:r,z:i})}parsePolygon(t){const e=t.length-1;if(e<3)throw"Face < 3 vertices";const n={group:this.currentGroup,material:this.currentMaterial,smoothingGroup:this.smoothingGroup,vertices:[]};for(let r=0;r<e;r++){const e=t[r+1].split("/"),i=e.length;if(i<1||i>3)throw"Too many / values for single vertex";let s=0,o=0,a=0;if(s=parseInt(e[0],10),i>1&&""!==e[1]&&(o=parseInt(e[1],10)),i>2&&(a=parseInt(e[2],10)),0===s)throw"Faces uses invalid vertex index of 0";s<0&&(s=this.currentModel().vertices.length+1+s),o-=1,s-=1,a-=1,n.vertices.push({textureCoordsIndex:o,vertexIndex:s,vertexNormalIndex:a})}this.currentModel().faces.push(n)}parseMtlLib(t){t.length>=2&&this.result.materialLibraries.push(t[1])}parseUseMtl(t){t.length>=2&&(this.currentMaterial=t[1])}parseSmoothShadingStatement(t){if(2!==t.length)throw"Smoothing group statements must have exactly 1 argument (eg. s <number|off>)";const e="off"===t[1].toLowerCase()?0:parseInt(t[1],10);this.smoothingGroup=e}}function oo(t,e=!0){const n=new so(t,e).parse(),r=[];return n.models.forEach(t=>{const{faces:e,textureCoords:n,vertexNormals:i,vertices:s}=t,o=new gs({batchSize:e.length,isDynamic:!1,vertexElementSize:8,elementsPerEntry:3}),a=o.vertexViewF32;let h=0;for(let t=0;t<e.length;t++){const r=e[t],o=r.vertices[0],u=r.vertices[1],c=r.vertices[2],l=s[o.vertexIndex],d=s[u.vertexIndex],f=s[c.vertexIndex],x=i[o.vertexNormalIndex],y=i[u.vertexNormalIndex],p=i[c.vertexNormalIndex],m=n[o.textureCoordsIndex],w=n[u.textureCoordsIndex],g=n[c.textureCoordsIndex];a[h++]=l.x,a[h++]=l.y,a[h++]=l.z,a[h++]=x.x,a[h++]=x.y,a[h++]=x.z,a[h++]=m.u,a[h++]=m.v,a[h++]=d.x,a[h++]=d.y,a[h++]=d.z,a[h++]=y.x,a[h++]=y.y,a[h++]=y.z,a[h++]=w.u,a[h++]=w.v,a[h++]=f.x,a[h++]=f.y,a[h++]=f.z,a[h++]=p.x,a[h++]=p.y,a[h++]=p.z,a[h++]=g.u,a[h++]=g.v}o.count=3*e.length,r.push({name:t.name,buffer:o})}),r}function ao(t,e){return[t[3*e+0],t[3*e+1],t[3*e+2]]}function ho(t,e){return[t[2*e+0],t[2*e+1]]}var uo=Object.freeze({__proto__:null,CreateVertexSet:Js,FaceUVNormalTexture:to,Geometry:io,GetBufferFromObj:oo,GetBufferFromVertexSet:ro,GetFacesFromVertexSet:function(t){const{vertices:e,normals:n,uvs:r,indices:i}=t,s=[];for(let t=0;t<i.length;t+=3){const o=i[t+0],a=i[t+1],h=i[t+2],u=ao(e,o),c=ao(e,a),l=ao(e,h),d=ao(n,o),f=ao(n,a),x=ao(n,h),y=ho(r,o),p=ho(r,a),m=ho(r,h),w=new to({x:u[0],y:u[1],z:u[2]},{x:c[0],y:c[1],z:c[2]},{x:l[0],y:l[1],z:l[2]},{x:d[0],y:d[1],z:d[2]},{x:f[0],y:f[1],z:f[2]},{x:x[0],y:x[1],z:x[2]},{x:y[0],y:y[1]},{x:p[0],y:p[1]},{x:m[0],y:m[1]},1);s.push(w)}return s},ParseObj:so});function co(t,e=0,n=0,r=0,i=0,s=1,o=2,a=1,h=-1,u=1,c=1,l=1,d=1,f=1){t||(t={vertices:[],normals:[],uvs:[],indices:[],numberOfVertices:0});const{vertices:x,normals:y,uvs:p,indices:m,numberOfVertices:w}=t,g=u/d,M=c/f,b=u/2,v=c/2,_=l/2,C=d+1,z=f+1;let S=0;const E=[];for(let t=0;t<z;t++){const u=t*M-v;for(let c=0;c<C;c++){const m=c*g-b;E[i]=m*a,E[s]=u*h,E[o]=_,x.push(e+E[0],n+E[1],r+E[2]),E[i]=0,E[s]=0,E[o]=l>0?1:-1,y.push(E[0],E[1],E[2]),p.push(c/d),p.push(1-t/f),S+=1}}for(let t=0;t<f;t++)for(let e=0;e<d;e++){const n=w+e+C*t,r=w+e+C*(t+1),i=w+(e+1)+C*(t+1),s=w+(e+1)+C*t;m.push(n,r,s),m.push(r,i,s)}return t.numberOfVertices+=S,t}function lo(t=0,e=0,n=0,r=1,i=1,s=1,o=1,a=1,h=1){const u={vertices:[],normals:[],uvs:[],indices:[],numberOfVertices:0};return co(u,t,e,n,2,1,0,-1,-1,s,i,r,h,a),co(u,t,e,n,2,1,0,1,-1,s,i,-r,h,a),co(u,t,e,n,0,2,1,1,1,r,s,i,o,h),co(u,t,e,n,0,2,1,1,-1,r,s,-i,o,h),co(u,t,e,n,0,1,2,1,-1,r,i,s,o,a),co(u,t,e,n,0,1,2,-1,-1,r,i,-s,o,a),u}class fo{constructor(t=0,e=0,n=0){this.type="GameObject3D",this.name="",this.willUpdate=!0,this.willUpdateChildren=!0,this.willRender=!0,this.willRenderChildren=!0,this.willCacheChildren=!1,this.dirty=0,this.dirtyFrame=0,this.visible=!0,this.children=[],this.events=new Map,this.transform=new $s(this,t,e,n),this.dirty=Ir}isRenderable(){return this.visible&&this.willRender}isDirty(t){return 0!=(this.dirty&t)}clearDirty(t){return this.isDirty(t)&&(this.dirty^=t),this}setDirty(t,e){return this.isDirty(t)||(this.dirty^=t,this.dirtyFrame=o()),this.isDirty(e)||(this.dirty^=e),this}update(t,e){if(this.willUpdateChildren){const n=this.children;for(let r=0;r<n.length;r++){const i=n[r];i&&i.willUpdate&&i.update(t,e)}}this.postUpdate(t,e)}postUpdate(t,e){}renderGL(t){}postRenderGL(t){}get numChildren(){return this.children.length}destroy(t){zr(this,"destroy",this),this.transform.destroy(),this.events.clear(),this.world=null,this.parent=null,this.children=null}}class xo{constructor(t={}){this.isDirty=!1;const{ambient:e=[1,1,1],diffuse:n=[1,1,1],specular:r=[1,1,1],shine:i=.25}=t,s=()=>this.update();this.ambient=new mt(s).fromArray(e),this.diffuse=new mt(s).fromArray(n),this.specular=new mt(s).fromArray(r),this._shine=i}get shine(){return this._shine}set shine(t){this._shine=st(t,0,1),this.isDirty=!0}update(){this.isDirty=!0}setUniforms(t){t.setUniform("uMaterialAmbient",this.ambient.toArray()),t.setUniform("uMaterialDiffuse",this.diffuse.toArray()),t.setUniform("uMaterialSpecular",this.specular.toArray()),t.setUniform("uMaterialShine",256*this._shine)}destroy(){this.ambient.destroy(),this.diffuse.destroy(),this.specular.destroy()}}function yo(t,e,...n){const r=t.getFrame(e);return n.forEach(t=>{t&&r!==t.frame&&(t.frame=r,t.hasTexture=!0)}),n}class po extends fo{constructor(t=0,e=0,n=0,r,i=new xo){super(t,e,n),this.hasTexture=!1,this.cullFaces=!0,this.geometry=r,this.material=i,this.setTexture("__WHITE")}setTexture(t,e){return function(t,e,...n){if(t){let r;r=t instanceof Zi?t:Qi().get(t),r?(n.forEach(t=>{t.texture=r}),yo(r,e,...n)):console.warn("Invalid Texture key: "+t)}else n.forEach(t=>{t.texture=null,t.frame=null,t.hasTexture=!1})}(t,e,this),this}setFrame(t){return yo(this.texture,t,this),this}setMaterial(t){return this.material=t,this}renderGL(t){const e=t.currentShader.shader;if(e.setUniform("uModelMatrix",this.transform.local.data),e.setUniform("uNormalMatrix",this.transform.normal.data),this.hasTexture){const n=Vi(t,this.texture);e.setUniform("uTexture",n)}this.material.setUniforms(e),function(t,e){cs(t,e),t.currentShader.shader.setAttributes(t);const n=Gi(t,e.count);us(t)}(t,this.geometry.buffer)}destroy(t){super.destroy(t),this.geometry=null,this.material=null,this.texture=null,this.frame=null,this.hasTexture=!1}}function mo(t,e,n,r,i,s,o,a,h){const{vertices:u,normals:c,uvs:l,indices:d}=e,f=new A,x=new y,p=!0===t?i:s,m=!0===t?1:-1,w=n;for(let t=1;t<=o;t++)u.push(0,r*m,0),c.push(0,m,0),l.push(.5,.5),n++;const g=n;for(let t=0;t<=o;t++){const e=t/o*h+a,i=Math.cos(e),s=Math.sin(e);x.x=p*s,x.y=r*m,x.z=p*i,u.push(x.x,x.y,x.z),c.push(0,m,0),f.x=.5*i+.5,f.y=.5*s*m+.5,l.push(f.x,f.y),n++}for(let e=0;e<o;e++){const n=w+e,r=g+e;t?d.push(r,r+1,n):d.push(r+1,r,n)}return n}function wo(t=1,e=1,n=1,r=8,i=1,s=!1,o=0,a=2*Math.PI){const h={vertices:[],normals:[],uvs:[],indices:[],numberOfVertices:0},{vertices:u,normals:c,uvs:l,indices:d}=h;let f=0;const x=[],p=n/2,m=new y,w=new y,g=(e-t)/n;for(let s=0;s<=i;s++){const h=[],d=s/i,y=d*(e-t)+t;for(let t=0;t<=r;t++){const e=t/r,i=e*a+o,s=Math.sin(i),x=Math.cos(i);w.x=y*s,w.y=-d*n+p,w.z=y*x,u.push(w.x,w.y,w.z),m.set(s,g,x),dt(m,m),c.push(m.x,m.y,m.z),l.push(e,1-d),h.push(f++)}x.push(h)}for(let t=0;t<r;t++)for(let e=0;e<i;e++){const n=x[e][t],r=x[e+1][t],i=x[e+1][t+1],s=x[e][t+1];d.push(n,r,s),d.push(r,i,s)}return s||(t>0&&(f=mo(!0,h,f,p,t,e,r,o,a)),e>0&&mo(!1,h,f,p,t,e,r,o,a)),h.numberOfVertices=u.length,h}function go(t=1,e=1,n=8,r=1,i=!1,s=0,o=2*Math.PI){return wo(0,t,e,n,r,i,s,o)}class Mo{constructor(t={}){this.isDirty=!1;const{x:e=0,y:n=0,z:r=.1,ambient:i=[1,1,1],diffuse:s=[1,1,1],specular:o=[1,1,1]}=t,a=()=>this.update();this.position=new pt(a,e,n,r),this.ambient=new mt(a).fromArray(i),this.diffuse=new mt(a).fromArray(s),this.specular=new mt(a).fromArray(o)}setUniforms(t){t.setUniform("uLightPosition",this.position.toArray()),t.setUniform("uLightAmbient",this.ambient.toArray()),t.setUniform("uLightDiffuse",this.diffuse.toArray()),t.setUniform("uLightSpecular",this.specular.toArray())}update(){this.isDirty=!0}destroy(){this.position.destroy(),this.ambient.destroy(),this.diffuse.destroy(),this.specular.destroy()}}function bo(t=1,e=3,n=3,r=0,i=2*Math.PI,s=0,o=Math.PI){e=Math.max(3,Math.floor(e)||8),n=Math.max(2,Math.floor(n)||6);const a=Math.min(s+o,Math.PI),h={vertices:[],normals:[],uvs:[],indices:[],numberOfVertices:0},{vertices:u,normals:c,uvs:l,indices:d}=h;let f=0;const x=[],p=new y,m=new y;for(let h=0;h<=n;h++){const d=[],y=h/n;let w=0;0===h&&0===s?w=.5/e:h===n&&a==Math.PI&&(w=-.5/e);for(let n=0;n<=e;n++){const a=n/e;p.x=-t*Math.cos(r+a*i)*Math.sin(s+y*o),p.y=t*Math.cos(s+y*o),p.z=t*Math.sin(r+a*i)*Math.sin(s+y*o),u.push(p.x,p.y,p.z),dt(p,m),c.push(m.x,m.y,m.z),l.push(a+w,1-y),d.push(f++)}x.push(d)}for(let t=0;t<n;t++)for(let r=0;r<e;r++){const e=x[t][r+1],i=x[t][r],o=x[t+1][r],h=x[t+1][r+1];(0!==t||s>0)&&d.push(e,i,h),(t!==n-1||a<Math.PI)&&d.push(i,o,h)}return h.numberOfVertices=u.length,h}var vo=Object.freeze({__proto__:null,Components:Zs,Geometry:uo,Box:class extends po{constructor(t=0,e=0,n=0,r=1,i=1,s=1,o=1,a=1,h=1){const u=lo(0,0,0,r,i,s,o,a,h);super(t,e,n,new io(u))}},Cone:class extends po{constructor(t=0,e=0,n=0,r=1,i=1,s=8,o=1,a=!1,h=0,u=2*Math.PI){const c=go(r,i,s,o,a,h,u);super(t,e,n,new io(c))}},Light:Mo,Material:xo,Mesh:po,Plane:class extends po{constructor(t=0,e=0,n=0,r=1,i=1,s=1,o=1){const a=co(null,0,0,0,0,1,2,1,-1,r,i,1,s,o);super(t,e,n,new io(a))}},RenderLayer3D:class extends Ws{constructor(){super(),this.type="RenderLayer",this.willRender=!0,this.willRenderChildren=!0,this.willCacheChildren=!0,this.setDirty(Ar);const t=Ss(),e=Es(),n=Ts(),r=new Zi(null,t*n,e*n),i=new ms(r);r.binding=i,i.framebuffer=As(i.texture),i.depthbuffer=Rs(i.framebuffer,r.width,r.height),this.texture=r,this.framebuffer=i.framebuffer}renderGL(t){this.numChildren>0&&(Gi(t),!this.willCacheChildren||this.isDirty(Ar)?(Bi(t,this.framebuffer,!0),this.clearDirty(Ar)):(Bi(t,this.framebuffer,!1),this.postRenderGL(t)))}postRenderGL(t){Gi(t),ki(t),Gs(t,this.texture),this.clearDirty(Rr)}},Sphere:class extends po{constructor(t=0,e=0,n=0,r=1,i=3,s=3,o=0,a=2*Math.PI,h=0,u=Math.PI){const c=bo(r,i,s,o,a,h,u);super(t,e,n,new io(c))}},GameObject3D:fo});function _o(t,e,n){if(t.radius>0&&e>=t.left&&e<=t.right&&n>=t.top&&n<=t.bottom){return(t.x-e)*(t.x-e)+(t.y-n)*(t.y-n)<=t.radius*t.radius}return!1}class Co{constructor(t=0,e=0,n=0){this.set(t,e,n)}set(t=0,e=0,n=0){return this.x=t,this.y=e,this.radius=n,this}contains(t,e){return _o(this,t,e)}get radius(){return this._radius}set radius(t){this._radius=t,this._diameter=2*t}get diameter(){return this._diameter}set diameter(t){this._diameter=t,this._radius=.5*t}get left(){return this.x-this._radius}set left(t){this.x=t+this._radius}get right(){return this.x+this._radius}set right(t){this.x=t-this._radius}get top(){return this.y-this._radius}set top(t){this.y=t+this._radius}get bottom(){return this.y+this._radius}set bottom(t){this.y=t-this._radius}}function zo(t){return Math.PI*t.radius*2}function So(t,e,n=new A){return n.set(t.x+t.radius*Math.cos(e),t.y+t.radius*Math.sin(e))}var Eo=Object.freeze({__proto__:null,Area:function(t){return t.radius>0?Math.PI*t.radius*t.radius:0},Circle:Co,Circumference:zo,CircumferencePoint:So,Clone:function(t){return new Co(t.x,t.y,t.radius)},Contains:_o,ContainsPoint:function(t,e){return _o(t,e.x,e.y)},ContainsRect:function(t,e){return _o(t,e.x,e.y)&&_o(t,e.right,e.y)&&_o(t,e.x,e.bottom)&&_o(t,e.right,e.bottom)},CopyFrom:function(t,e){return e.set(t.x,t.y,t.radius)},Equals:function(t,e){return t.x===e.x&&t.y===e.y&&t.radius===e.radius},GetBounds:function(t,e=new R){return e.set(t.left,t.top,t.diameter,t.diameter)},GetPoint:function(t,e,n=new A){return So(t,gn(e,0,F.PI2),n)},GetPoints:function(t,e,n=0,r=[]){n||(n=zo(t)/e);for(let e=0;e<n;e++){const i=gn(e/n,0,F.PI2);r.push(So(t,i))}return r},Offset:function(t,e,n){return t.x+=e,t.y+=n,t},OffsetPoint:function(t,e){return t.x+=e.x,t.y+=e.y,t},Random:function(t,e=new A){const n=2*Math.PI*Math.random(),r=Math.random()+Math.random(),i=r>1?2-r:r,s=i*Math.cos(n),o=i*Math.sin(n);return e.set(t.x+s*t.radius,t.y+o*t.radius)}});function To(t){const e=t.width/2,n=t.height/2,r=Math.pow(e-n,2)/Math.pow(e+n,2);return Math.PI*(e+n)*(1+3*r/(10+Math.sqrt(4-3*r)))}function Ro(t,e,n=new A){const r=t.width/2,i=t.height/2;return n.set(t.x+r*Math.cos(e),t.y+i*Math.sin(e))}function Ao(t,e,n){if(t.width<=0||t.height<=0)return!1;let r=(e-t.x)/t.width,i=(n-t.y)/t.height;return r*=r,i*=i,r+i<.25}class Do{constructor(t=0,e=0,n=0,r=0){this.set(t,e,n,r)}set(t=0,e=0,n=0,r=0){return this.x=t,this.y=e,this.width=n,this.height=r,this}contains(t,e){return Ao(this,t,e)}getMinorRadius(){return Math.min(this.width,this.height)/2}getMajorRadius(){return Math.max(this.width,this.height)/2}get left(){return this.x-this.width/2}set left(t){this.x=t+this.width/2}get right(){return this.x+this.width/2}set right(t){this.x=t-this.width/2}get top(){return this.y-this.height/2}set top(t){this.y=t+this.height/2}get bottom(){return this.y+this.height/2}set bottom(t){this.y=t-this.height/2}}var Fo=Object.freeze({__proto__:null,Area:function(t){return t.width<=0||t.height<=0?0:t.getMajorRadius()*t.getMinorRadius()*Math.PI},Circumference:To,CircumferencePoint:Ro,Clone:function(t){return new Do(t.x,t.y,t.width,t.height)},Contains:Ao,ContainsPoint:function(t,e){return Ao(t,e.x,e.y)},ContainsRect:function(t,e){return Ao(t,e.x,e.y)&&Ao(t,e.right,e.y)&&Ao(t,e.x,e.bottom)&&Ao(t,e.right,e.bottom)},CopyFrom:function(t,e){return e.set(t.x,t.y,t.width,t.height)},Ellipse:Do,Equals:function(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height},GetBounds:function(t,e=new R){return e.set(t.left,t.top,t.width,t.height)},GetPoint:function(t,e,n=new A){return Ro(t,gn(e,0,F.PI2),n)},GetPoints:function(t,e,n=0,r=[]){n||(n=To(t)/e);for(let e=0;e<n;e++){const i=gn(e/n,0,F.PI2);r.push(Ro(t,i))}return r},Offset:function(t,e,n){return t.x+=e,t.y+=n,t},OffsetPoint:function(t,e){return t.x+=e.x,t.y+=e.y,t},Random:function(t,e=new A){const n=Math.random()*Math.PI*2,r=Math.sqrt(Math.random());return e.x=t.x+r*Math.cos(n)*t.width/2,e.y=t.y+r*Math.sin(n)*t.height/2,e}});function Po(t,e){return Je(t,e)<=t.radius+e.radius}function Io(t,e){const n=e.width/2,r=e.height/2,i=Math.abs(t.x-e.x-n),s=Math.abs(t.y-e.y-r),o=n+t.radius,a=r+t.radius;if(i>o||s>a)return!1;if(i<=n||s<=r)return!0;{const e=i-n,o=s-r;return e*e+o*o<=t.radius*t.radius}}const Oo=new A;function Lo(t,e,n){n||(n=Oo);const{x1:r,y1:i,x2:s,y2:o}=t;if(_o(e,r,i))return n.set(r,i),!0;if(_o(e,s,o))return n.set(s,o),!0;const a=s-r,h=o-i,u=e.x-r,c=e.y-i,l=a*a+h*h;let d=a,f=h;if(l>0){const t=(u*a+c*h)/l;d*=t,f*=t}n.set(r+d,i+f);return d*d+f*f<=l&&d*a+f*h>=0&&_o(e,n.x,n.y)}function ko(t,e,n=[]){if(Lo(t,e)){const{x1:r,y1:i,x2:s,y2:o}=t,a=e.radius,h=s-r,u=o-i,c=r-e.x,l=i-e.y,d=h*h+u*u,f=2*(h*c+u*l),x=f*f-4*d*(c*c+l*l-a*a);let y,p;if(0===x){const t=-f/(2*d);y=r+t*h,p=i+t*u,t>=0&&t<=1&&n.push(new A(y,p))}else if(x>0){const t=(-f-Math.sqrt(x))/(2*d);y=r+t*h,p=i+t*u,t>=0&&t<=1&&n.push(new A(y,p));const e=(-f+Math.sqrt(x))/(2*d);y=r+e*h,p=i+e*u,e>=0&&e<=1&&n.push(new A(y,p))}}return n}function Bo(t,e,n){const{x1:r,y1:i,x2:s,y2:o}=t,{x1:a,y1:h,x2:u,y2:c}=e,l=(c-h)*(s-r)-(u-a)*(o-i);if(0===l)return!1;const d=((u-a)*(i-h)-(c-h)*(r-a))/l,f=((s-r)*(i-h)-(o-i)*(r-a))/l;return d>=0&&d<=1&&f>=0&&f<=1&&(n&&n.set(r+d*(s-r),i+d*(o-i)),!0)}function Go(t,e){const{x1:n,y1:r,x2:i,y2:s}=t,{x:o,y:a,right:h,bottom:u}=e;let c=0;if(n>=o&&n<=h&&r>=a&&r<=u||i>=o&&i<=h&&s>=a&&s<=u)return!0;if(n<o&&i>=o){if(c=r+(s-r)*(o-n)/(i-n),c>a&&c<=u)return!0}else if(n>h&&i<=h&&(c=r+(s-r)*(h-n)/(i-n),c>=a&&c<=u))return!0;if(r<a&&s>=a){if(c=n+(i-n)*(a-r)/(s-r),c>=o&&c<=h)return!0}else if(r>u&&s<=u&&(c=n+(i-n)*(u-r)/(s-r),c>=o&&c<=h))return!0;return!1}function Uo(t,e,n=[]){if(Go(t,e)){const[r,i,s,o]=bi(e),a=[new A,new A,new A,new A],h=[Bo(r,t,a[0]),Bo(i,t,a[1]),Bo(s,t,a[2]),Bo(o,t,a[3])];for(let t=0;t<h.length;t++)h[t]&&n.push(a[t])}return n}function Vo(t){const{x1:e,y1:n,x2:r,y2:i,x3:s,y3:o}=t;return[new Mi(e,n,r,i),new Mi(r,i,s,o),new Mi(s,o,e,n)]}function No(t,e,n){const{x1:r,y1:i,x2:s,y2:o,x3:a,y3:h}=t,u=a-r,c=h-i,l=s-r,d=o-i,f=e-r,x=n-i,y=u*u+c*c,p=u*l+c*d,m=u*f+c*x,w=l*l+d*d,g=l*f+d*x,M=y*w-p*p,b=0===M?0:1/M,v=(w*m-p*g)*b,_=(y*g-p*m)*b;return v>=0&&_>=0&&v+_<1}function jo(t,e,n=!1,r=[]){let i=!1;return e.forEach(e=>{if(i)return;const{x:s,y:o}=e;No(t,s,o)&&(r.push(new A(s,o)),n&&(i=!0))}),r}function Wo(t,e){if(e.left>t.right||e.right<t.x||e.top>t.bottom||e.bottom<t.y)return!1;const[n,r,i]=Vo(e);if(T(t,n.x1,n.y1)||T(t,n.x2,n.y2))return!0;if(T(t,r.x1,r.y1)||T(t,r.x2,r.y2))return!0;if(T(t,i.x1,i.y1)||T(t,i.x2,i.y2))return!0;const[s,o,a,h]=bi(t);if(Bo(n,s)||Bo(n,o)||Bo(n,a)||Bo(n,h))return!0;if(Bo(r,s)||Bo(r,o)||Bo(r,a)||Bo(r,h))return!0;if(Bo(i,s)||Bo(i,o)||Bo(i,a)||Bo(i,h))return!0;return jo(e,wi(t),!0).length>0}function qo(t,e){if(t.left>e.right||t.right<e.left||t.top>e.bottom||t.bottom<e.top)return!1;if(No(t,e.x,e.y))return!0;const[n,r,i]=Vo(t);return Lo(n,e)||Lo(r,e)||Lo(i,e)}function Ho(t,e){const{x1:n,y1:r,x2:i,y2:s}=e;if(No(t,n,r)||No(t,i,s))return!0;const[o,a,h]=Vo(t);return Bo(o,e)||Bo(a,e)||Bo(h,e)}function Xo(t,e,n=[]){if(Ho(t,e)){const[r,i,s]=Vo(t),o=[new A,new A,new A],a=[Bo(r,e,o[0]),Bo(i,e,o[1]),Bo(s,e,o[2])];for(let t=0;t<a.length;t++)a[t]&&n.push(o[t])}return n}function Ko(t,e=[]){const{x1:n,y1:r,x2:i,y2:s,x3:o,y3:a}=t;return e.push(new A(n,r),new A(i,s),new A(o,a)),e}function Yo(t,e){if(t.left>e.right||t.right<e.left||t.top>e.bottom||t.bottom<e.top)return!1;const[n,r,i]=Vo(t),[s,o,a]=Vo(e);if(Bo(n,s)||Bo(n,o)||Bo(n,a)||Bo(r,s)||Bo(r,o)||Bo(r,a)||Bo(i,s)||Bo(i,o)||Bo(i,a))return!0;if(jo(e,Ko(t),!0).length>0)return!0;return jo(t,Ko(e),!0).length>0}function $o(t,e,n=1){const{x1:r,y1:i,x2:s,y2:o}=e,{x:a,y:h}=t,u=(s-r)*(s-r)+(o-i)*(o-i);if(0===u)return!1;const c=((a-r)*(s-r)+(h-i)*(o-i))/u;if(c<0)return Math.sqrt((r-a)*(r-a)+(i-h)*(i-h))<=n;if(c>=0&&c<=1){const t=((i-h)*(s-r)-(r-a)*(o-i))/u;return Math.abs(t)*Math.sqrt(u)<=n}return Math.sqrt((s-a)*(s-a)+(o-h)*(o-h))<=n}var Zo=Object.freeze({__proto__:null,CircleToCircle:Po,CircleToRectangle:Io,GetCircleToCircle:function(t,e,n=[]){if(Po(t,e)){const r=t.x,i=t.y,s=t.radius,o=e.x,a=e.y,h=e.radius;let u,c,l,d,f;if(i===a)f=(h*h-s*s-o*o+r*r)/(2*(r-o)),u=1,c=-2*a,l=o*o+f*f-2*o*f+a*a-h*h,d=c*c-4*u*l,0===d?n.push(new A(f,-c/(2*u))):d>0&&(n.push(new A(f,(-c+Math.sqrt(d))/(2*u))),n.push(new A(f,(-c-Math.sqrt(d))/(2*u))));else{const t=(r-o)/(i-a),e=(h*h-s*s-o*o+r*r-a*a+i*i)/(2*(i-a));u=t*t+1,c=2*i*t-2*e*t-2*r,l=r*r+i*i+e*e-s*s-2*i*e,d=c*c-4*u*l,0===d?(f=-c/(2*u),n.push(new A(f,e-f*t))):d>0&&(f=(-c+Math.sqrt(d))/(2*u),n.push(new A(f,e-f*t)),f=(-c-Math.sqrt(d))/(2*u),n.push(new A(f,e-f*t)))}}return n},GetCircleToRectangle:function(t,e,n=[]){if(Io(t,e)){const[r,i,s,o]=bi(e);ko(r,t,n),ko(i,t,n),ko(s,t,n),ko(o,t,n)}return n},GetLineToCircle:ko,GetLineToRectangle:Uo,GetRectangleIntersection:function(t,e,n=new R){if(Gr(t,e)){const r=Math.max(t.x,e.x),i=Math.max(t.y,e.y);return n.set(r,i,Math.min(t.right,e.right)-r,Math.min(t.bottom,e.bottom)-i)}},GetRectangleToRectangle:function(t,e,n=[]){if(Gr(t,e)){const[r,i,s,o]=bi(t);Uo(r,e,n),Uo(i,e,n),Uo(s,e,n),Uo(o,e,n)}return n},GetRectangleToTriangle:function(t,e,n=[]){if(Wo(t,e)){const[r,i,s]=Vo(e);Uo(r,t,n),Uo(i,t,n),Uo(s,t,n)}return n},GetTriangleToCircle:function(t,e,n=[]){if(qo(t,e)){const[r,i,s]=Vo(t);ko(r,e,n),ko(i,e,n),ko(s,e,n)}return n},GetTriangleToLine:Xo,GetTriangleToTriangle:function(t,e,n=[]){if(Yo(t,e)){const[r,i,s]=Vo(e);Xo(t,r,n),Xo(t,i,n),Xo(t,s,n)}return n},LineToCircle:Lo,LineToLine:Bo,LineToRectangle:Go,PointToLine:$o,PointToLineSegment:function(t,e){if(!$o(t,e))return!1;const{x1:n,y1:r,x2:i,y2:s}=e,{x:o,y:a}=t,h=Math.min(n,i),u=Math.max(n,i),c=Math.min(r,s),l=Math.max(r,s);return o>=h&&o<=u&&a>=c&&a<=l},RectangleToRectangle:Gr,RectangleToTriangle:Wo,TriangleToCircle:qo,TriangleToLine:Ho,TriangleToTriangle:Yo});function Jo(t){return Math.atan2(t.y2-t.y1,t.x2-t.x1)}function Qo(t){const{x1:e,y1:n,x2:r,y2:i}=t;return Math.sqrt((r-e)*(r-e)+(i-n)*(i-n))}function ta(t){return I(Jo(t)-F.HALF_PI,-Math.PI,Math.PI)}function ea(t,e,n,r){const i=Math.cos(r),s=Math.sin(r);let o=t.x1-e,a=t.y1-n;return t.x1=o*i-a*s+e,t.y1=o*s+a*i+n,o=t.x2-e,a=t.y2-n,t.x2=o*i-a*s+e,t.y2=o*s+a*i+n,t}var na=Object.freeze({__proto__:null,Angle:Jo,BresenhamPoints:function(t,e=1,n=[]){let r=Math.round(t.x1),i=Math.round(t.y1);const s=Math.round(t.x2),o=Math.round(t.y2),a=Math.abs(s-r),h=Math.abs(o-i),u=r<s?1:-1,c=i<o?1:-1;let l=a-h;n.push(new A(r,i));let d=1;for(;r!==s||i!==o;){const t=l<<1;t>-h&&(l-=h,r+=u),t<a&&(l+=a,i+=c),d%e==0&&n.push(new A(r,i)),d++}return n},CenterOn:function(t,e,n){const r=e-(t.x1+t.x2)/2,i=n-(t.y1+t.y2)/2;return t.x1+=r,t.y1+=i,t.x2+=r,t.y2+=i,t},Clone:function(t){return new Mi(t.x1,t.y1,t.x2,t.y2)},CopyFrom:function(t,e){return e.set(t.x1,t.y1,t.x2,t.y2)},Equals:function(t,e){return t.x1===e.x1&&t.y1===e.y1&&t.x2===e.x2&&t.y2===e.y2},Extend:function(t,e,n=e){const r=Qo(t),i=t.x2-t.x1,s=t.y2-t.y1;return e&&(t.x1=t.x1-i/r*e,t.y1=t.y1-s/r*e),n&&(t.x2=t.x2+i/r*n,t.y2=t.y2+s/r*n),t},GetMidPoint:function(t,e=new A){return e.x=(t.x1+t.x2)/2,e.y=(t.y1+t.y2)/2,e},GetNearestPoint:function(t,e,n=new A){const{x1:r,y1:i,x2:s,y2:o}=t,a=(s-r)*(s-r)+(o-i)*(o-i);if(0===a)return n;const h=((e.x-r)*(s-r)+(e.y-i)*(o-i))/a;return n.x=r+h*(s-r),n.y=i+h*(o-i),n},GetNormal:function(t,e=new A){const n=Jo(t)-F.HALF_PI;return e.x=Math.cos(n),e.y=Math.sin(n),e},GetPoint:function(t,e,n=new A){return n.x=t.x1+(t.x2-t.x1)*e,n.y=t.y1+(t.y2-t.y1)*e,n},GetPoints:function(t,e,n=0,r=[]){e||(e=Qo(t)/n);const{x1:i,y1:s,x2:o,y2:a}=t;for(let t=0;t<e;t++){const n=t/e,h=i+(o-i)*n,u=s+(a-s)*n;r.push(new A(h,u))}return r},GetShortestDistance:function(t,e){const{x1:n,y1:r,x2:i,y2:s}=t,o=(i-n)*(i-n)+(s-r)*(s-r);if(0===o)return 0;const a=((r-e.y)*(i-n)-(n-e.x)*(s-r))/o;return Math.abs(a)*Math.sqrt(o)},Height:function(t){return Math.abs(t.y1-t.y2)},Length:Qo,Line:Mi,NormalAngle:ta,NormalX:function(t){return Math.cos(Jo(t)-F.HALF_PI)},NormalY:function(t){return Math.sin(Jo(t)-F.HALF_PI)},Offset:function(t,e,n){return t.x1+=e,t.y1+=n,t.x2+=e,t.y2+=n,t},PerpSlope:function(t){const{x1:e,y1:n,x2:r,y2:i}=t;return-(r-e)/(i-n)},Random:function(t,e=new A){const n=Math.random();return e.x=t.x1+n*(t.x2-t.x1),e.y=t.y1+n*(t.y2-t.y1),e},ReflectAngle:function(t,e){return 2*ta(e)-Math.PI-Jo(t)},Rotate:function(t,e){return ea(t,(t.x1+t.x2)/2,(t.y1+t.y2)/2,e)},RotateAroundPoint:function(t,e,n){return ea(t,e.x,e.y,n)},RotateAroundXY:ea,SetToAngle:function(t,e,n,r,i){return t.x1=e,t.y1=n,t.x2=e+Math.cos(r)*i,t.y2=n+Math.sin(r)*i,t},Slope:function(t){const{x1:e,y1:n,x2:r,y2:i}=t;return(i-n)/(r-e)},Width:function(t){return Math.abs(t.x1-t.x2)}});class ra{constructor(t=0,e=0,n=0,r=0,i=0,s=0){this.set(t,e,n,r,i,s)}set(t=0,e=0,n=0,r=0,i=0,s=0){return this.x1=t,this.y1=e,this.x2=n,this.y2=r,this.x3=i,this.y3=s,this}contains(t,e){return No(this,t,e)}get left(){return Math.min(this.x1,this.x2,this.x3)}set left(t){let e=0;e=this.x1<=this.x2&&this.x1<=this.x3?this.x1-t:this.x2<=this.x1&&this.x2<=this.x3?this.x2-t:this.x3-t,this.x1-=e,this.x2-=e,this.x3-=e}get right(){return Math.max(this.x1,this.x2,this.x3)}set right(t){let e=0;e=this.x1>=this.x2&&this.x1>=this.x3?this.x1-t:this.x2>=this.x1&&this.x2>=this.x3?this.x2-t:this.x3-t,this.x1-=e,this.x2-=e,this.x3-=e}get top(){return Math.min(this.y1,this.y2,this.y3)}set top(t){let e=0;e=this.y1<=this.y2&&this.y1<=this.y3?this.y1-t:this.y2<=this.y1&&this.y2<=this.y3?this.y2-t:this.y3-t,this.y1-=e,this.y2-=e,this.y3-=e}get bottom(){return Math.max(this.y1,this.y2,this.y3)}set bottom(t){let e=0;e=this.y1>=this.y2&&this.y1>=this.y3?this.y1-t:this.y2>=this.y1&&this.y2>=this.y3?this.y2-t:this.y3-t,this.y1-=e,this.y2-=e,this.y3-=e}}function ia(t,e=new A){return e.set((t.x1+t.x2+t.x3)/3,(t.y1+t.y2+t.y3)/3)}function sa(t,e,n){return t.x1+=e,t.y1+=n,t.x2+=e,t.y2+=n,t.x3+=e,t.y3+=n,t}function oa(t,e,n,r){return t*r-e*n}class aa{constructor(t=0,e=0,n=0){this.set(t,e,n)}set(t=0,e=0,n=0){return this.x=t,this.y=e,this.radius=n,this}contains(t,e){return function(t,e,n){if(t.radius>0&&e>=t.left&&e<=t.right&&n>=t.top&&n<=t.bottom){return(t.x-e)*(t.x-e)+(t.y-n)*(t.y-n)<=t.radius*t.radius}return!1}(this,t,e)}get radius(){return this._radius}set radius(t){this._radius=t,this._diameter=2*t}get diameter(){return this._diameter}set diameter(t){this._diameter=t,this._radius=.5*t}get left(){return this.x-this._radius}set left(t){this.x=t+this._radius}get right(){return this.x+this._radius}set right(t){this.x=t-this._radius}get top(){return this.y-this._radius}set top(t){this.y=t+this._radius}get bottom(){return this.y+this._radius}set bottom(t){this.y=t-this._radius}}function ha(t,e,n,r){const i=t-n,s=e-r,o=i*i+s*s;return Math.sqrt(o)}function ua(t,e=new A){const{x1:n,y1:r,x2:i,y2:s,x3:o,y3:a}=t,h=ha(o,a,i,s),u=ha(n,r,o,a),c=ha(i,s,n,r),l=h+u+c;return e.set((n*h+i*u+o*c)/l,(r*h+s*u+a*c)/l)}function ca(t,e,n,r){const{x1:i,y1:s,x2:o,y2:a,x3:h,y3:u}=t,c=Math.cos(r),l=Math.sin(r);return t.set((i-e)*c-(s-n)*l+e,(i-e)*l+(s-n)*c+n,(o-e)*c-(a-n)*l+e,(o-e)*l+(a-n)*c+n,(h-e)*c-(u-n)*l+e,(h-e)*l+(u-n)*c+n)}var la=Object.freeze({__proto__:null,Area:function(t){const{x1:e,y1:n,x2:r,y2:i,x3:s,y3:o}=t;return Math.abs(((s-e)*(i-n)-(r-e)*(o-n))/2)},BuildEquilateral:function(t,e,n){const r=n*(Math.sqrt(3)/2);return new ra(t,e,t+n/2,e+r,t-n/2,e+r)},BuildRight:function(t,e,n,r=n){return new ra(t,e,t,e-r,t+n,e)},CenterOn:function(t,e,n,r=ia){const i=r(t);return sa(t,e-i.x,n-i.y)},Centroid:ia,CircumCenter:function(t,e=new A){const n=t.x3,r=t.y3,i=t.x1-n,s=t.y1-r,o=t.x2-n,a=t.y2-r,h=2*oa(i,s,o,a),u=oa(s,i*i+s*s,a,o*o+a*a),c=oa(i,i*i+s*s,o,o*o+a*a);return e.set(n-u/h,r+c/h)},CircumCircle:function(t,e=new aa){const{x1:n,y1:r,x2:i,y2:s,x3:o,y3:a}=t,h=i-n,u=s-r,c=o-n,l=a-r,d=h*(n+i)+u*(r+s),f=c*(n+o)+l*(r+a),x=2*(h*(a-s)-u*(o-i));if(Math.abs(x)<1e-6){const t=Math.min(n,i,o),h=Math.min(r,s,a),u=.5*(Math.max(n,i,o)-t),c=.5*(Math.max(r,s,a)-h);return e.set(t+u,h+c,Math.sqrt(u*u+c*c))}{const t=(l*d-u*f)/x,i=(h*f-c*d)/x,s=t-n,o=i-r;return e.set(t,i,Math.sqrt(s*s+o*o))}},Clone:function(t){const{x1:e,y1:n,x2:r,y2:i,x3:s,y3:o}=t;return new ra(e,n,r,i,s,o)},Contains:No,ContainsArray:jo,ContainsPoint:function(t,e){return No(t,e.x,e.y)},CopyFrom:function(t,e){const{x1:n,y1:r,x2:i,y2:s,x3:o,y3:a}=t;return e.set(n,r,i,s,o,a)},Decompose:Ko,Equals:function(t,e){return t.x1===e.x1&&t.y1===e.y1&&t.x2===e.x2&&t.y2===e.y2&&t.x3===e.x3&&t.y3===e.y3},GetEdges:Vo,GetPoint:function(t,e,n=new A){const[r,i,s]=Vo(t);if(e<=0||e>=1)return n.set(r.x1,r.y1);const o=Qo(r),a=Qo(i),h=Qo(s);let u=(o+a+h)*e,c=0;if(u<o){c=u/o;const{x1:t,y1:e,x2:i,y2:s}=r;return n.set(t+(i-t)*c,e+(s-e)*c)}if(u>o+a){u-=o+a,c=u/h;const{x1:t,y1:e,x2:r,y2:i}=s;return n.set(t+(r-t)*c,e+(i-e)*c)}{u-=o,c=u/a;const{x1:t,y1:e,x2:r,y2:s}=i;return n.set(t+(r-t)*c,e+(s-e)*c)}},GetPoints:function(t,e,n,r=[]){const[i,s,o]=Vo(t),a=Qo(i),h=Qo(s),u=Qo(o),c=a+h+u;e||(e=c/n);for(let t=0;t<e;t++){let n,l=c*(t/e),d=0;if(l<a){d=l/a;const{x1:t,y1:e,x2:r,y2:s}=i;n=new A(t+(r-t)*d,e+(s-e)*d)}else if(l>a+h){l-=a+h,d=l/u;const{x1:t,y1:e,x2:r,y2:i}=o;n=new A(t+(r-t)*d,e+(i-e)*d)}else{l-=a,d=l/h;const{x1:t,y1:e,x2:r,y2:i}=s;n=new A(t+(r-t)*d,e+(i-e)*d)}r.push(n)}return r},InCenter:ua,Offset:sa,Perimeter:function(t){const[e,n,r]=Vo(t);return Qo(e)+Qo(n)+Qo(r)},Random:function(t,e=new A){const{x1:n,y1:r,x2:i,y2:s,x3:o,y3:a}=t,h=i-n,u=s-r,c=o-n,l=a-r;let d=Math.random(),f=Math.random();return d+f>=1&&(d=1-d,f=1-f),e.set(n+(h*d+c*f),r+(u*d+l*f))},Rotate:function(t,e){const n=ua(t);return ca(t,n.x,n.y,e)},RotateAroundPoint:function(t,e,n){return ca(t,e.x,e.y,n)},RotateAroundXY:ca,Triangle:ra}),da=Object.freeze({__proto__:null,Circle:Eo,Ellipse:Fo,Intersects:Zo,Line:na,Rectangle:Ci,Triangle:la});var fa=Object.freeze({__proto__:null,BoxGeometry:lo,ConeGeometry:go,CylinderGeometry:wo,PlaneGeometry:co,SphereGeometry:bo,TorusGeometry:function(t=1,e=.4,n=8,r=6,i=2*Math.PI){const s={vertices:[],normals:[],uvs:[],indices:[],numberOfVertices:0},{vertices:o,normals:a,uvs:h,indices:u}=s,c=new y,l=new y,d=new y;for(let s=0;s<=n;s++)for(let u=0;u<=r;u++){const f=u/r*i,x=s/n*Math.PI*2;l.x=(t+e*Math.cos(x))*Math.cos(f),l.y=(t+e*Math.cos(x))*Math.sin(f),l.z=e*Math.sin(x),o.push(l.x,l.y,l.z),c.x=t*Math.cos(f),c.y=t*Math.sin(f),wt(l,c,d),dt(d,d),a.push(d.x,d.y,d.z),h.push(u/r),h.push(s/n)}for(let t=1;t<=n;t++)for(let e=1;e<=r;e++){const n=(r+1)*t+e-1,i=(r+1)*(t-1)+e-1,s=(r+1)*(t-1)+e,o=(r+1)*t+e;u.push(n,i,o),u.push(i,s,o)}return s.numberOfVertices=o.length,s}});class xa{constructor(t){this.capture=!0,this.isDown=!1,this.enabled=!0,this.repeatRate=0,this.canRepeat=!0,this.timeDown=0,this.timeUpdated=0,this.timeUp=0,this.value=t,this.events=new Map}getValue(){return this.value}down(t){if(this.enabled)if(this.capture&&t.preventDefault(),this.shiftKey=t.shiftKey,this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.isDown&&this.canRepeat){this.timeUpdated=t.timeStamp;this.timeUpdated-this.timeDown>=this.repeatRate&&(zr(this,"keydown",this),this.downCallback&&this.downCallback(this))}else this.isDown=!0,this.timeDown=t.timeStamp,this.timeUpdated=t.timeStamp,zr(this,"keydown",this),this.downCallback&&this.downCallback(this)}up(t){this.enabled&&(this.capture&&t.preventDefault(),this.shiftKey=t.shiftKey,this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.isDown&&(this.isDown=!1,this.timeUp=t.timeStamp,this.timeUpdated=t.timeStamp,zr(this,"keyup",this),this.upCallback&&this.upCallback(this)))}reset(){this.isDown=!1,this.timeUpdated=this.timeDown,this.timeUp=this.timeDown}destroy(){this.downCallback=null,this.upCallback=null,this.events.clear()}}var ya=Object.freeze({__proto__:null,AKey:class extends xa{constructor(){super("a")}},BKey:class extends xa{constructor(){super("b")}},CKey:class extends xa{constructor(){super("c")}},DKey:class extends xa{constructor(){super("d")}},EKey:class extends xa{constructor(){super("e")}},FKey:class extends xa{constructor(){super("f")}},GKey:class extends xa{constructor(){super("g")}},HKey:class extends xa{constructor(){super("h")}},IKey:class extends xa{constructor(){super("i")}},JKey:class extends xa{constructor(){super("j")}},KKey:class extends xa{constructor(){super("k")}},LKey:class extends xa{constructor(){super("l")}},MKey:class extends xa{constructor(){super("m")}},NKey:class extends xa{constructor(){super("n")}},OKey:class extends xa{constructor(){super("o")}},PKey:class extends xa{constructor(){super("p")}},QKey:class extends xa{constructor(){super("q")}},RKey:class extends xa{constructor(){super("r")}},SKey:class extends xa{constructor(){super("s")}},TKey:class extends xa{constructor(){super("t")}},UKey:class extends xa{constructor(){super("u")}},VKey:class extends xa{constructor(){super("v")}},WKey:class extends xa{constructor(){super("w")}},XKey:class extends xa{constructor(){super("x")}},YKey:class extends xa{constructor(){super("y")}},ZKey:class extends xa{constructor(){super("z")}},ArrowKeys:class{constructor(t,e){const{left:n=!0,right:r=!0,up:i=!0,down:s=!0,space:o=!0}=e,a=t.keys;n&&(this.left=new xa("ArrowLeft"),a.set(this.left.value,this.left)),r&&(this.right=new xa("ArrowRight"),a.set(this.right.value,this.right)),i&&(this.up=new xa("ArrowUp"),a.set(this.up.value,this.up)),s&&(this.down=new xa("ArrowDown"),a.set(this.down.value,this.down)),o&&(this.space=new xa(" "),a.set(this.space.value,this.space))}},DownKey:class extends xa{constructor(){super("ArrowDown")}},LeftKey:class extends xa{constructor(){super("ArrowLeft")}},RightKey:class extends xa{constructor(){super("ArrowRight")}},SpaceKey:class extends xa{constructor(){super(" ")}},UpKey:class extends xa{constructor(){super("ArrowUp")}},WASDKeys:class{constructor(t,e){const{W:n=!0,A:r=!0,S:i=!0,D:s=!0,space:o=!0}=e,a=t.keys;n&&(this.W=new xa("w"),a.set(this.W.value,this.W)),r&&(this.A=new xa("a"),a.set(this.A.value,this.A)),i&&(this.S=new xa("s"),a.set(this.S.value,this.S)),s&&(this.D=new xa("d"),a.set(this.D.value,this.D)),o&&(this.space=new xa(" "),a.set(this.space.value,this.space))}}});var pa=Object.freeze({__proto__:null,GetKeyDownDuration:function(t){return t.isDown?t.timeUpdated-t.timeDown:t.timeUp-t.timeDown},Key:xa,Keys:ya,Keyboard:class extends ri{constructor(){super(),this.keyConversion={Up:"ArrowUp",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Spacebar:" ",Win:"Meta",Scroll:"ScrollLock",Del:"Delete",Apps:"ContextMenu",Esc:"Escape",Add:"+",Subtract:"-",Multiply:"*",Decimal:".",Divide:"/"},this.keydownHandler=t=>this.onKeyDown(t),this.keyupHandler=t=>this.onKeyUp(t),this.blurHandler=()=>this.onBlur(),window.addEventListener("keydown",this.keydownHandler),window.addEventListener("keyup",this.keyupHandler),window.addEventListener("blur",this.blurHandler),this.keys=new Map}addKeys(...t){t.forEach(t=>{this.keys.set(t.getValue(),t)})}clearKeys(){this.keys.clear()}onBlur(){this.keys.forEach(t=>{t.reset()})}getKeyValue(t){return this.keyConversion.hasOwnProperty(t)?this.keyConversion[t]:t}onKeyDown(t){const e=this.getKeyValue(t.key);if(this.keys.has(e)){this.keys.get(e).down(t)}zr(this,"keydown-"+e,t),zr(this,"keydown",t)}onKeyUp(t){const e=this.getKeyValue(t.key);if(this.keys.has(e)){this.keys.get(e).up(t)}zr(this,"keyup-"+e,t),zr(this,"keyup",t)}destroy(){window.removeEventListener("keydown",this.keydownHandler),window.removeEventListener("keyup",this.keyupHandler),window.removeEventListener("blur",this.blurHandler),zr(this,"destroy")}},SetKeyRepeatRate:function(t,...e){return e.forEach(e=>{e.repeatRate=t}),e}});var ma=Object.freeze({__proto__:null,Mouse:class extends ri{constructor(t){super(),this.primaryDown=!1,this.auxDown=!1,this.secondaryDown=!1,this.blockContextMenu=!0,this.resolution=1,this.mousedownHandler=t=>this.onMouseDown(t),this.mouseupHandler=t=>this.onMouseUp(t),this.mousemoveHandler=t=>this.onMouseMove(t),this.mousewheelHandler=t=>this.onMouseWheel(t),this.contextmenuHandler=t=>this.onContextMenuEvent(t),this.blurHandler=()=>this.onBlur(),this.localPoint=new A,this.hitPoint=new A,this.transPoint=new A,t||(t=i().renderer.canvas),t.addEventListener("mousedown",this.mousedownHandler),t.addEventListener("mouseup",this.mouseupHandler),t.addEventListener("wheel",this.mousewheelHandler,{passive:!1}),t.addEventListener("contextmenu",this.contextmenuHandler),window.addEventListener("mouseup",this.mouseupHandler),window.addEventListener("mousemove",this.mousemoveHandler),window.addEventListener("blur",this.blurHandler),this.target=t}onBlur(){}onMouseDown(t){this.positionToPoint(t),this.primaryDown=0===t.button,this.auxDown=1===t.button,this.secondaryDown=2===t.button,zr(this,"pointerdown",this.localPoint.x,this.localPoint.y,t.button,t)}onMouseUp(t){this.positionToPoint(t),this.primaryDown=!(0===t.button),this.auxDown=!(1===t.button),this.secondaryDown=!(2===t.button),zr(this,"pointerup",this.localPoint.x,this.localPoint.y,t.button,t)}onMouseMove(t){this.positionToPoint(t),zr(this,"pointermove",this.localPoint.x,this.localPoint.y,t)}onMouseWheel(t){zr(this,"wheel",t.deltaX,t.deltaY,t.deltaZ,t)}onContextMenuEvent(t){this.blockContextMenu&&t.preventDefault(),zr(this,"contextmenu",t)}positionToPoint(t){return this.localPoint.set(t.offsetX,t.offsetY)}getInteractiveChildren(t,e){const n=t.children;for(let t=0;t<n.length;t++){const r=n[t];r.visible&&r.input.enabled&&(e.push(r),r.input.enabledChildren&&r.numChildren&&this.getInteractiveChildren(r,e))}}checkHitArea(t,e,n){return t.input.hitArea?!!t.input.hitArea.contains(e,n):t.transform.extent.contains(e,n)}hitTest(...t){const e=this.localPoint.x,n=this.localPoint.y,r=this.transPoint;for(let i=0;i<t.length;i++){const s=t[i];if(!s.world)continue;if(We(Be(s.world.camera.worldTransform,s.transform.world),e,n,r),this.checkHitArea(s,r.x,r.y))return this.hitPoint.set(r.x,r.y),!0}return!1}hitTestChildren(t,e=!0){const n=[];if(!t.visible)return n;const r=[],i=t.input;i&&i.enabled&&r.push(t),i.enabledChildren&&t.numChildren&&this.getInteractiveChildren(t,r);for(let t=r.length-1;t>=0;t--){const i=r[t];if(this.hitTest(i)&&(n.push(i),e))break}return n}shutdown(){const t=this.target;t.removeEventListener("mousedown",this.mousedownHandler),t.removeEventListener("mouseup",this.mouseupHandler),t.removeEventListener("wheel",this.mousewheelHandler),t.removeEventListener("contextmenu",this.contextmenuHandler),window.removeEventListener("mouseup",this.mouseupHandler),window.removeEventListener("mousemove",this.mousemoveHandler),window.removeEventListener("blur",this.blurHandler)}}});var wa=Object.freeze({__proto__:null,Keyboard:pa,Mouse:ma,SetInteractive:function(...t){return t.forEach(t=>{t.input.enabled=!0}),t}});function ga(t,e){let n;if(Array.isArray(e.textures)?n=e.textures[0].frames:Array.isArray(e.frames)?n=e.frames:e.hasOwnProperty("frames")?n=Object.values(e.frames):console.warn("Invalid Texture Atlas JSON"),n){let e;for(let r=0;r<n.length;r++){const i=n[r];e=t.addFrame(i.filename,i.frame.x,i.frame.y,i.frame.w,i.frame.h),i.trimmed?e.setTrim(i.sourceSize.w,i.sourceSize.h,i.spriteSourceSize.x,i.spriteSourceSize.y,i.spriteSourceSize.w,i.spriteSourceSize.h):e.setSourceSize(i.sourceSize.w,i.sourceSize.h),i.rotated,i.anchor&&e.setPivot(i.anchor.x,i.anchor.y)}}}class Ma{constructor(t,e,n){this.responseType="text",this.crossOrigin=void 0,this.skipCache=!1,this.hasLoaded=!1,this.key=t,this.url=e,this.config=n}}function ba(t,e,n,r){return e||(e=t+n),/^(?:blob:|data:|http:\/\/|https:\/\/|\/\/)/.exec(e)?e:r?r.baseURL+r.path+e:e}function va(t){return t.data=new Image,t.crossOrigin&&(t.data.crossOrigin=t.crossOrigin),new Promise((e,n)=>{t.data.onload=()=>{t.data.onload&&(t.data.onload=null,t.data.onerror=null,e(t))},t.data.onerror=e=>{t.data.onload&&(t.data.onload=null,t.data.onerror=null,t.error=e,n(t))},t.data.src=t.url,t.data.complete&&t.data.width&&t.data.height&&(t.data.onload=null,t.data.onerror=null,e(t))})}function _a(t,e,n){const r=new Ma(t,e);return r.load=()=>(r.url=ba(r.key,r.url,".png",r.loader),r.loader&&(r.crossOrigin=r.loader.crossOrigin),new Promise((t,e)=>{const i=Qi();i.has(r.key)?t(r):va(r).then(e=>{i.add(e.key,e.data,n),t(e)}).catch(t=>{e(t)})})),r}const Ca=new Map,za=t=>(Ca.has(t)||Ca.set(t,new Map),Ca.get(t));function Sa(t){const e=new XMLHttpRequest;return e.open("GET",t.url,!0),e.responseType=t.responseType,new Promise((n,r)=>{e.onload=()=>{t.data=e.responseText,t.hasLoaded=!0,n(t)},e.onerror=()=>{t.hasLoaded=!0,r(t)},e.send()})}function Ea(t,e){const n=new Ma(t,e);return n.load=()=>(n.url=ba(n.key,n.url,".json",n.loader),new Promise((t,e)=>{const r=za("JSON");!n.skipCache&&r.has(n.key)?t(n):Sa(n).then(e=>{e.data=JSON.parse(e.data),e.skipCache||r.set(e.key,e.data),t(e)}).catch(t=>{e(t)})})),n}function Ta(t,e){return parseInt(t.getAttribute(e),10)}function Ra(t,e,n){const r=e.getElementsByTagName("info")[0],i=e.getElementsByTagName("common")[0],s={font:r.getAttribute("face"),size:Ta(r,"size"),lineHeight:Ta(i,"lineHeight")+0,chars:{}},o=e.getElementsByTagName("char");for(let e=0;e<o.length;e++){const n=o[e],r=Ta(n,"id"),i=Ta(n,"x"),a=Ta(n,"y"),h=Ta(n,"width"),u=Ta(n,"height");s.chars[r]={x:i,y:a,width:h,height:u,xOffset:Ta(n,"xoffset"),yOffset:Ta(n,"yoffset"),xAdvance:Ta(n,"xadvance")+0,kerning:{}},t.addFrame(r,i,a,h,u)}const a=e.getElementsByTagName("kerning");for(let t=0;t<a.length;t++){const e=a[t],n=Ta(e,"first"),r=Ta(e,"second"),i=Ta(e,"amount");s.chars[r].kerning[n]=i}return s}function Aa(t,e){const n=new Ma(t,e);return n.load=()=>(n.url=ba(n.key,n.url,".xml",n.loader),new Promise((t,e)=>{const r=za("XML");!n.skipCache&&r.has(n.key)?t(n):Sa(n).then(n=>{const i=Cn(n.data);null!==i?(n.data=i,n.skipCache||r.set(n.key,i),t(n)):e(n)}).catch(t=>{e(t)})})),n}function Da(t,e,n,r,i,s){const{frameWidth:o=null,endFrame:a=-1,margin:h=0,spacing:u=0}=s;let{frameHeight:c=null,startFrame:l=0}=s;if(c||(c=o),null===o)throw new Error("SpriteSheetParser: Invalid frameWidth");let d=Math.floor((r-h+u)/(o+u))*Math.floor((i-h+u)/(c+u));0===d&&console.warn("SpriteSheetParser: Frame config will result in zero frames"),(l>d||l<-d)&&(l=0),l<0&&(l=d+l),-1!==a&&(d=l+(a+1));let f=h,x=h,y=0,p=0;for(let s=0;s<d;s++){y=0,p=0;const a=f+o,l=x+c;a>r&&(y=a-r),l>i&&(p=l-i),t.addFrame(s,e+f,n+x,o-y,c-p),f+=o+u,f+o>r&&(f=h,x+=c+u)}}var Fa=Object.freeze({__proto__:null,AtlasFile:function(t,e,n,r){const i=Ea(t,n),s=_a(t,e,r),o=new Ma(t,"");return o.load=()=>(i.url=ba(i.key,i.url,".json",o.loader),s.url=ba(s.key,s.url,".png",o.loader),new Promise((e,n)=>{i.skipCache=!0,i.load().then(()=>{s.load().then(()=>{ga(Qi().get(t),i.data),e(o)}).catch(()=>{n(o)})}).catch(()=>{n(o)})})),o},BitmapTextFile:function(t,e,n,r){const i=Aa(t,n),s=_a(t,e,r),o=new Ma(t,"");return o.load=()=>(i.url=ba(i.key,i.url,".xml",o.loader),s.url=ba(s.key,s.url,".png",o.loader),new Promise((e,n)=>{i.skipCache=!0,i.load().then(()=>{s.load().then(()=>{const n=Qi().get(t),r=Ra(n,i.data);n.data=r,e(o)}).catch(()=>{n(o)})}).catch(()=>{n(o)})})),o},CSVFile:function(t,e){const n=new Ma(t,e);return n.load=()=>(n.url=ba(n.key,n.url,".csv",n.loader),new Promise((t,e)=>{const r=za("CSV");!n.skipCache&&r.has(n.key)?t(n):Sa(n).then(e=>{e.skipCache||r.set(e.key,e.data),t(e)}).catch(t=>{e(t)})})),n},ImageFile:_a,JSONFile:Ea,JSONGeometryFile:function(t,e,n){const r=new Ma(t,e),{vertices:i="verts",normals:s="normals",uvs:o="uvs",numberOfVertices:a=0}=n;return r.load=()=>(r.url=ba(r.key,r.url,".json",r.loader),new Promise((t,e)=>{const n=za("Geometry");!r.skipCache&&n.has(r.key)?t(r):Sa(r).then(e=>{const r=JSON.parse(e.data),h=new io({vertices:r[i],normals:r[s],uvs:r[o],numberOfVertices:a});e.data=h,e.skipCache||n.set(e.key,h),t(e)}).catch(t=>{e(t)})})),r},OBJFile:function(t,e){const n=new Ma(t,e);return n.load=()=>(n.url=ba(n.key,n.url,".obj",n.loader),new Promise((t,e)=>{const r=za("Obj");!n.skipCache&&r.has(n.key)?t(n):Sa(n).then(e=>{e.skipCache||r.set(e.key,e.data),t(e)}).catch(t=>{e(t)})})),n},OBJGeometryFile:function(t,e,n=!0){const r=new Ma(t,e);return r.load=()=>(r.url=ba(r.key,r.url,".obj",r.loader),new Promise((t,e)=>{const i=za("Geometry");!r.skipCache&&i.has(r.key)?t(r):Sa(r).then(e=>{const r=oo(e.data,n);if(e.data=r,!e.skipCache){let t=e.key;r.forEach((n,r)=>{r>0&&(t=e.key+r.toString());const s=new io(n.buffer);i.set(t,s)})}t(e)}).catch(t=>{e(t)})})),r},SpriteSheetFile:function(t,e,n,r){const i=new Ma(t,e);return i.load=()=>(i.url=ba(i.key,i.url,".png",i.loader),i.loader&&(i.crossOrigin=i.loader.crossOrigin),new Promise((t,e)=>{const s=Qi();s.has(i.key)?t(i):va(i).then(i=>{const o=s.add(i.key,i.data,r);o?(Da(o,0,0,o.width,o.height,n),t(i)):e(i)}).catch(t=>{e(t)})})),i},XMLFile:Aa});var Pa=Object.freeze({__proto__:null,File:Ma,Files:Fa,Loader:class extends ri{constructor(){super(),this.baseURL="",this.path="",this.crossOrigin="anonymous",this.maxParallelDownloads=-1,this.isLoading=!1,this.reset()}reset(){this.isLoading=!1,this.queue=new Set,this.inflight=new Set,this.completed=new Set,this.progress=0}add(...t){return t.forEach(t=>{t.loader=this,this.queue.add(t)}),this}start(){return this.isLoading?null:new Promise((t,e)=>{this.completed.clear(),this.progress=0,this.queue.size>0?(this.isLoading=!0,this.onComplete=t,this.onError=e,zr(this,"start"),this.nextFile()):(this.progress=1,zr(this,"complete"),t())})}nextFile(){let t=this.queue.size;if(-1!==this.maxParallelDownloads&&(t=Math.min(t,this.maxParallelDownloads)-this.inflight.size),t){const e=this.queue.values();for(;t>0;){const n=e.next().value;this.inflight.add(n),this.queue.delete(n),n.load().then(t=>this.fileComplete(t)).catch(t=>this.fileError(t)),t--}}else 0===this.inflight.size&&this.stop()}stop(){this.isLoading&&(this.isLoading=!1,zr(this,"complete",this.completed),this.onComplete(),this.completed.clear())}updateProgress(t){this.inflight.delete(t),this.completed.add(t);const e=this.completed.size,n=this.queue.size+this.inflight.size;e>0&&(this.progress=e/(e+n)),zr(this,"progress",this.progress,e,n),this.nextFile()}fileComplete(t){zr(this,"filecomplete",t),this.updateProgress(t)}fileError(t){zr(this,"fileerror",t),this.updateProgress(t)}totalFilesToLoad(){return this.queue.size+this.inflight.size}setBaseURL(t=""){return""!==t&&"/"!==t.substr(-1)&&(t=t.concat("/")),this.baseURL=t,this}setPath(t=""){return""!==t&&"/"!==t.substr(-1)&&(t=t.concat("/")),this.path=t,this}setCORS(t){return this.crossOrigin=t,this}setMaxParallelDownloads(t){return this.maxParallelDownloads=t,this}}});const Ia=new xo({ambient:[0,0,0],diffuse:[.01,.01,.01],specular:[.5,.5,.5],shine:.25}),Oa=new xo({ambient:[.02,.02,.02],diffuse:[.01,.01,.01],specular:[.4,.4,.4],shine:.078125}),La=new xo({ambient:[.329412,.223529,.027451],diffuse:[.780392,.568627,.113725],specular:[.992157,.941176,.807843],shine:.21794872}),ka=new xo({ambient:[.2125,.1275,.054],diffuse:[.714,.4284,.18144],specular:[.393548,.271906,.166721],shine:.2}),Ba=new xo({ambient:[.25,.25,.25],diffuse:[.4,.4,.4],specular:[.774597,.774597,.774597],shine:.6}),Ga=new xo({ambient:[.19125,.0735,.0225],diffuse:[.7038,.27048,.0828],specular:[.256777,.137622,.086014],shine:.1}),Ua=new xo({ambient:[0,.1,.06],diffuse:[0,.50980392,.50980392],specular:[.50196078,.50196078,.50196078],shine:.25}),Va=new xo({ambient:[0,.05,.05],diffuse:[.4,.5,.5],specular:[.04,.7,.7],shine:.078125}),Na=new xo({ambient:[.0215,.1745,.0215],diffuse:[.07568,.61424,.07568],specular:[.633,.727811,.633],shine:.6}),ja=new xo({ambient:[.24725,.1995,.0745],diffuse:[.75164,.60648,.22648],specular:[.628281,.555802,.366065],shine:.4}),Wa=new xo({ambient:[0,0,0],diffuse:[.1,.35,.1],specular:[.45,.55,.45],shine:.25}),qa=new xo({ambient:[0,.05,0],diffuse:[.4,.5,.4],specular:[.04,.7,.04],shine:.078125}),Ha=new xo({ambient:[.135,.2225,.1575],diffuse:[.54,.89,.63],specular:[.316228,.316228,.316228],shine:.1}),Xa=new xo({ambient:[.05375,.05,.06625],diffuse:[.18275,.17,.22525],specular:[.332741,.328634,.346435],shine:.3}),Ka=new xo({ambient:[.25,.20725,.20725],diffuse:[1,.829,.829],specular:[.296648,.296648,.296648],shine:.088}),Ya=new xo({ambient:[0,0,0],diffuse:[.5,0,0],specular:[.7,.6,.6],shine:.25}),$a=new xo({ambient:[.05,0,0],diffuse:[.5,.4,.4],specular:[.7,.04,.04],shine:.078125}),Za=new xo({ambient:[.1745,.01175,.01175],diffuse:[.61424,.04136,.04136],specular:[.727811,.626959,.626959],shine:.6}),Ja=new xo({ambient:[.19225,.19225,.19225],diffuse:[.50754,.50754,.50754],specular:[.508273,.508273,.508273],shine:.4}),Qa=new xo({ambient:[.1,.18725,.1745],diffuse:[.396,.74151,.69102],specular:[.297254,.30829,.306678],shine:.1}),th=new xo({ambient:[0,0,0],diffuse:[.55,.55,.55],specular:[.7,.7,.7],shine:.25}),eh=new xo({ambient:[.05,.05,.05],diffuse:[.5,.5,.5],specular:[.7,.7,.7],shine:.078125}),nh=new xo({ambient:[0,0,0],diffuse:[.5,.5,0],specular:[.6,.6,.5],shine:.25}),rh=new xo({ambient:[.05,.05,0],diffuse:[.5,.5,.4],specular:[.7,.7,.04],shine:.078125});var ih=Object.freeze({__proto__:null,BlackPlastic:Ia,BlackRubber:Oa,Brass:La,Bronze:ka,Chrome:Ba,Copper:Ga,CyanPlastic:Ua,CyanRubber:Va,Emerald:Na,Gold:ja,GreenPlastic:Wa,GreenRubber:qa,Jade:Ha,Obsidian:Xa,Pearl:Ka,RedPlastic:Ya,RedRubber:$a,Ruby:Za,Silver:Ja,Turquoise:Qa,WhitePlastic:th,WhiteRubber:eh,YellowPlastic:nh,YellowRubber:rh});const sh=["#000","#9D9D9D","#FFF","#BE2633","#E06F8B","#493C2B","#A46422","#EB8931","#F7E26B","#2F484E","#44891A","#A3CE27","#1B2632","#005784","#31A2F2","#B2DCEF"];var oh=Object.freeze({__proto__:null,Arne16:sh,C64:["#000","#fff","#8b4131","#7bbdc5","#8b41ac","#6aac41","#3931a4","#d5de73","#945a20","#5a4100","#bd736a","#525252","#838383","#acee8b","#7b73de","#acacac"],CGA:["#000","#2234d1","#0c7e45","#44aacc","#8a3622","#5c2e78","#aa5c3d","#b5b5b5","#5e606e","#4c81fb","#6cd947","#7be2f9","#eb8a60","#e23d69","#ffd93f","#fff"],JMP:["#000","#191028","#46af45","#a1d685","#453e78","#7664fe","#833129","#9ec2e8","#dc534b","#e18d79","#d6b97b","#e9d8a1","#216c4b","#d365c8","#afaab9","#f5f4eb"],MSX:["#000","#191028","#46af45","#a1d685","#453e78","#7664fe","#833129","#9ec2e8","#dc534b","#e18d79","#d6b97b","#e9d8a1","#216c4b","#d365c8","#afaab9","#fff"],PICO8:["#000","#1D2B53","#7E2553","#008751","#AB5236","#5F574F","#C2C3C7","#FFF1E8","#FF004D","#FFA300","#FFEC27","#00E436","#29ADFF","#83769C","#FF77A8","#FFCCAA"]}),ah=Object.freeze({__proto__:null,AtlasParser:ga,BitmapTextParser:Ra,SpriteSheetParser:Da});var hh=Object.freeze({__proto__:null,CanvasTexture:Ks,GridTexture:function(t,e,n=32,r=32,i=2,s=2){const o=Xs(n,r),a=n/i,h=r/s;o.fillStyle=t,o.fillRect(0,0,n,r),o.fillStyle=e;for(let t=0;t<s;t++)for(let e=t%2;e<i;e+=2)o.fillRect(e*a,t*h,a,h);return new Zi(o.canvas)},PixelTexture:function(t){const{data:e=[],palette:n=sh,pixelWidth:r=1,pixelHeight:i=r,preRender:s=null,postRender:o=null}=t;let{canvas:a=null,resizeCanvas:h=!0,clearCanvas:u=!0}=t;const c=Math.floor(Math.abs(e[0].length*r)),l=Math.floor(Math.abs(e.length*i));a||(a=Xs(c,l).canvas,h=!1,u=!1),h&&(a.width=c,a.height=l);const d=a.getContext("2d");u&&d.clearRect(0,0,c,l),s&&s(a,d);for(let t=0;t<e.length;t++){const s=e[t];for(let e=0;e<s.length;e++){const o=s[e];"."!==o&&" "!==o&&(d.fillStyle=n[parseInt("0x"+o.toUpperCase())],d.fillRect(e*r,t*i,r,i))}}return o&&o(a,d),new Zi(a)},RenderTexture:class extends Zi{constructor(t,e=256,n=e){super(null,e,n),this.renderer=t}cls(){return this}batchStart(){return this}batchDraw(t){for(let e=0,n=t.length;e<n;e++);return this}batchEnd(){return this.renderer.reset(),this}draw(...t){return this.batchStart(),this.batchDraw(t),this.batchEnd(),this}},SolidColorTexture:function(t="rgba(0,0,0,0)",e=32,n=32){const r=Xs(e,n);return r.fillStyle=t,r.fillRect(0,0,e,n),new Zi(r.canvas)}});class uh{constructor(){this.textures=new Map,this.createDefaultTextures(),ts(this)}createDefaultTextures(){this.add("__BLANK",new Zi(Xs(32,32).canvas));const t=Xs(32,32);t.strokeStyle="#0f0",t.moveTo(0,0),t.lineTo(32,32),t.stroke(),t.strokeRect(.5,.5,31,31),this.add("__MISSING",new Zi(t.canvas));const e=Xs(32,32);e.fillStyle="#fff",e.fillRect(0,0,32,32),this.add("__WHITE",new Zi(e.canvas))}get(t){const e=this.textures;return e.has(t)?e.get(t):e.get("__MISSING")}has(t){return this.textures.has(t)}add(t,e,n){let r;const i=this.textures;return i.has(t)||(r=e instanceof Zi?e:new Zi(e,0,0,n),r.key=t,i.set(t,r)),r}}var ch=Object.freeze({__proto__:null,CreateCanvas:Xs,Frame:$i,GetFrames:function(t,e){const n=[];return e.forEach(e=>{n.push(t.getFrame(e))}),n},GetFramesInRange:function(t,e){const{prefix:n="",start:r=0,zeroPad:i=0,suffix:s=""}=e;let o=e.end;const a=[],h=r<o?1:-1;o+=h;for(let e=r;e!==o;e+=h){const r=n+e.toString().padStart(i,"0")+s;a.push(t.getFrame(r))}return a},SetFilter:function(t,...e){return e.forEach(e=>{e.binding&&e.binding.setFilter(t)}),e},Palettes:oh,Parsers:ah,Types:hh,Texture:Zi,TextureManager:uh});function lh(){}function dh(t,e){const{duration:n=0,repeat:r=0,delay:i=-1,onStart:s=lh,onUpdate:o=lh,onRepeat:a=lh,onComplete:h=lh}=e,u={elapsed:n,duration:n,repeat:r,delay:i,update:null,onStart:s,onUpdate:o,onRepeat:a,onComplete:h};u.update=t=>{if(u.delay>0){if(u.delay-=t,!(u.delay<0))return!1;u.delay=0}return 0===u.delay&&(u.onStart(),u.delay=-1),-1===u.delay&&(u.elapsed-=t,u.onUpdate(t,u.elapsed/u.duration),u.elapsed<=0&&(u.repeat>0?(u.repeat--,u.elapsed=u.duration,u.onRepeat(u.repeat)):(u.elapsed=0,u.onComplete()))),0===u.elapsed},t.events.add(u)}var fh=Object.freeze({__proto__:null,AddDelayedCall:function(t,e,n){dh(t,{duration:0,delay:e,onComplete:n})},AddTimer:dh,Clock:class{constructor(t){this.world=t,this.timeScale=1,this.events=new Set}update(t,e){this.now=e,t*=this.timeScale,this.events.forEach(e=>{e.update(t)&&this.events.delete(e)})}},NOOP:lh});var xh=Object.freeze({__proto__:null,WorldRenderEvent:"worldrender",WorldShutdownEvent:"worldshutdown"});function yh(t,e){e.numRendered++,e.numRenderable++,t.node.dirtyFrame>=e.gameFrame&&e.dirtyFrame++,t.children.forEach(t=>{t.children.length>0&&yh(t,e)})}function ph(t){if(t.node.isDirty(Ar))return!0;const e=[t];for(;e.length>0;){const t=e.pop();if(t.node.isDirty(Rr))return!0;const n=t.children.length;if(n>0)for(let r=0;r<n;r++)e.push(t.children[r])}return e.length=0,!1}function mh(t,e){t.forEach(t=>{e||ph(t)?t.node.setDirty(Ar):t.children.length=0})}function wh(t,e,n=[]){for(let r=0;r<e.numChildren;r++){const i=e.children[r];if(i.isRenderable()){const e=[],r={node:i,children:e};n.push(r),i.willRenderChildren&&i.numChildren>0&&(i.willCacheChildren&&t.push(r),wh(t,i,e))}}return n}function gh(t){const e=[],n=wh(e,t,[]),r=t.renderData;e.length>0&&mh(e,t.camera.dirtyRender),n.forEach(t=>{t.children.length>0?yh(t,r):(r.numRendered++,r.numRenderable++,t.node.dirtyFrame>=r.gameFrame&&r.dirtyFrame++)}),t.renderList=n,t.forceRefresh&&(r.dirtyFrame++,t.forceRefresh=!1)}function Mh(t,e){t.numDirtyFrames+=e.dirtyFrame,t.numTotalFrames+=e.numRendered,e.camera.dirtyRender&&t.numDirtyCameras++,t.worldData.push(e)}function bh(t,e){t.gameFrame=e,t.dirtyFrame=0,t.numRendered=0,t.numRenderable=0}class vh extends Ni{constructor(t){super(),this.forceRefresh=!1,this.is3D=!1,this.type="BaseWorld",this.scene=t,this.world=this,this.events=new Map,this.renderList=[],this._updateListener=oi(t,"update",(t,e)=>this.update(t,e)),this._renderListener=oi(t,"render",t=>this.render(t)),this._shutdownListener=oi(t,"shutdown",()=>this.shutdown()),ai(t,"destroy",()=>this.destroy())}update(t,e){this.willUpdate&&(zr(this,"update",t,e,this),super.update(t,e))}postUpdate(t,e){zr(this,"postupdate",t,e,this)}render(t){const e=this.renderData;bh(e,t.gameFrame),this.willRender&&this.visible&&(gh(this),zr(this,"worldrender",e,this),Mh(t,e),this.camera.dirtyRender=!1)}renderGL(t){const e=t.current2DCamera,n=this.camera;e&&Ue(n.worldTransform,e.worldTransform)||Gi(t),function(t,e){t.current2DCamera=e,t.cameraMatrix=e.matrix,ns(t)}(t,n),this.renderList.forEach(e=>{e.children.length>0?this.renderNode(e,t):e.node.renderGL(t)})}renderNode(t,e){t.node.renderGL(e),t.children.forEach(t=>{t.children.length>0?this.renderNode(t,e):t.node.renderGL(e)}),t.node.postRenderGL(e)}postRenderGL(t){}shutdown(){const t=this.scene;si(t,"update",this._updateListener),si(t,"render",this._renderListener),si(t,"shutdown",this._shutdownListener),Ur(this),zr(this,"worldshutdown",this),bh(this.renderData,0),this.camera&&this.camera.reset()}destroy(t){super.destroy(t),zr(this,"destroy",this),bh(this.renderData,0),this.camera&&this.camera.destroy(),this.events.clear(),this.camera=null,this.renderData=null,this.events=null}}function _h(t,e){return{world:t,camera:e,gameFrame:0,dirtyFrame:0,numRendered:0,numRenderable:0}}var Ch=Object.freeze({__proto__:null,BaseWorld:vh,BuildRenderList:gh,CalculateTotalRenderable:yh,CreateWorldRenderData:_h,Events:xh,HasDirtyChildren:ph,MergeRenderData:Mh,ResetWorldRenderData:bh,StaticWorld:class extends vh{constructor(t){super(t),this.type="StaticWorld",this.camera=new B,this.renderData=_h(this,this.camera)}},UpdateCachedLayers:mh,World:class extends vh{constructor(t){super(t),this.enableCameraCull=!0,this.type="World",this.camera=new k,this.renderData=_h(this,this.camera)}},WorldDepthFirstSearch:wh});var zh=Object.freeze({__proto__:null,World3DRenderEvent:"worldrender",World3DShutdownEvent:"worldshutdown"});function Sh(t,e){e.numRendered++,e.numRenderable++,t.node.dirtyFrame>=e.gameFrame&&e.dirtyFrame++,t.children.forEach(t=>{t.children.length>0&&Sh(t,e)})}function Eh(t){if(t.node.isDirty(Ar))return!0;const e=[t];for(;e.length>0;){const t=e.pop();if(t.node.isDirty(Rr))return!0;const n=t.children.length;if(n>0)for(let r=0;r<n;r++)e.push(t.children[r])}return e.length=0,!1}function Th(t,e){t.forEach(t=>{e||Eh(t)?t.node.setDirty(Ar):t.children.length=0})}function Rh(t,e,n=[]){for(let r=0;r<e.numChildren;r++){const i=e.children[r];if(i.isRenderable()){const e=[],r={node:i,children:e};n.push(r),i.willRenderChildren&&i.numChildren>0&&(i.willCacheChildren&&t.push(r),Rh(t,i,e))}}return n}function Ah(t){const e=[],n=Rh(e,t,[]),r=t.renderData;e.length>0&&Th(e,t.camera.dirtyRender),n.forEach(t=>{t.children.length>0?Sh(t,r):(r.numRendered++,r.numRenderable++,t.node.dirtyFrame>=r.gameFrame&&r.dirtyFrame++)}),t.renderList=n,t.forceRefresh&&(r.dirtyFrame++,t.forceRefresh=!1)}function Dh(t,e){t.numDirtyFrames+=e.dirtyFrame,t.numTotalFrames+=e.numRendered,e.camera.dirtyRender&&t.numDirtyCameras++,t.worldData.push(e)}function Fh(t,e){t.gameFrame=e,t.dirtyFrame=0,t.numRendered=0,t.numRenderable=0}class Ph extends fo{constructor(t){super(),this.forceRefresh=!1,this.is3D=!0,this.type="BaseWorld",this.scene=t,this.world=this,this.events=new Map,this.renderList=[],this._updateListener=oi(t,"update",(t,e)=>this.update(t,e)),this._renderListener=oi(t,"render",t=>this.render(t)),this._shutdownListener=oi(t,"shutdown",()=>this.shutdown()),ai(t,"destroy",()=>this.destroy())}update(t,e){this.willUpdate&&(zr(this,"update",t,e,this),super.update(t,e))}postUpdate(t,e){zr(this,"postupdate",t,e,this)}render(t){const e=this.renderData;Fh(e,t.gameFrame),this.willRender&&this.visible&&(Ah(this),zr(this,"worldrender",e,this),Dh(t,e))}renderNode(t,e){t.node.renderGL(e),t.children.forEach(t=>{t.children.length>0?this.renderNode(t,e):t.node.renderGL(e)}),t.node.postRenderGL(e)}shutdown(){const t=this.scene;si(t,"update",this._updateListener),si(t,"render",this._renderListener),si(t,"shutdown",this._shutdownListener),ei(this),zr(this,"worldshutdown",this),Fh(this.renderData,0)}destroy(t){super.destroy(t),zr(this,"destroy",this),Fh(this.renderData,0),this.events.clear(),this.camera=null,this.renderData=null,this.events=null}}function Ih(t,e){return{world:t,camera:e,gameFrame:0,dirtyFrame:0,numRendered:0,numRenderable:0}}class Oh extends Ps{constructor(){super();const t=new Float32Array(16).fill(0),e=[0,0,0],n={fragmentShader:"#define SHADER_NAME AMBIENT_LIGHT_FRAG\n\nprecision highp float;\n\nuniform vec3 uLightPosition;\nuniform vec3 uLightAmbient;\nuniform vec3 uLightDiffuse;\nuniform vec3 uLightSpecular;\n\nuniform vec3 uMaterialAmbient;\nuniform vec3 uMaterialDiffuse;\nuniform vec3 uMaterialSpecular;\nuniform float uMaterialShine;\n\nuniform vec3 uCameraPosition;\n\nuniform sampler2D uTexture;\n\nvarying vec2 vTextureCoord;\nvarying vec3 vNormal;\nvarying vec3 vPosition;\n\nvoid main (void)\n{\n    vec4 color = texture2D(uTexture, vTextureCoord);\n\n    vec3 ambient = uLightAmbient * uMaterialAmbient;\n\n    vec3 norm = normalize(vNormal);\n    vec3 lightDir = normalize(uLightPosition - vPosition);\n    float diff = max(dot(norm, lightDir), 0.0);\n    vec3 diffuse = uLightDiffuse * (diff * uMaterialDiffuse);\n\n    vec3 viewDir = normalize(uCameraPosition - vPosition);\n    vec3 reflectDir = reflect(-lightDir, norm);\n    float spec = pow(max(dot(viewDir, reflectDir), 0.0), uMaterialShine);\n    vec3 specular = uLightSpecular * (spec * uMaterialSpecular);\n\n    vec3 result = (ambient + diffuse + specular) * color.rgb;\n\n    gl_FragColor = vec4(result, color.a);\n}",vertexShader:"\n#define SHADER_NAME AMBIENT_LIGHT_VERT\n\nprecision highp float;\n\nattribute vec3 aVertexPosition;\nattribute vec3 aVertexNormal;\nattribute vec2 aTextureCoord;\n\nuniform mat4 uViewProjectionMatrix;\nuniform mat4 uModelMatrix;\nuniform mat4 uNormalMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec3 vNormal;\nvarying vec3 vPosition;\n\nvoid main(void)\n{\n    vTextureCoord = aTextureCoord;\n\n    vPosition = vec3(uModelMatrix * vec4(aVertexPosition, 1.0));\n\n    vNormal = vec3(uNormalMatrix * vec4(aVertexNormal, 1.0));\n\n    gl_Position = uViewProjectionMatrix * uModelMatrix * vec4(aVertexPosition, 1.0);\n}\n",attributes:{aVertexPosition:{size:3,type:5126,normalized:!1,offset:0},aVertexNormal:{size:3,type:5126,normalized:!1,offset:12},aTextureCoord:{size:2,type:5126,normalized:!1,offset:24}},uniforms:{uViewProjectionMatrix:t,uNormalMatrix:t,uModelMatrix:t,uCameraPosition:e,uTexture:0,uLightPosition:e,uLightAmbient:e,uLightDiffuse:e,uLightSpecular:e,uMaterialAmbient:e,uMaterialDiffuse:e,uMaterialSpecular:e,uMaterialShine:0}};this.fromConfig(n)}}class Lh{constructor(t=45,e=.1,n=1e3){this.isOrbit=!1,this.minDistance=0,this.maxDistance=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.dirtyRender=!0,this.panRate=5,this.zoomRate=200,this.rotateRate=-3,this._yaw=0,this._pitch=0,this._roll=0,this.type="Camera3D",this._fov=t,this._near=e,this._far=n,this.matrix=new d,this.viewMatrix=new d,this.projectionMatrix=new d,this.viewProjectionMatrix=new d,this.position=new pt(()=>this.update()),this.rotation=new m;const r=i().renderer;this.viewport=new R(0,0,r.width,r.height),this.renderer=r,this.forward=N(),this.up=q(),this.right=W(),this.start=new y,this.setAspectRatio()}update(){const t=this.matrix,e=this.viewMatrix;return x(this.rotation,this.position,!this.isOrbit,t),Mt(Z,t,this.forward),Mt(X,t,this.up),Mt($,t,this.right),g(t,e),b(this.projectionMatrix,e,this.viewProjectionMatrix),this}panX(t){const e=this.position;return this.isOrbit||gt(e,this.right,t,e),this}panY(t){const e=this.position,n=this.up;return this.isOrbit?e.y+=n.y*t:gt(e,n,t,e),this}panZ(t){const e=this.position;return this.isOrbit?e.z+=t:gt(e,this.forward,t,e),this}begin(t,e){this.start.set(t,e)}pan(t,e){const n=t-this.start.x,r=e-this.start.y,i=this.viewport;this.panX(-n*(this.panRate/i.width)),this.panY(r*(this.panRate/i.height)),this.start.set(t,e)}rotate(t,e){const n=t-this.start.x,r=e-this.start.y,i=this.viewport;this.rotation.x+=r*(this.rotateRate/i.height),this.rotation.y+=n*(this.rotateRate/i.width),this.start.set(t,e),this.update()}zoom(t){this.panZ(st(t,-1,1)*(this.zoomRate/this.viewport.height))}setAspectRatio(t){if(!t){const e=this.renderer;t=e.width/e.height}return this.aspect=t,this.updateProjectionMatrix()}updateProjectionMatrix(){return _(wn(this._fov),this.aspect,this._near,this._far,this.projectionMatrix),this}get fov(){return this._fov}set fov(t){this._fov=st(t,0,180),this.updateProjectionMatrix()}get near(){return this._near}set near(t){t>0&&(this._near=t,this.updateProjectionMatrix())}get far(){return this._far}set far(t){t>0&&(this._far=t,this.updateProjectionMatrix())}get yaw(){return this._yaw}set yaw(t){this._yaw=t,Et(t,this._pitch,this._roll,this.rotation)}get pitch(){return this._pitch}set pitch(t){this._pitch=t,Et(this._yaw,t,this._roll,this.rotation)}get roll(){return this._roll}set roll(t){this._roll=t,Et(this._yaw,this._pitch,t,this.rotation)}}var kh=Object.freeze({__proto__:null,BaseWorld3D:Ph,BuildRenderList:Ah,CalculateTotalRenderable:Sh,CreateWorld3DRenderData:Ih,Events:zh,HasDirtyChildren:Eh,MergeRenderData:Dh,ResetWorld3DRenderData:Fh,UpdateCachedLayers:Th,World3D:class extends Ph{constructor(t,e=0,n=0,r=0,i){super(t),this.enableCameraCull=!0,this.type="World3D",this.camera=new Lh,this.camera.position.set(e,n,r),this.light=new Mo(i),this.shader=new Oh,this.renderData=Ih(this,this.camera)}renderGL(t){Gi(t);const e=this.shader,n=this.camera,r=t.renderer.gl;ks(t,e,0),e.setUniform("uViewProjectionMatrix",n.viewProjectionMatrix.data),e.setUniform("uCameraPosition",n.position.toArray()),this.light.setUniforms(e),r.enable(r.DEPTH_TEST),this.renderList.forEach(e=>{e.children.length>0?this.renderNode(e,t):e.node.renderGL(t)})}postRenderGL(t){const e=t.renderer.gl;e.disable(e.DEPTH_TEST),e.disable(e.CULL_FACE),ls(t)}},WorldDepthFirstSearch:Rh});let Bh;const Gh=()=>Bh,Uh=t=>{Bh=t};class Vh{constructor(){this.scenes=new Map,this.sceneIndex=0,this.flush=!1,this.renderResult={gameFrame:0,numTotalFrames:0,numDirtyFrames:0,numDirtyCameras:0,worldData:[]},this.game=i(),Uh(this),ai(this.game,"boot",()=>this.boot())}boot(){Us.forEach(t=>new t)}update(t,e){for(const n of this.scenes.values())zr(n,"update",t,e)}render(t){const e=this.renderResult;!function(t,e=0){t.gameFrame=e,t.numTotalFrames=0,t.numDirtyFrames=0,t.numDirtyCameras=0,t.worldData.length=0}(e,t);for(const t of this.scenes.values())zr(t,"render",e);return this.flush&&(e.numDirtyFrames++,this.flush=!1),e}}function Nh(t,e={}){const n=Gh(),r=n.scenes.size,i=n.sceneIndex,s=0===r;"string"==typeof e?t.key=e:(e||!e&&s)&&(t.key=function(t,e,n){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:n}(e,"key","scene"+i.toString())),n.scenes.has(t.key)?console.warn("Scene key already in use: "+t.key):(n.scenes.set(t.key,t),n.flush=!0,n.sceneIndex++)}t.Camera=G,t.Camera3D=bn,t.DOM=zn,t.Device=Mr,t.Display=Nr,t.Display3D=ni,t.Events=hi,t.Game=class extends ri{constructor(...t){super(),this.VERSION="4.0.0-beta1",this.isBooted=!1,this.isPaused=!1,this.willUpdate=!0,this.willRender=!0,this.lastTick=0,this.elapsed=0,this.frame=0,s(this),_n(()=>this.boot(t))}boot(t){t.forEach(t=>t());const e=void 0;this.renderer=new e,this.textureManager=new uh,this.sceneManager=new Vh,this.isBooted=!0,function(){{const t=" v"+i().VERSION;console.log(`%cPhaser${t}%c https://phaser4.io`,"padding: 4px 16px; color: #fff; background: linear-gradient(#3e0081 40%, #00bcc3)","")}}(),zr(this,"boot"),this.lastTick=performance.now(),this.step(this.lastTick)}pause(){this.isPaused=!0}resume(){this.isPaused=!1,this.lastTick=performance.now()}step(t){const e=t-this.lastTick;this.lastTick=t,this.elapsed+=e,this.isPaused||(this.willUpdate&&(this.sceneManager.update(e,t),zr(this,"update",e,t)),this.willRender&&this.renderer.render(this.sceneManager.render(this.frame))),this.frame++,a(this.frame),h(this.elapsed),requestAnimationFrame(t=>this.step(t))}destroy(){}},t.GameObjects=Ys,t.GameObjects3D=vo,t.Geom=da,t.Geom3D=fa,t.Input=wa,t.Loader=Pa,t.Materials3D=ih,t.Math=Mn,t.Scene=class{constructor(t){this.game=i(),this.events=new Map,Nh(this,t)}},t.Textures=ch,t.Time=fh,t.WebGL1=Qs,t.World=Ch,t.World3D=kh}));
